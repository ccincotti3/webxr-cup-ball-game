/*! For license information please see main.js.LICENSE.txt */
(()=>{var e,t={4409:()=>{if("undefined"==typeof AFRAME)throw new Error("Component attempted to register before AFRAME was available.");AFRAME.registerComponent("environment",{schema:{active:{default:!1},preset:{default:"default",oneOf:["none","default","contact","egypt","checkerboard","forest","goaland","yavapai","goldmine","arches","threetowers","poison","tron","japan","dream","volcano","starry","osiris"]},seed:{type:"int",default:1,min:0,max:1e3},skyType:{default:"color",oneOf:["none","color","gradient","atmosphere"]},skyColor:{type:"color"},horizonColor:{type:"color"},lighting:{default:"distant",oneOf:["none","distant","point"]},shadow:{default:!1},shadowSize:{default:10},lightPosition:{type:"vec3",default:{x:0,y:1,z:-.2}},fog:{type:"float",default:0,min:0,max:1},flatShading:{default:!1},playArea:{type:"float",default:1,min:.5,max:10},ground:{default:"hills",oneOf:["none","flat","hills","canyon","spikes","noise"]},groundYScale:{type:"float",default:3,min:0,max:50},groundTexture:{default:"none",oneOf:["none","checkerboard","squares","walkernoise"]},groundColor:{type:"color",default:"#553e35"},groundColor2:{type:"color",default:"#694439"},dressing:{default:"none",oneOf:["none","cubes","pyramids","cylinders","hexagons","stones","trees","mushrooms","towers","apparatus","arches","torii"]},dressingAmount:{type:"int",default:10,min:0,max:1e3},dressingColor:{type:"color",default:"#795449"},dressingScale:{type:"float",default:5,min:0,max:100},dressingVariance:{type:"vec3",default:{x:1,y:1,z:1}},dressingUniformScale:{default:!0},dressingOnPlayArea:{type:"float",default:0,min:0,max:1},grid:{default:"none",oneOf:["none","1x1","2x2","crosses","dots","xlines","ylines"]},gridColor:{type:"color",default:"#ccc"}},multiple:!1,presets:{none:{},default:{active:!0,seed:1,skyType:"atmosphere",skyColor:"#88c",horizonColor:"#ddd",lighting:"distant",lightPosition:{x:-.11,y:1,z:.33},fog:.78,flatShading:!1,playArea:1,ground:"hills",groundYScale:3,groundTexture:"checkerboard",groundColor:"#454545",groundColor2:"#5d5d5d",dressing:"none",dressingAmount:10,dressingColor:"#795449",dressingScale:1,dressingVariance:{x:0,y:0,z:0},dressingUniformScale:!0,dressingOnPlayArea:0,grid:"none",gridColor:"#ccc",shadow:!1},contact:{active:!0,seed:14,skyType:"gradient",skyColor:"#478d54",horizonColor:"#b696cb",lighting:"distant",lightPosition:{x:0,y:2.01,z:-1},fog:.8,flatShading:!1,playArea:1,ground:"spikes",groundYScale:4.91,groundTexture:"none",groundColor:"#2e455f",groundColor2:"#694439",dressing:"apparatus",dressingAmount:7,dressingColor:"#657067",dressingScale:20,dressingVariance:{x:20,y:20,z:20},dressingUniformScale:!0,dressingOnPlayArea:0,grid:"1x1",gridColor:"#478d54",shadow:!1},egypt:{active:!0,seed:26,skyType:"gradient",skyColor:"#1b7660",horizonColor:"#e4b676",lighting:"distant",lightPosition:{x:0,y:1.65,z:-1},fog:.75,flatShading:!1,playArea:1,ground:"hills",groundYScale:5,groundTexture:"walkernoise",groundColor:"#664735",groundColor2:"#6c4b39",dressing:"pyramids",dressingAmount:10,dressingColor:"#7c5c45",dressingScale:5,dressingVariance:{x:20,y:20,z:20},dressingUniformScale:!0,dressingOnPlayArea:0,grid:"spots",gridColor:"#e4b676",shadow:!1},checkerboard:{active:!0,seed:1,skyType:"gradient",skyColor:"#0d0d0d",horizonColor:"#404040",lighting:"distant",lightPosition:{x:0,y:1,z:-.2},fog:.81,flatShading:!0,playArea:1,ground:"hills",groundYScale:4.81,groundTexture:"checkerboard",groundColor:"#252525",groundColor2:"#111111",dressing:"cubes",dressingAmount:10,dressingColor:"#9f9f9f",dressingScale:1.51,dressingVariance:{x:5,y:20,z:5},dressingUniformScale:!0,dressingOnPlayArea:0,grid:"dots",gridColor:"#ccc",shadow:!1},forest:{active:!0,seed:8,skyType:"gradient",skyColor:"#24b59f",horizonColor:"#eff9b7",lighting:"distant",lightPosition:{x:-1.2,y:.88,z:-.55},fog:.8,flatShading:!1,playArea:1,ground:"noise",groundYScale:4.18,groundTexture:"squares",groundColor:"#937a24",groundColor2:"#987d2e",dressing:"trees",dressingAmount:500,dressingColor:"#888b1d",dressingScale:1,dressingVariance:{x:10,y:10,z:10},dressingUniformScale:!0,dressingOnPlayArea:0,grid:"none",gridColor:"#c5a543",shadow:!1},goaland:{active:!0,seed:17,skyType:"gradient",skyColor:"#14645f",horizonColor:"#a3dab8",lighting:"point",lightPosition:{x:.1,y:4,z:.56},fog:.73,flatShading:!1,playArea:1,ground:"noise",groundYScale:.81,groundTexture:"none",groundColor:"#ae3241",groundColor2:"#db4453",dressing:"mushrooms",dressingAmount:150,dressingColor:"#a9313d",dressingScale:5,dressingVariance:{x:5,y:10,z:5},dressingUniformScale:!0,dressingOnPlayArea:0,grid:"dots",gridColor:"#239893",shadow:!1},yavapai:{active:!0,seed:11,skyType:"gradient",skyColor:"#239849",horizonColor:"#cfe0af",lighting:"distant",lightPosition:{x:.5,y:1,z:0},fog:.8,flatShading:!0,playArea:1,ground:"canyon",groundYScale:9.76,groundTexture:"walkernoise",groundColor:"#C66344",groundColor2:"#c96b4b",dressing:"stones",dressingAmount:500,dressingColor:"#C66344",dressingScale:.06,dressingVariance:{x:.2,y:.1,z:.2},dressingUniformScale:!0,dressingOnPlayArea:1,grid:"none",gridColor:"#239893",shadow:!1},goldmine:{active:!0,seed:53,skyType:"gradient",skyColor:"#1e1c1a",horizonColor:"#8c7964",lighting:"point",lightPosition:{x:-.09,y:3,z:.33},fog:.43,flatShading:!0,playArea:1.08,ground:"canyon",groundYScale:50,groundTexture:"none",groundColor:"#353535",groundColor2:"#454545",dressing:"hexagons",dressingAmount:300,dressingColor:"#fe921b",dressingScale:.5,dressingVariance:{x:2,y:8,z:2},dressingUniformScale:!0,dressingOnPlayArea:.03,grid:"none",gridColor:"#ccc",shadow:!1},threetowers:{active:!0,seed:5,skyType:"gradient",skyColor:"#23a06b",horizonColor:"#f5e170",lighting:"distant",lightPosition:{x:.5,y:1,z:0},fog:.8,flatShading:!1,playArea:1,ground:"spikes",groundYScale:4.26,groundTexture:"walkernoise",groundColor:"#273a49",groundColor2:"#2b464f",dressing:"towers",dressingAmount:3,dressingColor:"#5f6d94",dressingScale:50,dressingVariance:{x:10,y:100,z:10},dressingUniformScale:!0,dressingOnPlayArea:0,grid:"none",gridColor:"#239893",shadow:!1},poison:{active:!0,seed:92,skyType:"gradient",skyColor:"#1ea84a",horizonColor:"#177132",lighting:"distant",lightPosition:{x:.5,y:1,z:0},fog:.8,flatShading:!1,playArea:1,ground:"canyon",groundYScale:9.76,groundTexture:"none",groundColor:"#851f31",groundColor2:"#912235",dressing:"hexagons",dressingAmount:20,dressingColor:"#c7415b",dressingScale:20,dressingVariance:{x:20,y:200,z:20},dressingUniformScale:!1,dressingOnPlayArea:0,grid:"crosses",gridColor:"#1ea84a",shadow:!1},arches:{active:!0,seed:19,skyType:"atmosphere",skyColor:"#8cbdc8",horizonColor:"#ddd",lighting:"distant",lightPosition:{x:-.11,y:.16,z:.33},fog:.67,flatShading:!0,playArea:1,ground:"canyon",groundYScale:10,groundTexture:"walkernoise",groundColor:"#a87d6f",groundColor2:"#795449",dressing:"arches",dressingAmount:6,dressingColor:"#795449",dressingScale:26,dressingVariance:{x:20,y:40,z:20},dressingUniformScale:!0,dressingOnPlayArea:.04,grid:"none",gridColor:"#ccc",shadow:!1},tron:{active:!0,seed:14,skyType:"gradient",skyColor:"#091b39",horizonColor:"#284a9e",lighting:"distant",lightPosition:{x:-.72,y:.62,z:.4},fog:.8,flatShading:!1,playArea:1,ground:"spikes",groundYScale:4.91,groundTexture:"none",groundColor:"#061123",groundColor2:"#694439",dressing:"towers",dressingAmount:5,dressingColor:"#fb000e",dressingScale:15,dressingVariance:{x:20,y:20,z:20},dressingUniformScale:!0,dressingOnPlayArea:0,grid:"1x1",gridColor:"#fb000e",shadow:!1},japan:{active:!0,seed:14,skyType:"gradient",skyColor:"#7e5db5",horizonColor:"#b4adda",lighting:"distant",lightPosition:{x:1.33,y:1,z:.24},fog:.9,flatShading:!1,playArea:1,ground:"hills",groundYScale:25,groundTexture:"walkernoise",groundColor:"#7e5db5",groundColor2:"#cabdf5",dressing:"torii",dressingAmount:4,dressingColor:"#bc5e7c",dressingScale:15,dressingVariance:{x:0,y:0,z:0},dressingUniformScale:!0,dressingOnPlayArea:0,grid:"spots",gridColor:"#e4b676",shadow:!1},dream:{active:!0,seed:17,skyType:"gradient",skyColor:"#87faf4",horizonColor:"#b34093",lighting:"distant",lightPosition:{x:-.72,y:.53,z:.97},fog:.8,flatShading:!1,playArea:1,ground:"hills",groundYScale:20,groundTexture:"checkerboard",groundColor:"#b34093",groundColor2:"#c050a2",dressing:"mushrooms",dressingAmount:300,dressingColor:"#3cf7ed",dressingScale:.2,dressingVariance:{x:.2,y:.2,z:.2},dressingUniformScale:!0,dressingOnPlayArea:1,grid:"none",gridColor:"#239893",shadow:!1},volcano:{active:!0,seed:92,skyType:"gradient",skyColor:"#4a070f",horizonColor:"#f62300",lighting:"point",lightPosition:{x:.5,y:2.25,z:0},fog:.87,flatShading:!1,playArea:1,ground:"canyon",groundYScale:9.76,groundTexture:"walkernoise",groundColor:"#fb0803",groundColor2:"#510000",dressing:"arches",dressingAmount:15,dressingColor:"#fb0803",dressingScale:3,dressingVariance:{x:10,y:100,z:10},dressingUniformScale:!1,dressingOnPlayArea:.2,grid:"none",gridColor:"#fa0e00",shadow:!1},starry:{active:!0,seed:1,skyType:"atmosphere",skyColor:"#88c",horizonColor:"#ddd",lighting:"distant",lightPosition:{x:0,y:-.01,z:-.46},fog:.7,flatShading:!1,playArea:1,ground:"hills",groundYScale:3,groundTexture:"none",groundColor:"#553e35",groundColor2:"#694439",dressing:"none",dressingAmount:100,dressingColor:"#795449",dressingScale:5,dressingVariance:{x:1,y:1,z:1},dressingUniformScale:!0,grid:"1x1",dressingOnPlayArea:0,gridColor:"#39d2f2",shadow:!1},osiris:{active:!0,seed:46,skyType:"atmosphere",skyColor:"#88c",horizonColor:"#ddd",lighting:"distant",lightPosition:{x:0,y:.02,z:-.46},fog:0,flatShading:!1,playArea:1,ground:"hills",groundYScale:3,groundTexture:"none",groundColor:"#9e7b47",groundColor2:"#9e7b47",dressing:"pyramids",dressingAmount:7,dressingColor:"#9e7b47",dressingScale:5,dressingVariance:{x:30,y:30,z:30},dressingUniformScale:!0,grid:"dots",dressingOnPlayArea:0,gridColor:"#daa452",shadow:!1},moon:{active:!0,seed:11,skyType:"gradient",skyColor:"#000000",horizonColor:"#000000",lighting:"distant",lightPosition:{x:.5,y:1,z:0},fog:.8,flatShading:!0,playArea:1,ground:"canyon",groundYScale:9.76,groundTexture:"walkernoise",groundColor:"#D1D1D1",groundColor2:"#494949",dressing:"stones",dressingAmount:500,dressingColor:"#494949",dressingScale:.06,dressingVariance:{x:.2,y:.1,z:.2},dressingUniformScale:!0,dressingOnPlayArea:1,grid:"none",gridColor:"#239893",shadow:!1}},init:function(){for(var e in this.environmentData={},this.STAGE_SIZE=200,this.assets={arches:[{type:"mesh",vertices:[409,268,4,351,228,36,336,236,-57,-152,391,69,-135,358,88,-119,330,43,-20,358,-35,-153,357,-47,37,413,-26,-20,411,-14,-302,148,154,-339,121,-126,-389,200,-88,-477,193,-76,-314,346,-19,-314,306,-30,-250,296,-73,-267,237,-82,-212,303,-68,-245,200,-67,-223,304,108,-329,299,107,-289,350,76,-320,342,69,119,373,-39,38,370,8,113,367,52,492,202,-31,462,83,-104,447,71,-80,426,112,25,482,189,-7,222,372,6,121,402,41,87,382,67,221,346,55,559,93,-13,528,47,39,505,21,-111,528,54,-101,616,31,-53,442,256,-15,300,338,19,257,308,-79,408,256,-74,312,352,-26,384,297,-31,437,257,-47,-29,415,53,-232,377,59,-139,335,77,-132,344,2,-18,377,-37,-171,387,-28,-254,384,18,-651,-27,27,-435,-28,179,-345,149,165,-272,-28,23,-215,146,-2,-279,-29,-59,-211,145,-55,-337,-28,-128,-413,247,0,-293,363,24,-214,254,-36,-164,290,33,-284,150,94,-218,362,105,75,369,29,518,147,-63,447,190,-70,445,56,-105,391,185,-60,431,49,-33,459,83,26,470,162,42,130,390,53,167,341,-30,125,394,-45,239,368,-17,91,414,10,450,18,2,449,-27,-9,436,-28,-58,496,-27,-110,582,-28,-140,647,-27,-56,325,325,-45,-307,297,-56,-647,-28,-45,-188,310,-54,-264,197,113,-367,175,139,8,387,82,426,45,-55,114,359,-28,500,27,44,461,-29,13,-512,-27,-151,-152,376,-38,-490,-28,148,12,370,-28,442,160,42,465,194,32,381,183,-33,649,-27,-34,444,16,29,616,-28,25,417,267,-66,-132,352,-34,-322,-27,130,-271,86,-115,-635,-28,-121,-291,203,-99,176,405,-10,561,52,-93,371,305,9,311,237,-22,377,200,-81,-129,406,46,-154,371,99,-82,361,71,-21,354,26,-91,363,-27,-165,413,-12,-414,215,110,-238,127,26,-408,-28,-128,-674,-28,-94,-446,232,-39,-311,226,-90,-255,210,-61,-235,192,-11,-217,218,58,-269,299,124,-386,276,78,-399,281,42,15,373,58,16,393,75,549,107,-46,481,188,-68,409,120,-41,541,81,12,230,368,41,194,350,-50,224,361,-50,604,-28,-10,602,-27,35,486,56,-121,502,69,-120,457,-27,-110,226,317,-40,-584,-28,-124,439,-26,-30,467,-26,39,547,-27,-146,21,368,14,466,229,-29,578,-27,44,609,-27,-96,291,356,-15,290,306,34,255,321,28,231,311,-5,-251,386,50,-183,307,87,-152,307,24,-264,373,-12,-392,-27,190,-333,-28,84,-281,-27,54,-270,-28,-23,-308,-28,-101,-687,-27,-59,39,418,39,413,163,25,404,206,-90,54,400,-31,121,352,8,-454,41,148,-426,9,182,-564,115,3,-427,27,-107,-548,118,-32,-556,122,-53,-517,91,-101,-475,54,140,-461,52,-134,-558,119,-71,-434,286,59,-687,-31,52,-595,146,22,-670,-28,164,-537,166,122,-575,-28,217,-566,159,65,-470,152,136,-712,-29,102,-639,-29,211,-532,-30,181,-442,-30,-100],faces:[76,104,162,1,176,103,103,76,1,2,119,73,73,105,2,2,118,152,45,161,46,46,109,45,3,120,49,49,68,3,3,121,139,139,48,3,4,122,94,94,121,4,6,123,124,9,175,81,10,169,111,10,67,92,88,43,146,11,131,114,11,128,183,13,130,15,90,184,174,90,182,184,130,184,63,14,130,63,15,130,14,16,131,12,15,168,53,18,91,17,131,16,17,65,133,132,65,132,91,67,134,166,166,92,67,20,135,92,20,166,4,4,121,20,22,135,68,25,102,96,25,157,102,69,138,157,69,157,25,39,150,71,71,141,39,28,150,149,149,72,28,142,176,105,36,140,27,27,143,36,32,115,81,32,144,161,161,80,32,77,35,144,34,26,77,78,179,96,145,152,78,178,79,145,80,146,79,147,140,36,143,108,36,143,37,148,74,95,154,154,83,74,72,149,151,151,95,72,38,150,156,40,147,106,70,140,40,40,116,70,42,162,0,35,163,162,43,145,146,46,117,41,47,158,27,48,139,175,122,138,94,157,138,123,52,178,102,52,102,6,52,124,7,7,100,52,53,125,8,57,93,181,56,169,181,59,127,58,60,173,61,62,128,11,11,112,62,65,91,167,65,167,66,126,93,21,22,68,49,72,95,29,142,29,74,74,82,142,75,107,97,75,97,103,76,97,37,104,143,31,78,152,164,78,164,179,79,178,8,97,155,159,107,98,155,83,98,82,154,95,84,39,116,86,86,156,39,87,160,116,24,145,96,162,104,0,105,118,2,43,177,119,44,177,43,91,51,167,44,88,109,46,161,117,3,68,121,3,48,120,4,166,50,50,122,4,5,123,122,123,138,122,110,124,51,170,10,111,110,91,7,7,124,110,8,125,9,9,81,8,186,12,188,92,135,10,11,114,112,64,63,137,13,15,89,89,53,100,64,168,14,14,168,15,89,100,16,16,12,89,100,18,16,17,91,132,112,19,61,18,7,91,19,17,132,133,127,59,133,59,61,136,21,22,134,127,133,20,92,166,121,135,20,158,31,27,21,135,22,23,137,136,24,102,178,178,145,24,25,179,69,26,94,138,27,140,70,27,70,141,150,177,71,28,177,150,29,142,73,73,119,29,142,82,30,30,176,142,107,75,82,31,143,27,33,81,175,31,41,104,115,79,8,32,33,144,80,115,32,33,175,139,35,162,42,77,139,34,163,26,179,163,179,164,78,96,145,177,29,119,108,143,148,148,37,159,97,159,37,74,83,82,38,149,150,156,150,39,40,106,87,87,116,40,140,147,40,161,144,42,42,117,161,41,0,104,41,117,0,0,117,42,164,118,163,1,163,118,118,176,1,118,105,176,152,118,164,43,152,145,43,119,2,71,109,141,47,41,158,44,71,177,45,109,88,45,88,146,46,47,109,141,47,27,167,50,166,49,120,165,139,121,94,5,122,50,123,51,124,157,6,102,157,123,6,100,8,178,5,167,51,6,124,52,100,178,52,53,168,125,125,165,120,54,125,168,9,48,175,120,9,125,93,10,135,181,101,56,57,169,10,59,172,61,67,170,171,67,171,127,58,127,171,129,186,113,60,61,172,61,173,112,62,112,173,174,189,129,165,64,23,64,137,23,165,22,49,64,54,168,17,114,131,17,112,114,66,133,65,19,132,133,19,133,61,134,133,66,166,134,66,166,66,167,93,135,21,68,135,121,23,136,22,94,34,139,25,96,179,26,138,69,69,179,26,30,103,176,116,141,70,39,141,116,73,142,105,143,76,37,26,35,77,103,97,76,77,144,33,33,139,77,38,151,149,80,161,45,80,45,146,81,115,8,107,155,97,82,98,107,95,151,84,38,156,85,86,116,160,96,102,24,72,29,28,29,95,74,75,30,82,108,147,36,88,44,43,91,110,51,170,67,10,11,183,131,64,14,63,89,15,53,100,7,18,112,17,19,127,134,67,136,126,21,158,41,31,33,32,81,115,80,79,177,28,29,43,2,152,71,44,109,47,46,41,141,109,47,167,5,50,123,5,51,100,53,8,125,54,165,9,120,48,93,57,10,59,58,172,174,185,189,165,54,64,165,23,22,94,26,34,30,75,103,143,104,76,26,163,35,38,85,151,192,182,191,183,128,201,12,13,89,181,169,57,186,153,113,188,183,99,184,182,63,185,13,189,180,181,93,186,99,153,189,186,129,185,184,130,186,13,12,187,93,126,193,199,194,194,196,193,200,187,195,187,197,195,187,126,197,197,190,194,190,136,137,190,196,194,63,182,192,63,192,196,192,198,196,191,182,55,193,196,198,194,199,197,195,197,199,136,197,126,190,137,63,190,63,196,197,136,190,192,191,198,201,99,183,90,55,182,181,180,101,185,130,13,186,188,99,186,189,13,187,180,93,200,101,187,183,188,131,184,185,174,180,187,101,16,18,17,12,131,188,35,42,144,163,1,162,76,162,1,79,146,145]}],stones:[{type:"mesh",vertices:[-376,189,42,230,223,-310,353,162,-62,414,-23,-67,256,90,-475,24,85,-526,-418,-16,57,-432,66,-40,-199,151,-376,-155,49,467,-91,289,201,293,197,91,81,-17,-480,42,108,431,-359,-17,-250,383,-19,-243,194,-15,270,-272,180,293,-86,212,262,234,54,297,395,97,-302,-123,-21,-444,-416,-19,-123,-323,-18,267,-100,-16,429,-300,96,-361,163,-19,409,118,201,-431,-241,-18,391,-130,274,-309,306,-19,-399,-221,96,404],faces:[31,18,17,0,17,18,3,20,2,18,11,10,29,27,8,27,29,1,0,18,10,10,29,0,16,19,26,11,2,1,20,30,4,20,3,15,30,12,4,4,12,5,5,27,4,4,27,20,21,25,5,7,8,25,22,7,14,7,25,14,23,28,31,0,7,17,24,26,9,31,28,9,8,27,5,2,20,1,13,19,18,10,11,1,19,13,26,3,11,19,19,16,3,11,3,2,11,18,19,20,15,30,29,10,1,25,21,14,8,5,25,5,12,21,6,7,22,7,6,23,8,0,29,8,7,0,23,31,7,13,31,9,18,31,13,9,28,24,26,13,9,27,1,20,7,31,17]},{type:"mesh",vertices:[-217,34,-153,198,90,20,212,85,169,-131,93,171,197,113,30,173,121,164,315,29,-16,219,24,189,282,50,-102,232,38,-181,-195,-9,-166,-156,30,-207,-51,-9,-231,-180,91,-173,-19,73,-204,-280,23,96,-242,100,107,3,158,-82,109,88,221,275,-10,-40,236,-10,-135,-178,49,184,-1,-10,-243,265,-11,109,-12,-9,237,-36,46,251,-233,86,-81,93,77,-171,-163,133,69,18,16,263,296,44,93,131,-12,-226,-89,-10,-201,-273,-10,-51,-240,-9,110,190,-12,192,-253,-11,-92,42,43,-258,-115,-11,238,168,99,-88,-285,-10,24,71,124,-158,298,-10,10,116,150,-24,-282,44,39],faces:[44,16,26,13,26,16,0,26,13,27,14,41,4,5,1,7,30,2,28,5,43,41,39,27,17,43,41,43,4,39,13,28,17,17,41,13,28,43,17,24,29,38,29,35,7,18,25,29,5,18,2,18,5,3,30,42,6,30,35,23,19,20,8,8,20,9,9,39,8,1,30,8,31,37,9,11,14,37,14,27,37,32,11,12,11,37,12,11,0,13,33,40,44,44,26,33,33,0,36,34,38,15,44,40,15,21,3,16,27,39,9,2,30,1,21,25,3,16,3,28,28,3,5,4,43,5,41,43,39,13,16,28,25,21,38,38,29,25,7,18,29,29,24,35,18,7,2,18,3,25,30,23,42,30,7,35,8,30,6,6,19,8,6,42,19,8,39,1,37,31,22,27,9,37,9,20,31,10,11,32,11,10,0,12,37,22,14,13,41,14,11,13,33,26,0,36,0,10,21,44,15,16,44,21,15,40,34,38,21,15,4,1,39,5,2,1]},{type:"mesh",vertices:[-101,102,57,99,35,102,40,72,80,59,14,-168,-186,22,45,-176,25,-30,66,-7,146,153,-7,53,-110,47,-96,-90,-8,-146,150,-7,-12,-200,-7,8,-173,-7,-55,55,46,-60,125,-7,110,136,30,-10,-149,58,68,-15,82,-71,98,-7,-86,-34,-6,-194,-33,-7,171,-36,65,137,38,-8,-192,-103,-9,147,-12,62,-152],faces:[2,17,0,17,8,0,17,24,8,19,24,22,5,11,4,2,13,17,17,13,24,21,23,20,1,2,21,7,15,1,7,10,15,5,9,12,15,18,13,0,5,16,0,8,5,1,15,2,10,18,15,3,13,18,24,3,22,11,23,4,4,16,5,16,4,23,24,13,3,15,13,2,6,1,21,6,21,20,6,14,1,2,0,21,1,14,7,3,18,22,8,24,19,8,19,9,12,11,5,5,8,9,16,23,21,16,21,0]},{type:"mesh",vertices:[86,55,-18,58,38,73,97,-12,79,135,7,10,-93,-11,-72,-133,5,33,13,68,-32,94,-11,-57,-90,52,53,-24,-11,-106,-13,-10,104,-75,49,-69,-12,18,114,49,-12,-96,-46,-11,-85,-119,-11,-26,48,5,-111,-58,-11,105,-117,-12,52,-5,35,-93,123,-11,7],faces:[5,8,11,2,3,1,8,1,6,11,8,6,6,19,11,10,12,17,20,7,3,3,7,16,16,0,3,16,9,19,14,4,9,15,18,5,5,11,15,18,17,5,19,0,16,1,3,0,0,6,1,19,6,0,12,8,17,2,1,12,12,10,2,1,8,12,3,2,20,16,13,9,16,7,13,19,4,11,15,11,4,17,8,5,9,4,19]}],torii:[{type:"mesh",mirror:!0,flatShading:!0,vertices:[692,966,-52,661,834,-52,692,966,52,661,834,52,0,894,-52,0,776,-52,0,894,52,0,776,52,518,935,52,345,913,52,170,899,52,162,779,52,328,790,52,494,808,52,170,899,-52,345,913,-52,518,935,-52,494,808,-52,328,790,-52,162,779,-52,0,618,16,0,697,16,0,618,-16,0,697,-16,586,618,16,586,697,16,586,618,-16,586,697,-16,331,-29,-75,331,766,-52,369,-29,-65,357,766,-45,396,-29,-37,377,766,-26,406,-29,0,384,766,0,396,-29,37,377,766,26,369,-29,65,357,766,45,331,-29,75,331,766,52,294,-29,65,305,766,45,267,-29,37,286,766,26,257,-29,0,279,766,0,267,-29,-37,286,766,-26,294,-29,-65,305,766,-45,0,777,85,0,681,33,333,762,-75,333,806,-75,371,762,-65,371,806,-65,398,762,-37,398,806,-37,408,762,0,408,806,0,398,762,37,398,806,37,371,762,65,371,806,65,333,762,75,333,806,75,296,762,65,296,806,65,268,762,37,268,806,37,258,762,0,258,806,0,268,762,-37,268,806,-37,296,762,-65,296,806,-65,0,681,-33,0,777,-85,52,681,33,52,777,85,52,681,-33,52,777,-85],faces:[4,10,14,1,13,17,11,6,7,0,3,1,16,1,17,4,19,5,14,18,19,15,17,18,3,8,13,13,9,12,12,10,11,19,7,5,19,12,11,18,13,12,16,2,0,15,8,16,14,9,15,23,26,22,27,24,26,25,20,24,26,20,22,23,25,27,29,30,28,31,32,30,33,34,32,35,36,34,37,38,36,39,40,38,41,42,40,43,44,42,45,46,44,47,48,46,49,50,48,51,28,50,55,56,54,57,58,56,59,60,58,61,62,60,63,64,62,79,81,83,65,66,64,82,53,78,67,68,66,81,53,80,69,70,68,83,80,82,71,72,70,79,82,78,73,74,72,75,63,59,75,76,74,77,54,76,60,68,76,4,6,10,1,3,13,11,10,6,0,2,3,16,0,1,4,14,19,14,15,18,15,16,17,3,2,8,13,8,9,12,9,10,19,11,7,19,18,12,18,17,13,16,8,2,15,9,8,14,10,9,23,27,26,27,25,24,25,21,20,26,24,20,23,21,25,29,31,30,31,33,32,33,35,34,35,37,36,37,39,38,39,41,40,41,43,42,43,45,44,45,47,46,47,49,48,49,51,50,51,29,28,55,57,56,57,59,58,59,61,60,61,63,62,63,65,64,79,52,81,65,67,66,82,80,53,67,69,68,81,52,53,69,71,70,83,81,80,71,73,72,79,83,82,73,75,74,59,57,55,55,77,75,75,73,71,71,69,75,67,65,63,63,61,59,59,55,75,75,69,67,67,63,75,75,77,76,77,55,54,76,54,56,56,58,76,60,62,68,64,66,68,68,70,72,72,74,68,76,58,60,62,64,68,68,74,76]}],hexagons:[{type:"extrude",vertices:[-.198,-.302,.197,-.3,.372,0,.199,.298,-.202,.298,-.368,0]}],towers:[{type:"extrude",vertices:[-.054,-.178,-.007,-.182,.069,-.027,.189,.079,.178,.124,-.007,.097,-.145,.182,-.178,.144,-.079,-.021]},{type:"lathe",segments:4,vertices:[.004,.02,.012,.092,.042,.166,.067,.55,.101,.594,.105,.838,.193,.934,.18,.994]},{type:"lathe",segments:5,vertices:[.069,.216,.067,.562,.126,.562,.128,.774,.191,.774,.193,.986]}],trees:[{type:"lathe",noise:.015,segments:6,vertices:[1e-6,.826,.054,.832,.105,.854,.136,.9,.136,.958,.118,.994]},{type:"lathe",noise:.015,segments:14,vertices:[1e-6,.01,.069,.022,.13,.068,.178,.18,.189,.32,.191,.59,.193,.75,.138,.79,.018,.808,.018,.996]},{type:"lathe",noise:.015,segments:14,vertices:[1e-6,.436,.126,.46,.201,.57,.219,.72,.154,.846,.028,.884,.034,.996]}],apparatus:[{type:"lathe",segments:10,vertices:[1e-6,.23,.042,.23,.069,.36,.038,.362,.038,.372,.06,.372,.073,.572,.024,.572,.024,.67,.069,.67,.075,.722,.097,.724,.105,.852,.083,.902,.065,.902,.065,.924,.128,.924,.146,.996]},{type:"lathe",segments:16,vertices:[1e-6,.232,.229,.182,.486,.07,.356,.182,.213,.242,.154,.242,.144,.262,.178,.262,.126,.314,.04,.328,.038,.374,.058,.374,.071,.408,.026,.406,.03,.42,.091,.418,.034,.496,.01,.498,.03,.506,.014,.998]}],mushrooms:[{type:"lathe",noise:.02,segments:14,vertices:[1e-6,.006,.13,.018,.341,.084,.437,.144,.492,.234,.484,.246,.276,.232,.107,.284,.046,.346,.062,.852,.097,.956,.166,.998]},{type:"lathe",noise:.02,segments:10,vertices:[1e-6,.562,.091,.572,.172,.61,.223,.666,.256,.74,.258,.806,.246,.824,.062,.826,.065,.948,.097,.998]},{type:"lathe",noise:.02,segments:10,vertices:[1e-6,.768,.099,.772,.219,.802,.306,.844,.352,.886,.352,.908,.118,.904,.107,.93,.115,.966,.14,.996]}]},this.assets)for(var t=0;t<this.assets[e].length;t++){var i=this.assets[e][t];if("mesh"==i.type)for(var n=0,r=i.vertices.length;n<r;n++)i.vertices[n]/=1e3}this.userFog=this.el.sceneEl.getAttribute("fog"),this.sky=document.createElement("a-sky"),this.sky.setAttribute("radius",this.STAGE_SIZE),this.sky.setAttribute("theta-length",110),this.sky.classList.add("environment"),this.stars=null,this.groundMaterial=null,this.ground=document.createElement("a-entity"),this.ground.setAttribute("rotation","-90 0 0"),this.ground.classList.add("environmentGround"),this.ground.classList.add("environment"),this.groundCanvas=null,this.groundTexture=null,this.groundMaterial=null,this.groundGeometry=null,this.dressing=document.createElement("a-entity"),this.dressing.classList.add("environmentDressing"),this.dressing.classList.add("environment"),this.gridCanvas=null,this.gridTexture=null,this.hemilight=document.createElement("a-entity"),this.hemilight.classList.add("environment"),this.hemilight.setAttribute("position","0 50 0"),this.hemilight.setAttribute("light",{type:"hemisphere",color:"#CEE4F0",intensity:.4}),this.sunlight=document.createElement("a-entity"),this.sunlight.classList.add("environment"),this.sunlight.setAttribute("position",this.data.lightPosition),this.sunlight.setAttribute("light",{intensity:.6}),this.el.appendChild(this.hemilight),this.el.appendChild(this.sunlight),this.el.appendChild(this.ground),this.el.appendChild(this.dressing),this.el.appendChild(this.sky)},getFogColor:function(e,t){var i;if("color"==e||"none"==e)i=new THREE.Color(this.environmentData.skyColor);else if("gradient"==e)i=new THREE.Color(this.environmentData.horizonColor);else if("atmosphere"==e){var n=[1,.5,.22,.1,.05,0],r=["#C0CDCF","#81ADC5","#525e62","#2a2d2d","#141616","#000"];if(t<=0)return"#000";t=Math.min(1,t);for(var o=0;o<n.length;o++)if(t>n[o]){var s=new THREE.Color(r[o-1]),a=new THREE.Color(r[o]),l=(t-n[o])/(n[o-1]-n[o]);a.lerp(s,l),i=a;break}}return i.multiplyScalar(.9),i.lerp(new THREE.Color(this.data.groundColor),.3),"#"+i.getHexString()},update:function(e){var t;this.data.preset?(t=AFRAME.utils.clone(this.environmentData),this.environmentData={},Object.assign(this.environmentData,this.data),Object.assign(this.environmentData,this.presets[this.data.preset]),Object.assign(this.environmentData,this.el.components.environment.attrValue),console.log(this.environmentData)):(t=e,this.environmentData=this.data);var i=this.environmentData.skyType,n=new THREE.Vector3(this.environmentData.lightPosition.x,this.environmentData.lightPosition.y,this.environmentData.lightPosition.z);if(n.normalize(),this.sunlight){if(this.sunlight.setAttribute("position",this.environmentData.lightPosition),"atmosphere"!=i){var r=new THREE.Color(this.environmentData.skyColor);r.r=(r.r+1)/2,r.g=(r.g+1)/2,r.b=(r.b+1)/2,this.hemilight.setAttribute("light",{color:"#"+r.getHexString()}),this.sunlight.setAttribute("light",{intensity:.6}),this.hemilight.setAttribute("light",{intensity:.6})}else this.sunlight.setAttribute("light",{intensity:.1+.5*n.y}),this.hemilight.setAttribute("light",{intensity:.1+.5*n.y});this.sunlight.setAttribute("light",{castShadow:this.environmentData.shadow,shadowCameraLeft:-this.environmentData.shadowSize,shadowCameraBottom:-this.environmentData.shadowSize,shadowCameraRight:this.environmentData.shadowSize,shadowCameraTop:this.environmentData.shadowSize})}if(i!==t.skyType||this.environmentData.skyColor!=t.skyColor||this.environmentData.horizonColor!=t.horizonColor){var o={};o.shader={none:"flat",color:"flat",gradient:"gradientshader",atmosphere:"skyshader"}[i],this.stars&&this.stars.setAttribute("visible","atmosphere"==i),"color"==i?(o.color=this.environmentData.skyColor,o.fog=!1):"gradient"==i&&(o.topColor=this.environmentData.skyColor,o.bottomColor=this.environmentData.horizonColor),this.sky.setAttribute("material",o)}"atmosphere"==i&&(this.sky.setAttribute("material",{sunPosition:n}),this.setStars(2e3*(1-Math.max(0,8*(n.y+.08))))),this.environmentData.fog>0?this.el.sceneEl.setAttribute("fog",{color:this.getFogColor(i,n.y),far:(1.01-this.environmentData.fog)*this.STAGE_SIZE*2}):this.el.sceneEl.removeAttribute("fog"),this.sunlight.setAttribute("light",{type:"point"==this.environmentData.lighting?"point":"directional"}),this.sunlight.setAttribute("visible","none"!==this.environmentData.lighting),this.hemilight.setAttribute("visible","none"!==this.environmentData.lighting);var s=!this.groundGeometry||this.environmentData.seed!=t.seed||this.environmentData.ground!=t.ground||this.environmentData.playArea!=t.playArea||this.environmentData.flatShading!=t.flatShading;(s||this.environmentData.groundColor!=t.groundColor||this.environmentData.groundColor2!=t.groundColor2||this.environmentData.groundYScale!=t.groundYScale||this.environmentData.groundTexture!=t.groundTexture||this.environmentData.gridColor!=t.gridColor||this.environmentData.grid!=t.grid)&&(this.updateGround(s),this.hemilight&&this.hemilight.setAttribute("light",{groundColor:this.environmentData.groundColor})),this.environmentData.seed==t.seed&&this.environmentData.dressingOnPlayArea==t.dressingOnPlayArea&&this.environmentData.dressing==t.dressing&&this.environmentData.flatShading==t.flatShading&&this.environmentData.dressingAmount==t.dressingAmount&&this.environmentData.dressingScale==t.dressingScale&&this.environmentData.dressingColor==t.dressingColor&&this.environmentData.dressingVariance.x==t.dressingVariance.x&&this.environmentData.dressingVariance.y==t.dressingVariance.y&&this.environmentData.dressingVariance.z==t.dressingVariance.z&&this.environmentData.dressingUniformScale==t.dressingUniformScale||this.updateDressing(),this.sky.setAttribute("visible","none"!==i),this.el.setAttribute("visible",this.environmentData.active),this.environmentData.active||(this.userFog?this.el.sceneEl.setAttribute("fog",this.userFog):this.el.sceneEl.removeAttribute("fog")),this.dumpParametersDiff()},logPreset:function(){var e="{";for(var t in this.schema)if("preset"!=t){e+=t+": ";var i=this.schema[t].type;e+="vec3"==i?"{ x: "+this.environmentData[t].x+", y: "+this.environmentData[t].y+", z: "+this.environmentData[t].z+"}":"string"==i||"color"==i?'"'+this.environmentData[t]+'"':this.environmentData[t],e+=", "}e+="}",console.log(e)},dumpParametersDiff:function(){function e(e){return Math.floor(1e3*e)/1e3}var t=[],i="none"!=this.data.preset&&this.presets[this.data.preset];for(var n in i&&t.push("preset: "+this.data.preset),this.schema)if(!("preset"==n||i&&void 0===i[n])){var r=i?i[n]:this.schema[n].default,o=this.environmentData[n];if("vec3"==this.schema[n].type){var s=r;"string"==typeof r&&(s={x:(r=r.split(" "))[0],y:r[1],z:r[2]}),e(s.x)==e(o.x)&&e(s.y)==e(o.y)&&e(s.z)==e(o.z)||t.push(n+": "+e(o.x)+" "+e(o.y)+" "+e(o.z))}else r!=o&&("number"==this.schema[n].type&&(o=e(o)),t.push(n+": "+o))}console.log("%c"+t.join("; "),"color: #f48;font-weight:bold")},random:function(e){return parseFloat("0."+Math.sin(9999*this.environmentData.seed*e).toString().substr(7))},updateGround:function(t){if(t){var i="none"!=this.environmentData.ground;if(this.ground.setAttribute("visible",i),!i)return;this.groundGeometry||(this.groundGeometry=new THREE.PlaneGeometry(this.STAGE_SIZE+2,this.STAGE_SIZE+2,63,63));for(var n=new e(this.environmentData.seed),r=this.groundGeometry.attributes.position.array,o=r.length,s=10/64,a=0,l=0,c=2;c<o;c+=3)if("flat"!=this.environmentData.ground){var h;switch(this.environmentData.ground){case"hills":h=Math.max(0,n.noise(a,l,0));break;case"canyon":h=.2+.8*n.noise(a,l,0),h=Math.min(1,10*Math.pow(h,2));break;case"spikes":h=this.random(c)<.02?this.random(c+1):0;break;case"noise":h=this.random(c)<.35?this.random(c+1):0}h+=.1*this.random(c+2);var u=2*a/10-1,d=2*l/10-1,p=this.environmentData.playArea;(h*=(u=Math.max(0,Math.min(1,(Math.abs(u)-(p-.9))*(1/p))))>(d=Math.max(0,Math.min(1,(Math.abs(d)-(p-.9))*(1/p))))?u:d)<.01&&(h=0),r[c]=h,(a+=s)>=10&&(a=0,l+=s)}else r[c]=0;this.groundGeometry.computeVertexNormals(),this.groundGeometry.attributes.position.needsUpdate=!0,this.groundGeometry.attributes.normal.needsUpdate=!0}this.ground.setAttribute("scale",{z:this.environmentData.groundYScale});var f=2048,m=this.STAGE_SIZE/20;this.groundCanvas&&this.groundCanvas.width==f||(this.gridCanvas=document.createElement("canvas"),this.gridCanvas.width=f,this.gridCanvas.height=f,this.gridTexture=new THREE.Texture(this.gridCanvas),this.gridTexture.wrapS=THREE.RepeatWrapping,this.gridTexture.wrapT=THREE.RepeatWrapping,this.gridTexture.repeat.set(m,m),this.groundCanvas=document.createElement("canvas"),this.groundCanvas.width=f,this.groundCanvas.height=f,this.groundTexture=new THREE.Texture(this.groundCanvas),this.groundTexture.wrapS=THREE.RepeatWrapping,this.groundTexture.wrapT=THREE.RepeatWrapping,this.groundTexture.repeat.set(m,m),this.groundMaterialProps={map:this.groundTexture,emissive:new THREE.Color(16777215),emissiveMap:this.gridTexture},(new THREE.Material).hasOwnProperty("shading")?this.groundMaterialProps.shading=this.environmentData.flatShading?THREE.FlatShading:THREE.SmoothShading:this.groundMaterialProps.flatShading=this.environmentData.flatShading,this.groundMaterial=new THREE.MeshLambertMaterial(this.groundMaterialProps));var g=this.groundCanvas.getContext("2d"),v=this.gridCanvas.getContext("2d");if(this.drawTexture(g,f,20),v.fillStyle="#000000",v.fillRect(0,0,f,f),this.drawGrid(v,f,20),this.groundTexture.needsUpdate=!0,this.gridTexture.needsUpdate=!0,t){var y=new THREE.Mesh(this.groundGeometry,this.groundMaterial);this.ground.setObject3D("mesh",y)}else this.ground.getObject3D("mesh").material=this.groundMaterial;this.ground.setAttribute("shadow",{cast:!1,receive:this.environmentData.shadow})},drawGrid:function(e,t,i){if("none"!=this.environmentData.grid){var n,r,o,s=Math.floor(i/2),a=t/(i/2);switch(e.fillStyle=this.environmentData.gridColor,this.environmentData.grid){case"1x1":case"2x2":for("1x1"==this.environmentData.grid&&(s*=2,a=t/i),n=0;n<s;n++)o=Math.floor(n*a),e.fillRect(0,o,t,1),e.fillRect(o,0,1,t);break;case"crosses":var l=Math.floor(a/20);for(n=0;n<s+1;n++)for(o=Math.floor(n*a),r=0;r<s+1;r++){var c=Math.floor(r*a-l);e.fillRect(c,o,2*l,1),e.fillRect(o,c,1,2*l)}break;case"dots":for(n=0;n<s+1;n++)for(r=0;r<s+1;r++)e.beginPath(),e.arc(Math.floor(r*a),Math.floor(n*a),4,0,2*Math.PI),e.fill();break;case"xlines":for(n=0;n<s;n++)e.fillRect(Math.floor(n*a),0,1,t);break;case"ylines":for(n=0;n<s;n++)e.fillRect(0,Math.floor(n*a),t,1)}}},drawTexture:function(t,i,n){var r,o,s,a,l,c,h;if(t.fillStyle=this.environmentData.groundColor,t.fillRect(0,0,i,i),"none"!=this.environmentData.groundTexture)switch(this.environmentData.groundTexture){case"checkerboard":t.fillStyle=this.environmentData.groundColor2;var u=Math.floor(n/2),d=i/(n/2);for(r=0;r<u+1;r+=2)for(var p=0;p<u+1;p++)t.fillRect(Math.floor((r+p%2)*d),Math.floor(p*d),Math.floor(d),Math.floor(d));break;case"squares":var f=i/16;for(s=new THREE.Color(this.environmentData.groundColor),a=new THREE.Color(this.environmentData.groundColor2),r=0;r<256;r++)(o=this.random(r+3)>.5?s.clone():a.clone()).addScalar(.1*this.random(r+3)-.05),t.fillStyle="#"+o.getHexString(),t.fillRect(r%16*f,Math.floor(r/16)*f,f,f);break;case"noise":l=(c=t.getImageData(0,0,i,i)).data,s=new THREE.Color(this.environmentData.groundColor),a=new THREE.Color(this.environmentData.groundColor2);var m=new THREE.Color(a.r-s.r,a.g-s.g,a.b-s.b),g=new e;for(r=0,p=0,h=l.length;r<h;r+=4,p++){var v=g.noise(p%i/i*3,p/i/i*3,0);l[r+0]=Math.floor(255*(s.r+m.r*v)),l[r+1]=Math.floor(255*(s.g+m.g*v)),l[r+2]=Math.floor(255*(s.b+m.b*v))}t.putImageData(c,0,0);break;case"walkernoise":var y=Math.floor(i/2),b=document.createElement("canvas");b.width=y,b.height=y;var E=b.getContext("2d");E.fillStyle=this.environmentData.groundColor,E.fillRect(0,0,y,y),l=(c=E.getImageData(0,0,y,y)).data,s=new THREE.Color(this.environmentData.groundColor),a=new THREE.Color(this.environmentData.groundColor2);var x=[];for(r=0;r<1e3;r++)o=s.clone().lerp(a,Math.random()),x.push({x:Math.random()*y,y:Math.random()*y,r:Math.floor(255*o.r),g:Math.floor(255*o.g),b:Math.floor(255*o.b)});for(var w=0;w<5e3;w++)for(r=0;r<1e3;r++){var T=x[r],k=4*Math.floor(T.y*y+T.x);l[k+0]=T.r,l[k+1]=T.g,l[k+2]=T.b,T.x+=Math.floor(3*Math.random())-1,T.y+=Math.floor(3*Math.random())-1,T.x>=y&&(T.x=T.x-y),T.y>=y&&(T.y=T.y-y),T.x<0&&(T.x=y+T.x),T.y<0&&(T.y=y+T.y)}E.putImageData(c,0,0),t.drawImage(b,0,0,i,i)}},getAssetGeometry:function(e){if(!e)return null;var t,i,n,r=[],o=this;function s(e,t){new THREE.Vector3;for(var i=e.attributes.position.array,n=i.length,r=0;r<n;r+=3)i[r]=(o.random(r)-.5)*t,i[r+1]=(o.random(r+n)-.5)*t,i[r+2]=(o.random(r+2*n)-.5)*t;e.attributes.position.needsUpdate=!0}for(var a=0;a<e.length;a++)if("lathe"==e[a].type){var l=-99999,c=[];for(n=e[a].vertices,t=0;t<n.length;t+=2)c.push(new THREE.Vector2(n[t],n[t+1])),n[t+1]>l&&(l=n[t+1]);(i=new THREE.LatheGeometry(c,e[a].segments||8)).applyMatrix4((new THREE.Matrix4).makeRotationFromEuler(new THREE.Euler(-Math.PI,0,0))),i.applyMatrix4((new THREE.Matrix4).makeTranslation(0,l,0)),i=i.toNonIndexed(),r.push(i)}else if("extrude"==e[a].type){var h=new THREE.Shape;for(n=e[a].vertices,t=0;t<n.length;t+=2)0==t?h.moveTo(n[t],n[t+1]):h.lineTo(n[t],n[t+1]);(i=new THREE.ExtrudeGeometry(h,{amount:1,bevelEnabled:!1})).applyMatrix((new THREE.Matrix4).makeRotationFromEuler(new THREE.Euler(-Math.PI/2,0,0))),e[a].noise&&s(i,e[a].noise),r.push(i)}else if("mesh"==e[a].type){i=new THREE.BufferGeometry,n=e[a].vertices;var u=e[a].faces,d=new Float32Array(n);if(i.setIndex(u),i.setAttribute("position",new THREE.BufferAttribute(d,3)),e[a].mirror){var p=i.clone();p.applyMatrix4((new THREE.Matrix4).makeRotationFromEuler(new THREE.Euler(0,Math.PI,0))),i=THREE.BufferGeometryUtils.mergeBufferGeometries([i,p])}e[a].noise&&s(i,e[a].noise),(i=i.toNonIndexed()).computeVertexNormals(),r.push(i)}return r},updateDressing:function(){var e=new THREE.Object3D,t=[];if(this.dressing.setAttribute("visible","none"!=this.environmentData.dressing),"none"!=this.environmentData.dressing){var i;switch(this.environmentData.dressing){case"cubes":(i=[new THREE.BoxGeometry(1,1,1)])[0].applyMatrix((new THREE.Matrix4).makeTranslation(0,.5,0));break;case"pyramids":(i=[new THREE.ConeGeometry(1,1,4,1,!0)])[0].applyMatrix((new THREE.Matrix4).makeTranslation(0,.5,0));break;case"cylinders":(i=[new THREE.CylinderGeometry(.5,.5,1,8,1,!0)])[0].applyMatrix((new THREE.Matrix4).makeTranslation(0,.5,0));break;default:if(!(i=this.getAssetGeometry(this.assets[this.environmentData.dressing])))return}for(var n=0,r=88343;n<this.environmentData.dressingAmount;n++,r++){i[Math.floor(this.random(33+n)*i.length)].clone;var o,s=i[Math.floor(this.random(33+n)*i.length)].clone(),a=this.environmentData.dressingScale,l=new THREE.Vector3(this.environmentData.dressingVariance.x,this.environmentData.dressingVariance.y,this.environmentData.dressingVariance.z);o=this.random(r)<this.environmentData.dressingOnPlayArea?15*this.random(r+1):10+Math.max(l.x,l.z)+10*this.random(r+1)+this.random(r+2)*this.STAGE_SIZE/3;var c=this.random(r+3)*Math.PI*2,h=new THREE.Matrix4,u=this.random(r+4),d=this.environmentData.dressingUniformScale;h.compose(new THREE.Vector3(Math.cos(c)*o,0,Math.sin(c)*o),(new THREE.Quaternion).setFromAxisAngle(new THREE.Vector3(0,1,0),(this.random(r+5)-.5)*l.length()*Math.PI*2),new THREE.Vector3(a+(d?u:this.random(r+6))*l.x,a+(d?u:this.random(r+7))*l.y,a+(d?u:this.random(r+8))*l.z)),s.applyMatrix4(h),t.push(s)}var p=THREE.BufferGeometryUtils.mergeBufferGeometries(t);p.attributes.position.needsUpdate=!0;var f=new THREE.MeshLambertMaterial({color:new THREE.Color(this.environmentData.dressingColor)}),m=new THREE.Mesh(p,f);e.add(m),this.dressing.setObject3D("mesh",e)}},createStars:function(){for(var e=new THREE.BufferGeometry,t=new Float32Array(6e3),i=this.STAGE_SIZE-1,n=new THREE.Vector3,r=0;r<t.length;r+=3)n.set(this.random(r+23)-.5,this.random(r+24),this.random(r+25)-.5),n.normalize(),n.multiplyScalar(i),t[r]=n.x,t[r+1]=n.y,t[r+2]=n.z;e.setAttribute("position",new THREE.BufferAttribute(t,3)),e.setDrawRange(0,0);var o=new THREE.PointsMaterial({size:.01,color:13421772,fog:!1});this.stars.setObject3D("mesh",new THREE.Points(e,o))},setStars:function(e){this.stars||(this.stars=document.createElement("a-entity"),this.stars.id="stars",this.createStars(),this.el.appendChild(this.stars)),e=Math.floor(Math.min(2e3,Math.max(0,e))),this.stars.getObject3D("mesh").geometry.setDrawRange(0,e)}}),AFRAME.registerShader("skyshader",{schema:{luminance:{type:"number",default:1,min:0,max:2,is:"uniform"},turbidity:{type:"number",default:2,min:0,max:20,is:"uniform"},reileigh:{type:"number",default:1,min:0,max:4,is:"uniform"},mieCoefficient:{type:"number",default:.005,min:0,max:.1,is:"uniform"},mieDirectionalG:{type:"number",default:.8,min:0,max:1,is:"uniform"},sunPosition:{type:"vec3",default:{x:0,y:0,z:-1},is:"uniform"},color:{type:"color",default:"#fff"}},vertexShader:["varying vec3 vWorldPosition;","void main() {","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vWorldPosition = worldPosition.xyz;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D skySampler;","uniform vec3 sunPosition;","varying vec3 vWorldPosition;","vec3 cameraPos = vec3(0., 0., 0.);","uniform float luminance;","uniform float turbidity;","uniform float reileigh;","uniform float mieCoefficient;","uniform float mieDirectionalG;","const float e = 2.71828182845904523536028747135266249775724709369995957;","const float pi = 3.141592653589793238462643383279502884197169;","const float n = 1.0003;","const float N = 2.545E25;","const float pn = 0.035;","const vec3 lambda = vec3(680E-9, 550E-9, 450E-9);","const vec3 K = vec3(0.686, 0.678, 0.666);","const float v = 4.0;","const float rayleighZenithLength = 8.4E3;","const float mieZenithLength = 1.25E3;","const vec3 up = vec3(0.0, 1.0, 0.0);","const float EE = 1000.0;","const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;","const float cutoffAngle = pi/1.95;","const float steepness = 1.5;","vec3 totalRayleigh(vec3 lambda)","{","return (8.0 * pow(pi, 3.0) * pow(pow(n, 2.0) - 1.0, 2.0) * (6.0 + 3.0 * pn)) / (3.0 * N * pow(lambda, vec3(4.0)) * (6.0 - 7.0 * pn));","}","vec3 simplifiedRayleigh()","{","return 0.0005 / vec3(94, 40, 18);","}","float rayleighPhase(float cosTheta)","{   ","return (3.0 / (16.0*pi)) * (1.0 + pow(cosTheta, 2.0));","}","vec3 totalMie(vec3 lambda, vec3 K, float T)","{","float c = (0.2 * T ) * 10E-18;","return 0.434 * c * pi * pow((2.0 * pi) / lambda, vec3(v - 2.0)) * K;","}","float hgPhase(float cosTheta, float g)","{","return (1.0 / (4.0*pi)) * ((1.0 - pow(g, 2.0)) / pow(1.0 - 2.0*g*cosTheta + pow(g, 2.0), 1.5));","}","float sunIntensity(float zenithAngleCos)","{","return EE * max(0.0, 1.0 - exp(-((cutoffAngle - acos(zenithAngleCos))/steepness)));","}","// Filmic ToneMapping http://filmicgames.com/archives/75","float A = 0.15;","float B = 0.50;","float C = 0.10;","float D = 0.20;","float E = 0.02;","float F = 0.30;","float W = 1000.0;","vec3 Uncharted2Tonemap(vec3 x)","{","return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;","}","void main() ","{","float sunfade = 1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);","float reileighCoefficient = reileigh - (1.0* (1.0-sunfade));","vec3 sunDirection = normalize(sunPosition);","float sunE = sunIntensity(dot(sunDirection, up));","vec3 betaR = simplifiedRayleigh() * reileighCoefficient;","vec3 betaM = totalMie(lambda, K, turbidity) * mieCoefficient;","float zenithAngle = acos(max(0.0, dot(up, normalize(vWorldPosition - cameraPos))));","float sR = rayleighZenithLength / (cos(zenithAngle) + 0.15 * pow(93.885 - ((zenithAngle * 180.0) / pi), -1.253));","float sM = mieZenithLength / (cos(zenithAngle) + 0.15 * pow(93.885 - ((zenithAngle * 180.0) / pi), -1.253));","vec3 Fex = exp(-(betaR * sR + betaM * sM));","float cosTheta = dot(normalize(vWorldPosition - cameraPos), sunDirection);","float rPhase = rayleighPhase(cosTheta*0.5+0.5);","vec3 betaRTheta = betaR * rPhase;","float mPhase = hgPhase(cosTheta, mieDirectionalG);","vec3 betaMTheta = betaM * mPhase;","vec3 Lin = pow(sunE * ((betaRTheta + betaMTheta) / (betaR + betaM)) * (1.0 - Fex),vec3(1.5));","Lin *= mix(vec3(1.0),pow(sunE * ((betaRTheta + betaMTheta) / (betaR + betaM)) * Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up, sunDirection),5.0),0.0,1.0));","vec3 direction = normalize(vWorldPosition - cameraPos);","float theta = acos(direction.y); // elevation --\x3e y-axis, [-pi/2, pi/2]","float phi = atan(direction.z, direction.x); // azimuth --\x3e x-axis [-pi/2, pi/2]","vec2 uv = vec2(phi, theta) / vec2(2.0*pi, pi) + vec2(0.5, 0.0);","vec3 L0 = vec3(0.1) * Fex;","float sundisk = smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);","L0 += (sunE * 19000.0 * Fex)*sundisk;","vec3 whiteScale = 1.0/Uncharted2Tonemap(vec3(W));","vec3 texColor = (Lin+L0);   ","texColor *= 0.04 ;","texColor += vec3(0.0,0.001,0.0025)*0.3;","float g_fMaxLuminance = 1.0;","float fLumScaled = 0.1 / luminance;     ","float fLumCompressed = (fLumScaled * (1.0 + (fLumScaled / (g_fMaxLuminance * g_fMaxLuminance)))) / (1.0 + fLumScaled); ","float ExposureBias = fLumCompressed;","vec3 curr = Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);","vec3 color = curr*whiteScale;","vec3 retColor = pow(color,vec3(1.0/(1.2+(1.2*sunfade))));","gl_FragColor.rgb = retColor;","gl_FragColor.a = 1.0;","}"].join("\n")}),AFRAME.registerShader("gradientshader",{schema:{topColor:{type:"color",default:"1 0 0",is:"uniform"},bottomColor:{type:"color",default:"0 0 1",is:"uniform"}},vertexShader:["varying vec3 vWorldPosition;","void main() {"," vec4 worldPosition = modelMatrix * vec4( position, 1.0 );"," vWorldPosition = worldPosition.xyz;"," gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 bottomColor;","uniform vec3 topColor;","uniform float offset;","varying vec3 vWorldPosition;","void main() {"," float h = normalize( vWorldPosition ).y;"," gl_FragColor = vec4( mix( bottomColor, topColor, max( pow( max(h, 0.0 ), 0.8 ), 0.0 ) ), 1.0 );","}"].join("\n")});var e=function(e){var t,i;for(this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.p=[],i=0;i<256;i++)t=parseFloat("0."+Math.sin(9999*e*i).toString().substr(7)),this.p[i]=Math.floor(256*t);for(this.perm=[],i=0;i<512;i++)this.perm[i]=this.p[255&i]};e.prototype.dot=function(e,t,i,n){return e[0]*t+e[1]*i+e[2]*n},e.prototype.mix=function(e,t,i){return(1-i)*e+i*t},e.prototype.fade=function(e){return e*e*e*(e*(6*e-15)+10)},e.prototype.noise=function(e,t,i){var n=Math.floor(e),r=Math.floor(t),o=Math.floor(i);e-=n,t-=r,i-=o,n&=255,r&=255,o&=255;var s=this.perm[n+this.perm[r+this.perm[o]]]%12,a=this.perm[n+this.perm[r+this.perm[o+1]]]%12,l=this.perm[n+this.perm[r+1+this.perm[o]]]%12,c=this.perm[n+this.perm[r+1+this.perm[o+1]]]%12,h=this.perm[n+1+this.perm[r+this.perm[o]]]%12,u=this.perm[n+1+this.perm[r+this.perm[o+1]]]%12,d=this.perm[n+1+this.perm[r+1+this.perm[o]]]%12,p=this.perm[n+1+this.perm[r+1+this.perm[o+1]]]%12,f=this.dot(this.grad3[s],e,t,i),m=this.dot(this.grad3[h],e-1,t,i),g=this.dot(this.grad3[l],e,t-1,i),v=this.dot(this.grad3[d],e-1,t-1,i),y=this.dot(this.grad3[a],e,t,i-1),b=this.dot(this.grad3[u],e-1,t,i-1),E=this.dot(this.grad3[c],e,t-1,i-1),x=this.dot(this.grad3[p],e-1,t-1,i-1),w=this.fade(e),T=this.fade(t),k=this.fade(i),_=this.mix(f,m,w),A=this.mix(y,b,w),C=this.mix(g,v,w),S=this.mix(E,x,w),R=this.mix(_,C,T),L=this.mix(A,S,T);return this.mix(R,L,k)}},401:(e,t,i)=>{i(2406),i(9874),i(9236),i(2578),i(6699)},203:e=>{e.exports=THREE.ColladaLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.ColladaLoader.prototype={constructor:THREE.ColladaLoader,crossOrigin:"anonymous",load:function(e,t,i,n){var r=this,o=void 0===r.path?THREE.LoaderUtils.extractUrlBase(e):r.path,s=new THREE.FileLoader(r.manager);s.setPath(r.path),s.load(e,(function(e){t(r.parse(e,o))}),i,n)},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},options:{set convertUpAxis(e){console.warn("THREE.ColladaLoader: options.convertUpAxis() has been removed. Up axis is converted automatically.")}},setCrossOrigin:function(e){return this.crossOrigin=e,this},parse:function(e,t){function i(e,t){for(var i=[],n=e.childNodes,r=0,o=n.length;r<o;r++){var s=n[r];s.nodeName===t&&i.push(s)}return i}function n(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),i=new Array(t.length),n=0,r=t.length;n<r;n++)i[n]=t[n];return i}function r(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),i=new Array(t.length),n=0,r=t.length;n<r;n++)i[n]=parseFloat(t[n]);return i}function o(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),i=new Array(t.length),n=0,r=t.length;n<r;n++)i[n]=parseInt(t[n]);return i}function s(e){return e.substring(1)}function a(e){return 0===Object.keys(e).length}function l(e){return void 0!==e&&!0===e.hasAttribute("meter")?parseFloat(e.getAttribute("meter")):1}function c(e){return void 0!==e?e.textContent:"Y_UP"}function h(e,t,n,r){var o=i(e,t)[0];if(void 0!==o)for(var s=i(o,n),a=0;a<s.length;a++)r(s[a])}function u(e,t){for(var i in e)e[i].build=t(e[i])}function d(e,t){return void 0!==e.build||(e.build=t(e)),e.build}function p(e){for(var t={inputs:{}},i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];if(1===r.nodeType&&"input"===r.nodeName){var o=s(r.getAttribute("source")),a=r.getAttribute("semantic");t.inputs[a]=o}}return t}function f(e){var t={},i=e.getAttribute("target").split("/"),n=i.shift(),r=i.shift(),o=-1!==r.indexOf("("),a=-1!==r.indexOf(".");if(a)i=r.split("."),r=i.shift(),t.member=i.shift();else if(o){var l=r.split("(");r=l.shift();for(var c=0;c<l.length;c++)l[c]=parseInt(l[c].replace(/\)/,""));t.indices=l}return t.id=n,t.sid=r,t.arraySyntax=o,t.memberSyntax=a,t.sampler=s(e.getAttribute("source")),t}function m(e){var t=[],i=e.channels,n=e.samplers,r=e.sources;for(var o in i)if(i.hasOwnProperty(o)){var s=i[o],a=n[s.sampler],l=a.inputs.INPUT,c=a.inputs.OUTPUT;x(v(s,r[l],r[c]),t)}return t}function g(e){return d(We.animations[e],m)}function v(e,t,i){var n,r,o,s,a,l,c=We.nodes[e.id],h=Pe(c.id),u=c.transforms[e.sid],d=c.matrix.clone().transpose(),p={};switch(u){case"matrix":for(o=0,s=t.array.length;o<s;o++)if(n=t.array[o],r=o*i.stride,void 0===p[n]&&(p[n]={}),!0===e.arraySyntax){var f=i.array[r],m=e.indices[0]+4*e.indices[1];p[n][m]=f}else for(a=0,l=i.stride;a<l;a++)p[n][a]=i.array[r+a];break;case"translate":case"rotate":case"scale":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',u)}var g=function(e,t){var i=[];for(var n in e)i.push({time:parseFloat(n),value:e[n]});i.sort((function(e,t){return e.time-t.time}));for(var r=0;r<16;r++)w(i,r,t.elements[r]);return i}(p,d);return{name:h.uuid,keyframes:g}}var y=new THREE.Vector3,b=new THREE.Vector3,E=new THREE.Quaternion;function x(e,t){for(var i=e.keyframes,n=e.name,r=[],o=[],s=[],a=[],l=0,c=i.length;l<c;l++){var h=i[l],u=h.time,d=h.value;ke.fromArray(d).transpose(),ke.decompose(y,E,b),r.push(u),o.push(y.x,y.y,y.z),s.push(E.x,E.y,E.z,E.w),a.push(b.x,b.y,b.z)}return o.length>0&&t.push(new THREE.VectorKeyframeTrack(n+".position",r,o)),s.length>0&&t.push(new THREE.QuaternionKeyframeTrack(n+".quaternion",r,s)),a.length>0&&t.push(new THREE.VectorKeyframeTrack(n+".scale",r,a)),t}function w(e,t,i){var n,r,o,s=!0;for(r=0,o=e.length;r<o;r++)void 0===(n=e[r]).value[t]?n.value[t]=null:s=!1;if(!0===s)for(r=0,o=e.length;r<o;r++)(n=e[r]).value[t]=i;else!function(e,t){for(var i,n,r=0,o=e.length;r<o;r++){var s=e[r];if(null===s.value[t]){if(i=T(e,r,t),n=k(e,r,t),null===i){s.value[t]=n.value[t];continue}if(null===n){s.value[t]=i.value[t];continue}_(s,i,n,t)}}}(e,t)}function T(e,t,i){for(;t>=0;){var n=e[t];if(null!==n.value[i])return n;t--}return null}function k(e,t,i){for(;t<e.length;){var n=e[t];if(null!==n.value[i])return n;t++}return null}function _(e,t,i,n){i.time-t.time!=0?e.value[n]=(e.time-t.time)*(i.value[n]-t.value[n])/(i.time-t.time)+t.value[n]:e.value[n]=t.value[n]}function A(e){for(var t=[],i=e.name,n=e.end-e.start||-1,r=e.animations,o=0,s=r.length;o<s;o++)for(var a=g(r[o]),l=0,c=a.length;l<c;l++)t.push(a[l]);return new THREE.AnimationClip(i,n,t)}function C(e){return d(We.clips[e],A)}function S(e){for(var t={sources:{}},i=0,n=e.childNodes.length;i<n;i++){var o=e.childNodes[i];if(1===o.nodeType)switch(o.nodeName){case"bind_shape_matrix":t.bindShapeMatrix=r(o.textContent);break;case"source":var s=o.getAttribute("id");t.sources[s]=re(o);break;case"joints":t.joints=R(o);break;case"vertex_weights":t.vertexWeights=L(o)}}return t}function R(e){for(var t={inputs:{}},i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];if(1===r.nodeType&&"input"===r.nodeName){var o=r.getAttribute("semantic"),a=s(r.getAttribute("source"));t.inputs[o]=a}}return t}function L(e){for(var t={inputs:{}},i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"input":var a=r.getAttribute("semantic"),l=s(r.getAttribute("source")),c=parseInt(r.getAttribute("offset"));t.inputs[a]={id:l,offset:c};break;case"vcount":t.vcount=o(r.textContent);break;case"v":t.v=o(r.textContent)}}return t}function O(e){var t={id:e.id},i=We.geometries[t.id];return void 0!==e.skin&&(t.skin=function(e){var t,i,n,r={joints:[],indices:{array:[],stride:4},weights:{array:[],stride:4}},o=e.sources,s=e.vertexWeights,a=s.vcount,l=s.v,c=s.inputs.JOINT.offset,h=s.inputs.WEIGHT.offset,u=e.sources[e.joints.inputs.JOINT],d=e.sources[e.joints.inputs.INV_BIND_MATRIX],p=o[s.inputs.WEIGHT.id].array,f=0;for(t=0,n=a.length;t<n;t++){var m=a[t],g=[];for(i=0;i<m;i++){var v=l[f+c],y=p[l[f+h]];g.push({index:v,weight:y}),f+=2}for(g.sort(w),i=0;i<4;i++){var b=g[i];void 0!==b?(r.indices.array.push(b.index),r.weights.array.push(b.weight)):(r.indices.array.push(0),r.weights.array.push(0))}}for(e.bindShapeMatrix?r.bindMatrix=(new THREE.Matrix4).fromArray(e.bindShapeMatrix).transpose():r.bindMatrix=(new THREE.Matrix4).identity(),t=0,n=u.array.length;t<n;t++){var E=u.array[t],x=(new THREE.Matrix4).fromArray(d.array,t*d.stride).transpose();r.joints.push({name:E,boneInverse:x})}return r;function w(e,t){return t.weight-e.weight}}(e.skin),i.sources.skinIndices=t.skin.indices,i.sources.skinWeights=t.skin.weights),t}function M(e){return void 0!==e.build?e.build:e.init_from}function N(e){var t=We.images[e];return void 0!==t?d(t,M):(console.warn("THREE.ColladaLoader: Couldn't find image with ID:",e),null)}function D(e){for(var t={surfaces:{},samplers:{}},i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"newparam":P(r,t);break;case"technique":t.technique=F(r);break;case"extra":t.extra=G(r)}}return t}function P(e,t){for(var i=e.getAttribute("sid"),n=0,r=e.childNodes.length;n<r;n++){var o=e.childNodes[n];if(1===o.nodeType)switch(o.nodeName){case"surface":t.surfaces[i]=I(o);break;case"sampler2D":t.samplers[i]=H(o)}}}function I(e){for(var t={},i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];1===r.nodeType&&"init_from"===r.nodeName&&(t.init_from=r.textContent)}return t}function H(e){for(var t={},i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];1===r.nodeType&&"source"===r.nodeName&&(t.source=r.textContent)}return t}function F(e){for(var t={},i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"constant":case"lambert":case"blinn":case"phong":t.type=r.nodeName,t.parameters=j(r)}}return t}function j(e){for(var t={},i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"emission":case"diffuse":case"specular":case"bump":case"ambient":case"shininess":case"transparency":t[r.nodeName]=B(r);break;case"transparent":t[r.nodeName]={opaque:r.getAttribute("opaque"),data:B(r)}}}return t}function B(e){for(var t={},i=0,n=e.childNodes.length;i<n;i++){var o=e.childNodes[i];if(1===o.nodeType)switch(o.nodeName){case"color":t[o.nodeName]=r(o.textContent);break;case"float":t[o.nodeName]=parseFloat(o.textContent);break;case"texture":t[o.nodeName]={id:o.getAttribute("texture"),extra:K(o)}}}return t}function K(e){for(var t={technique:{}},i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];1===r.nodeType&&"extra"===r.nodeName&&z(r,t)}return t}function z(e,t){for(var i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];1===r.nodeType&&"technique"===r.nodeName&&V(r,t)}}function V(e,t){for(var i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":t.technique[r.nodeName]=parseFloat(r.textContent);break;case"wrapU":case"wrapV":"TRUE"===r.textContent.toUpperCase()?t.technique[r.nodeName]=1:"FALSE"===r.textContent.toUpperCase()?t.technique[r.nodeName]=0:t.technique[r.nodeName]=parseInt(r.textContent)}}}function G(e){for(var t={},i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];1===r.nodeType&&"technique"===r.nodeName&&(t.technique=U(r))}return t}function U(e){for(var t={},i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];1===r.nodeType&&"double_sided"===r.nodeName&&(t[r.nodeName]=parseInt(r.textContent))}return t}function q(e){return e}function W(e){var t,i,n=(t=e.url,d(We.effects[t],q)),r=n.profile.technique,o=n.profile.extra;switch(r.type){case"phong":case"blinn":i=new THREE.MeshPhongMaterial;break;case"lambert":i=new THREE.MeshLambertMaterial;break;default:i=new THREE.MeshBasicMaterial}function s(e){var t=n.profile.samplers[e.id],i=null;if(void 0!==t?i=N(n.profile.surfaces[t.source].init_from):(console.warn("THREE.ColladaLoader: Undefined sampler. Access image directly (see #12530)."),i=N(e.id)),null!==i){var r=function(e){var t=e.slice(2+(e.lastIndexOf(".")-1>>>0));return"tga"===(t=t.toLowerCase())?Be:Ve}(i);if(void 0!==r){var o=r.load(i),s=e.extra;if(void 0!==s&&void 0!==s.technique&&!1===a(s.technique)){var l=s.technique;o.wrapS=l.wrapU?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,o.wrapT=l.wrapV?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,o.offset.set(l.offsetU||0,l.offsetV||0),o.repeat.set(l.repeatU||1,l.repeatV||1)}else o.wrapS=THREE.RepeatWrapping,o.wrapT=THREE.RepeatWrapping;return o}return console.warn("THREE.ColladaLoader: Loader for texture %s not found.",i),null}return console.warn("THREE.ColladaLoader: Couldn't create texture with ID:",e.id),null}i.name=e.name;var l=r.parameters;for(var c in l){var h=l[c];switch(c){case"diffuse":h.color&&i.color.fromArray(h.color),h.texture&&(i.map=s(h.texture));break;case"specular":h.color&&i.specular&&i.specular.fromArray(h.color),h.texture&&(i.specularMap=s(h.texture));break;case"bump":h.texture&&(i.normalMap=s(h.texture));break;case"ambient":h.texture&&(i.lightMap=s(h.texture));break;case"shininess":h.float&&i.shininess&&(i.shininess=h.float);break;case"emission":h.color&&i.emissive&&i.emissive.fromArray(h.color),h.texture&&(i.emissiveMap=s(h.texture))}}var u=l.transparent,p=l.transparency;if(void 0===p&&u&&(p={float:1}),void 0===u&&p&&(u={opaque:"A_ONE",data:{color:[1,1,1,1]}}),u&&p)if(u.data.texture)i.transparent=!0;else{var f=u.data.color;switch(u.opaque){case"A_ONE":i.opacity=f[3]*p.float;break;case"RGB_ZERO":i.opacity=1-f[0]*p.float;break;case"A_ZERO":i.opacity=1-f[3]*p.float;break;case"RGB_ONE":i.opacity=f[0]*p.float;break;default:console.warn('THREE.ColladaLoader: Invalid opaque type "%s" of transparent tag.',u.opaque)}i.opacity<1&&(i.transparent=!0)}return void 0!==o&&void 0!==o.technique&&1===o.technique.double_sided&&(i.side=THREE.DoubleSide),i}function X(e){return d(We.materials[e],W)}function Y(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if("technique_common"===i.nodeName)return Z(i)}return{}}function Z(e){for(var t={},i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];switch(n.nodeName){case"perspective":case"orthographic":t.technique=n.nodeName,t.parameters=J(n)}}return t}function J(e){for(var t={},i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];switch(n.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":t[n.nodeName]=parseFloat(n.textContent)}}return t}function $(e){var t;switch(e.optics.technique){case"perspective":t=new THREE.PerspectiveCamera(e.optics.parameters.yfov,e.optics.parameters.aspect_ratio,e.optics.parameters.znear,e.optics.parameters.zfar);break;case"orthographic":var i=e.optics.parameters.ymag,n=e.optics.parameters.xmag,r=e.optics.parameters.aspect_ratio;n=void 0===n?i*r:n,i=void 0===i?n/r:i,n*=.5,i*=.5,t=new THREE.OrthographicCamera(-n,n,i,-i,e.optics.parameters.znear,e.optics.parameters.zfar);break;default:t=new THREE.PerspectiveCamera}return t.name=e.name,t}function Q(e){var t=We.cameras[e];return void 0!==t?d(t,$):(console.warn("THREE.ColladaLoader: Couldn't find camera with ID:",e),null)}function ee(e){for(var t={},i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"directional":case"point":case"spot":case"ambient":t.technique=r.nodeName,t.parameters=te(r)}}return t}function te(e){for(var t={},i=0,n=e.childNodes.length;i<n;i++){var o=e.childNodes[i];if(1===o.nodeType)switch(o.nodeName){case"color":var s=r(o.textContent);t.color=(new THREE.Color).fromArray(s);break;case"falloff_angle":t.falloffAngle=parseFloat(o.textContent);break;case"quadratic_attenuation":var a=parseFloat(o.textContent);t.distance=a?Math.sqrt(1/a):0}}return t}function ie(e){var t;switch(e.technique){case"directional":t=new THREE.DirectionalLight;break;case"point":t=new THREE.PointLight;break;case"spot":t=new THREE.SpotLight;break;case"ambient":t=new THREE.AmbientLight}return e.parameters.color&&t.color.copy(e.parameters.color),e.parameters.distance&&(t.distance=e.parameters.distance),t}function ne(e){var t=We.lights[e];return void 0!==t?d(t,ie):(console.warn("THREE.ColladaLoader: Couldn't find light with ID:",e),null)}function re(e){for(var t={array:[],stride:3},o=0;o<e.childNodes.length;o++){var s=e.childNodes[o];if(1===s.nodeType)switch(s.nodeName){case"float_array":t.array=r(s.textContent);break;case"Name_array":t.array=n(s.textContent);break;case"technique_common":var a=i(s,"accessor")[0];void 0!==a&&(t.stride=parseInt(a.getAttribute("stride")))}}return t}function oe(e){for(var t={},i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];1===n.nodeType&&(t[n.getAttribute("semantic")]=s(n.getAttribute("source")))}return t}function se(e){for(var t={type:e.nodeName,material:e.getAttribute("material"),count:parseInt(e.getAttribute("count")),inputs:{},stride:0,hasUV:!1},i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"input":var a=s(r.getAttribute("source")),l=r.getAttribute("semantic"),c=parseInt(r.getAttribute("offset")),h=parseInt(r.getAttribute("set")),u=h>0?l+h:l;t.inputs[u]={id:a,offset:c},t.stride=Math.max(t.stride,c+1),"TEXCOORD"===l&&(t.hasUV=!0);break;case"vcount":t.vcount=o(r.textContent);break;case"p":t.p=o(r.textContent)}}return t}function ae(e){for(var t=0,i=0,n=e.length;i<n;i++)!0===e[i].hasUV&&t++;t>0&&t<e.length&&(e.uvsNeedsFix=!0)}function le(e){var t={},i=e.sources,n=e.vertices,r=e.primitives;if(0===r.length)return{};var o=function(e){for(var t={},i=0;i<e.length;i++){var n=e[i];void 0===t[n.type]&&(t[n.type]=[]),t[n.type].push(n)}return t}(r);for(var s in o){var a=o[s];ae(a),t[s]=ce(a,i,n)}return t}function ce(e,t,i){for(var n={},r={array:[],stride:0},o={array:[],stride:0},s={array:[],stride:0},a={array:[],stride:0},l={array:[],stride:0},c=[],h=[],u=new THREE.BufferGeometry,d=[],p=0,f=0;f<e.length;f++){var m=e[f],g=m.inputs,v=0;switch(m.type){case"lines":case"linestrips":v=2*m.count;break;case"triangles":v=3*m.count;break;case"polylist":for(var y=0;y<m.count;y++){var b=m.vcount[y];switch(b){case 3:v+=3;break;case 4:v+=6;break;default:v+=3*(b-2)}}break;default:console.warn("THREE.ColladaLoader: Unknow primitive type:",m.type)}for(var E in u.addGroup(p,v,f),p+=v,m.material&&d.push(m.material),g){var x=g[E];switch(E){case"VERTEX":for(var w in i){var T=i[w];switch(w){case"POSITION":var k=r.array.length;if(he(m,t[T],x.offset,r.array),r.stride=t[T].stride,t.skinWeights&&t.skinIndices&&(he(m,t.skinIndices,x.offset,c),he(m,t.skinWeights,x.offset,h)),!1===m.hasUV&&!0===e.uvsNeedsFix){v=(r.array.length-k)/r.stride;for(var _=0;_<v;_++)s.array.push(0,0)}break;case"NORMAL":he(m,t[T],x.offset,o.array),o.stride=t[T].stride;break;case"COLOR":he(m,t[T],x.offset,l.array),l.stride=t[T].stride;break;case"TEXCOORD":he(m,t[T],x.offset,s.array),s.stride=t[T].stride;break;case"TEXCOORD1":he(m,t[T],x.offset,a.array),s.stride=t[T].stride;break;default:console.warn('THREE.ColladaLoader: Semantic "%s" not handled in geometry build process.',w)}}break;case"NORMAL":he(m,t[x.id],x.offset,o.array),o.stride=t[x.id].stride;break;case"COLOR":he(m,t[x.id],x.offset,l.array),l.stride=t[x.id].stride;break;case"TEXCOORD":he(m,t[x.id],x.offset,s.array),s.stride=t[x.id].stride;break;case"TEXCOORD1":he(m,t[x.id],x.offset,a.array),a.stride=t[x.id].stride}}}return r.array.length>0&&u.addAttribute("position",new THREE.Float32BufferAttribute(r.array,r.stride)),o.array.length>0&&u.addAttribute("normal",new THREE.Float32BufferAttribute(o.array,o.stride)),l.array.length>0&&u.addAttribute("color",new THREE.Float32BufferAttribute(l.array,l.stride)),s.array.length>0&&u.addAttribute("uv",new THREE.Float32BufferAttribute(s.array,s.stride)),a.array.length>0&&u.addAttribute("uv2",new THREE.Float32BufferAttribute(a.array,a.stride)),c.length>0&&u.addAttribute("skinIndex",new THREE.Float32BufferAttribute(c,4)),h.length>0&&u.addAttribute("skinWeight",new THREE.Float32BufferAttribute(h,4)),n.data=u,n.type=e[0].type,n.materialKeys=d,n}function he(e,t,i,n){var r=e.p,o=e.stride,s=e.vcount;function a(e){for(var t=r[e+i]*c,o=t+c;t<o;t++)n.push(l[t])}var l=t.array,c=t.stride;if(void 0!==e.vcount)for(var h=0,u=0,d=s.length;u<d;u++){var p=s[u];if(4===p){var f=h+1*o,m=h+2*o,g=h+3*o;a(h+0*o),a(f),a(g),a(f),a(m),a(g)}else if(3===p)f=h+1*o,m=h+2*o,a(h+0*o),a(f),a(m);else if(p>4)for(var v=1,y=p-2;v<=y;v++)f=h+o*v,m=h+o*(v+1),a(h+0*o),a(f),a(m);h+=o*p}else for(u=0,d=r.length;u<d;u+=o)a(u)}function ue(e){return d(We.geometries[e],le)}function de(e){return void 0!==e.build?e.build:e}function pe(e,t){for(var i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"joint":t.joints[n.getAttribute("sid")]=fe(n);break;case"link":t.links.push(ge(n))}}}function fe(e){for(var t,i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"prismatic":case"revolute":t=me(n)}}return t}function me(e,t){t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",axis:new THREE.Vector3,limits:{min:0,max:0},type:e.nodeName,static:!1,zeroPosition:0,middlePosition:0};for(var i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"axis":var o=r(n.textContent);t.axis.fromArray(o);break;case"limits":var s=n.getElementsByTagName("max")[0],a=n.getElementsByTagName("min")[0];t.limits.max=parseFloat(s.textContent),t.limits.min=parseFloat(a.textContent)}}return t.limits.min>=t.limits.max&&(t.static=!0),t.middlePosition=(t.limits.min+t.limits.max)/2,t}function ge(e){for(var t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",attachments:[],transforms:[]},i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"attachment_full":t.attachments.push(ve(n));break;case"matrix":case"translate":case"rotate":t.transforms.push(ye(n))}}return t}function ve(e){for(var t={joint:e.getAttribute("joint").split("/").pop(),transforms:[],links:[]},i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"link":t.links.push(ge(n));break;case"matrix":case"translate":case"rotate":t.transforms.push(ye(n))}}return t}function ye(e){var t={type:e.nodeName},i=r(e.textContent);switch(t.type){case"matrix":t.obj=new THREE.Matrix4,t.obj.fromArray(i).transpose();break;case"translate":t.obj=new THREE.Vector3,t.obj.fromArray(i);break;case"rotate":t.obj=new THREE.Vector3,t.obj.fromArray(i),t.angle=THREE.Math.degToRad(i[3])}return t}function be(e,t){for(var i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];1===n.nodeType&&"technique_common"===n.nodeName&&Ee(n,t)}}function Ee(e,t){for(var i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"inertia":t.inertia=r(n.textContent);break;case"mass":t.mass=r(n.textContent)[0]}}}function xe(e){for(var t={target:e.getAttribute("target").split("/").pop()},i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];if(1===n.nodeType&&"axis"===n.nodeName){var r=n.getElementsByTagName("param")[0];t.axis=r.textContent;var o=t.axis.split("inst_").pop().split("axis")[0];t.jointIndex=o.substr(0,o.length-1)}}return t}function we(e){return void 0!==e.build?e.build:e}function Te(e){for(var t=[],i=Fe.querySelector('[id="'+e.id+'"]'),n=0;n<i.childNodes.length;n++){var o=i.childNodes[n];if(1===o.nodeType)switch(o.nodeName){case"matrix":var s=r(o.textContent),a=(new THREE.Matrix4).fromArray(s).transpose();t.push({sid:o.getAttribute("sid"),type:o.nodeName,obj:a});break;case"translate":case"scale":s=r(o.textContent);var l=(new THREE.Vector3).fromArray(s);t.push({sid:o.getAttribute("sid"),type:o.nodeName,obj:l});break;case"rotate":s=r(o.textContent),l=(new THREE.Vector3).fromArray(s);var c=THREE.Math.degToRad(s[3]);t.push({sid:o.getAttribute("sid"),type:o.nodeName,obj:l,angle:c})}}return t}var ke=new THREE.Matrix4,_e=new THREE.Vector3;function Ae(e){for(var t={name:e.getAttribute("name")||"",type:e.getAttribute("type"),id:e.getAttribute("id"),sid:e.getAttribute("sid"),matrix:new THREE.Matrix4,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}},i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"node":t.nodes.push(n.getAttribute("id")),Ae(n);break;case"instance_camera":t.instanceCameras.push(s(n.getAttribute("url")));break;case"instance_controller":t.instanceControllers.push(Ce(n));break;case"instance_light":t.instanceLights.push(s(n.getAttribute("url")));break;case"instance_geometry":t.instanceGeometries.push(Ce(n));break;case"instance_node":t.instanceNodes.push(s(n.getAttribute("url")));break;case"matrix":var o=r(n.textContent);t.matrix.multiply(ke.fromArray(o).transpose()),t.transforms[n.getAttribute("sid")]=n.nodeName;break;case"translate":o=r(n.textContent),_e.fromArray(o),t.matrix.multiply(ke.makeTranslation(_e.x,_e.y,_e.z)),t.transforms[n.getAttribute("sid")]=n.nodeName;break;case"rotate":o=r(n.textContent);var a=THREE.Math.degToRad(o[3]);t.matrix.multiply(ke.makeRotationAxis(_e.fromArray(o),a)),t.transforms[n.getAttribute("sid")]=n.nodeName;break;case"scale":o=r(n.textContent),t.matrix.scale(_e.fromArray(o)),t.transforms[n.getAttribute("sid")]=n.nodeName;break;case"extra":break;default:console.log(n)}}return De(t.id)?console.warn("THREE.ColladaLoader: There is already a node with ID %s. Exclude current node from further processing.",t.id):We.nodes[t.id]=t,t}function Ce(e){for(var t={id:s(e.getAttribute("url")),materials:{},skeletons:[]},i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];switch(n.nodeName){case"bind_material":for(var r=n.getElementsByTagName("instance_material"),o=0;o<r.length;o++){var a=r[o],l=a.getAttribute("symbol"),c=a.getAttribute("target");t.materials[l]=s(c)}break;case"skeleton":t.skeletons.push(s(n.textContent))}}return t}function Se(e,t){var i,n,r,o=[],s=[];for(i=0;i<e.length;i++){var a=e[i];if(De(a))Re(Pe(a),t,o);else if(r=a,void 0!==We.visualScenes[r])for(var l=We.visualScenes[a].children,c=0;c<l.length;c++){var h=l[c];"JOINT"===h.type&&Re(Pe(h.id),t,o)}else console.error("THREE.ColladaLoader: Unable to find root bone of skeleton with ID:",a)}for(i=0;i<t.length;i++)for(c=0;c<o.length;c++)if((n=o[c]).bone.name===t[i].name){s[i]=n,n.processed=!0;break}for(i=0;i<o.length;i++)!1===(n=o[i]).processed&&(s.push(n),n.processed=!0);var u=[],d=[];for(i=0;i<s.length;i++)n=s[i],u.push(n.bone),d.push(n.boneInverse);return new THREE.Skeleton(u,d)}function Re(e,t,i){e.traverse((function(e){if(!0===e.isBone){for(var n,r=0;r<t.length;r++){var o=t[r];if(o.name===e.name){n=o.boneInverse;break}}void 0===n&&(n=new THREE.Matrix4),i.push({bone:e,boneInverse:n,processed:!1})}}))}function Le(e){for(var t,i=[],n=e.matrix,r=e.nodes,o=e.type,s=e.instanceCameras,a=e.instanceControllers,l=e.instanceLights,c=e.instanceGeometries,h=e.instanceNodes,u=0,p=r.length;u<p;u++)i.push(Pe(r[u]));for(u=0,p=s.length;u<p;u++){var f=Q(s[u]);null!==f&&i.push(f.clone())}for(u=0,p=a.length;u<p;u++)for(var m=a[u],g=(t=m.id,d(We.controllers[t],O)),v=Ne(ue(g.id),m.materials),y=Se(m.skeletons,g.skin.joints),b=0,E=v.length;b<E;b++){var x;(x=v[b]).isSkinnedMesh&&(x.bind(y,g.skin.bindMatrix),x.normalizeSkinWeights()),i.push(x)}for(u=0,p=l.length;u<p;u++){var w=ne(l[u]);null!==w&&i.push(w.clone())}for(u=0,p=c.length;u<p;u++)for(b=0,E=(v=Ne(ue((m=c[u]).id),m.materials)).length;b<E;b++)i.push(v[b]);for(u=0,p=h.length;u<p;u++)i.push(Pe(h[u]).clone());if(0===r.length&&1===i.length)x=i[0];else for(x="JOINT"===o?new THREE.Bone:new THREE.Group,u=0;u<i.length;u++)x.add(i[u]);return""===x.name&&(x.name="JOINT"===o?e.sid:e.name),x.matrix.copy(n),x.matrix.decompose(x.position,x.quaternion,x.scale),x}var Oe=new THREE.MeshBasicMaterial({color:16711935});function Me(e,t){for(var i=[],n=0,r=e.length;n<r;n++){var o=t[e[n]];void 0===o?(console.warn("THREE.ColladaLoader: Material with key %s not found. Apply fallback material.",e[n]),i.push(Oe)):i.push(X(o))}return i}function Ne(e,t){var i=[];for(var n in e){var r=e[n],o=Me(r.materialKeys,t);0===o.length&&("lines"===n||"linestrips"===n?o.push(new THREE.LineBasicMaterial):o.push(new THREE.MeshPhongMaterial));var s=void 0!==r.data.attributes.skinIndex;if(s)for(var a=0,l=o.length;a<l;a++)o[a].skinning=!0;var c,h=1===o.length?o[0]:o;switch(n){case"lines":c=new THREE.LineSegments(r.data,h);break;case"linestrips":c=new THREE.Line(r.data,h);break;case"triangles":case"polylist":c=s?new THREE.SkinnedMesh(r.data,h):new THREE.Mesh(r.data,h)}i.push(c)}return i}function De(e){return void 0!==We.nodes[e]}function Pe(e){return d(We.nodes[e],Le)}function Ie(e){var t=new THREE.Group;t.name=e.name;for(var i=e.children,n=0;n<i.length;n++){var r=i[n];t.add(Pe(r.id))}return t}function He(e){return d(We.visualScenes[e],Ie)}if(0===e.length)return{scene:new THREE.Scene};var Fe=i((new DOMParser).parseFromString(e,"application/xml"),"COLLADA")[0],je=Fe.getAttribute("version");console.log("THREE.ColladaLoader: File version",je);var Be,Ke,ze=(Ke=i(Fe,"asset")[0],{unit:l(i(Ke,"unit")[0]),upAxis:c(i(Ke,"up_axis")[0])}),Ve=new THREE.TextureLoader(this.manager);Ve.setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin),THREE.TGALoader&&(Be=new THREE.TGALoader(this.manager)).setPath(this.resourcePath||t);var Ge=[],Ue={},qe=0,We={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},physicsModels:{},kinematicsScenes:{}};h(Fe,"library_animations","animation",(function(e){for(var t={sources:{},samplers:{},channels:{}},i=0,n=e.childNodes.length;i<n;i++){var r,o=e.childNodes[i];if(1===o.nodeType)switch(o.nodeName){case"source":r=o.getAttribute("id"),t.sources[r]=re(o);break;case"sampler":r=o.getAttribute("id"),t.samplers[r]=p(o);break;case"channel":r=o.getAttribute("target"),t.channels[r]=f(o);break;default:console.log(o)}}We.animations[e.getAttribute("id")]=t})),h(Fe,"library_animation_clips","animation_clip",(function(e){for(var t={name:e.getAttribute("id")||"default",start:parseFloat(e.getAttribute("start")||0),end:parseFloat(e.getAttribute("end")||0),animations:[]},i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];1===r.nodeType&&"instance_animation"===r.nodeName&&t.animations.push(s(r.getAttribute("url")))}We.clips[e.getAttribute("id")]=t})),h(Fe,"library_controllers","controller",(function(e){for(var t={},i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"skin":t.id=s(r.getAttribute("source")),t.skin=S(r);break;case"morph":t.id=s(r.getAttribute("source")),console.warn("THREE.ColladaLoader: Morph target animation not supported yet.")}}We.controllers[e.getAttribute("id")]=t})),h(Fe,"library_images","image",(function(e){var t={init_from:i(e,"init_from")[0].textContent};We.images[e.getAttribute("id")]=t})),h(Fe,"library_effects","effect",(function(e){for(var t={},i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];1===r.nodeType&&"profile_COMMON"===r.nodeName&&(t.profile=D(r))}We.effects[e.getAttribute("id")]=t})),h(Fe,"library_materials","material",(function(e){for(var t={name:e.getAttribute("name")},i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];1===r.nodeType&&"instance_effect"===r.nodeName&&(t.url=s(r.getAttribute("url")))}We.materials[e.getAttribute("id")]=t})),h(Fe,"library_cameras","camera",(function(e){for(var t={name:e.getAttribute("name")},i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];1===r.nodeType&&"optics"===r.nodeName&&(t.optics=Y(r))}We.cameras[e.getAttribute("id")]=t})),h(Fe,"library_lights","light",(function(e){for(var t={},i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];1===r.nodeType&&"technique_common"===r.nodeName&&(t=ee(r))}We.lights[e.getAttribute("id")]=t})),h(Fe,"library_geometries","geometry",(function(e){var t={name:e.getAttribute("name"),sources:{},vertices:{},primitives:[]},n=i(e,"mesh")[0];if(void 0!==n){for(var r=0;r<n.childNodes.length;r++){var o=n.childNodes[r];if(1===o.nodeType){var s=o.getAttribute("id");switch(o.nodeName){case"source":t.sources[s]=re(o);break;case"vertices":t.vertices=oe(o);break;case"polygons":console.warn("THREE.ColladaLoader: Unsupported primitive type: ",o.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":t.primitives.push(se(o));break;default:console.log(o)}}}We.geometries[e.getAttribute("id")]=t}})),h(Fe,"library_nodes","node",Ae),h(Fe,"library_visual_scenes","visual_scene",(function(e){var t={name:e.getAttribute("name"),children:[]};!function(e){for(var t=e.getElementsByTagName("node"),i=0;i<t.length;i++){var n=t[i];!1===n.hasAttribute("id")&&n.setAttribute("id","three_default_"+qe++)}}(e);for(var n=i(e,"node"),r=0;r<n.length;r++)t.children.push(Ae(n[r]));We.visualScenes[e.getAttribute("id")]=t})),h(Fe,"library_kinematics_models","kinematics_model",(function(e){for(var t={name:e.getAttribute("name")||"",joints:{},links:[]},i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];1===n.nodeType&&"technique_common"===n.nodeName&&pe(n,t)}We.kinematicsModels[e.getAttribute("id")]=t})),h(Fe,"library_physics_models","physics_model",(function(e){for(var t={name:e.getAttribute("name")||"",rigidBodies:{}},i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];1===n.nodeType&&"rigid_body"===n.nodeName&&(t.rigidBodies[n.getAttribute("name")]={},be(n,t.rigidBodies[n.getAttribute("name")]))}We.physicsModels[e.getAttribute("id")]=t})),h(Fe,"scene","instance_kinematics_scene",(function(e){for(var t={bindJointAxis:[]},i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];1===n.nodeType&&"bind_joint_axis"===n.nodeName&&t.bindJointAxis.push(xe(n))}We.kinematicsScenes[s(e.getAttribute("url"))]=t})),u(We.animations,m),u(We.clips,A),u(We.controllers,O),u(We.images,M),u(We.effects,q),u(We.materials,W),u(We.cameras,$),u(We.lights,ie),u(We.geometries,le),u(We.visualScenes,Ie),function(){var e=We.clips;if(!0===a(e)){if(!1===a(We.animations)){var t=[];for(var i in We.animations)for(var n=g(i),r=0,o=n.length;r<o;r++)t.push(n[r]);Ge.push(new THREE.AnimationClip("default",-1,t))}}else for(var i in e)Ge.push(C(i))}(),function(){var e=Object.keys(We.kinematicsModels)[0],t=Object.keys(We.kinematicsScenes)[0],i=Object.keys(We.visualScenes)[0];if(void 0!==e&&void 0!==t){for(var n,r=(n=e,d(We.kinematicsModels[n],de)),o=function(e){return d(We.kinematicsScenes[e],we)}(t),s=He(i),a=o.bindJointAxis,l={},c=0,h=a.length;c<h;c++){var u=a[c],p=Fe.querySelector('[sid="'+u.target+'"]');if(p){var f=p.parentElement;g(u.jointIndex,f)}}var m=new THREE.Matrix4;Ue={joints:r&&r.joints,getJointValue:function(e){var t=l[e];if(t)return t.position;console.warn("THREE.ColladaLoader: Joint "+e+" doesn't exist.")},setJointValue:function(e,t){var i=l[e];if(i){var n=i.joint;if(t>n.limits.max||t<n.limits.min)console.warn("THREE.ColladaLoader: Joint "+e+" value "+t+" outside of limits (min: "+n.limits.min+", max: "+n.limits.max+").");else if(n.static)console.warn("THREE.ColladaLoader: Joint "+e+" is static.");else{var r=i.object,o=n.axis,s=i.transforms;ke.identity();for(var a=0;a<s.length;a++){var c=s[a];if(c.sid&&-1!==c.sid.indexOf(e))switch(n.type){case"revolute":ke.multiply(m.makeRotationAxis(o,THREE.Math.degToRad(t)));break;case"prismatic":ke.multiply(m.makeTranslation(o.x*t,o.y*t,o.z*t));break;default:console.warn("THREE.ColladaLoader: Unknown joint type: "+n.type)}else switch(c.type){case"matrix":ke.multiply(c.obj);break;case"translate":ke.multiply(m.makeTranslation(c.obj.x,c.obj.y,c.obj.z));break;case"scale":ke.scale(c.obj);break;case"rotate":ke.multiply(m.makeRotationAxis(c.obj,c.angle))}}r.matrix.copy(ke),r.matrix.decompose(r.position,r.quaternion,r.scale),l[e].position=t}}else console.log("THREE.ColladaLoader: "+e+" does not exist.")}}}function g(e,t){var i=t.getAttribute("name"),n=r.joints[e];s.traverse((function(r){r.name===i&&(l[e]={object:r,transforms:Te(t),joint:n,position:n.zeroPosition})}))}}();var Xe=function(e){return He(s(i(e,"instance_visual_scene")[0].getAttribute("url")))}(i(Fe,"scene")[0]);return"Z_UP"===ze.upAxis&&Xe.quaternion.setFromEuler(new THREE.Euler(-Math.PI/2,0,0)),Xe.scale.multiplyScalar(ze.unit),{animations:Ge,kinematics:Ue,library:We,scene:Xe}}}},9434:e=>{e.exports=THREE.FBXLoader=function(){var e,t,i;function n(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager}function r(e){this.textureLoader=e}function o(){}function s(){}function a(){}function l(){}function c(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===t||t}function h(){}function u(e){var t=e.match(/FBXVersion: (\d+)/);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function d(e){return e/46186158e3}n.prototype={constructor:n,crossOrigin:"anonymous",load:function(e,t,i,n){var r=this,o=THREE.LoaderUtils.extractUrlBase(e),s=new THREE.FileLoader(this.manager);s.setResponseType("arraybuffer"),s.load(e,(function(i){try{var s=r.parse(i,o);t(s)}catch(t){setTimeout((function(){n&&n(t),r.manager.itemError(e)}),0)}}),i,n)},setCrossOrigin:function(e){return this.crossOrigin=e,this},parse:function(t,i){if(s="Kaydara FBX Binary  \0",(o=t).byteLength>=s.length&&s===T(o,0,s.length))e=(new l).parse(t);else{var n=T(t);if(!function(e){var t,i,n=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],r=0;for(var o=0;o<n.length;++o)if(i=void 0,i=e[(t=1)-1],e=e.slice(r+t),r++,i===n[o])return!1;return!0}(n))throw new Error("THREE.FBXLoader: Unknown format.");if(u(n)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+u(n));e=(new a).parse(n)}var o,s;return new r(new THREE.TextureLoader(this.manager).setPath(i).setCrossOrigin(this.crossOrigin)).parse(e)}},r.prototype={constructor:r,parse:function(){t=this.parseConnections();var e=this.parseImages(),n=this.parseTextures(e),r=this.parseMaterials(n),s=this.parseDeformers(),a=(new o).parse(s);return this.parseScene(s,a,r),i},parseConnections:function(){var t=new Map;return"Connections"in e&&e.Connections.connections.forEach((function(e){var i=e[0],n=e[1],r=e[2];t.has(i)||t.set(i,{parents:[],children:[]});var o={ID:n,relationship:r};t.get(i).parents.push(o),t.has(n)||t.set(n,{parents:[],children:[]});var s={ID:i,relationship:r};t.get(n).children.push(s)})),t},parseImages:function(){var t={},i={};if("Video"in e.Objects){var n=e.Objects.Video;for(var r in n){var o=n[r];if(t[c=parseInt(r)]=o.RelativeFilename||o.Filename,"Content"in o){var s=o.Content instanceof ArrayBuffer&&o.Content.byteLength>0,a="string"==typeof o.Content&&""!==o.Content;if(s||a){var l=this.parseImage(n[r]);i[o.RelativeFilename||o.Filename]=l}}}}for(var c in t){var h=t[c];void 0!==i[h]?t[c]=i[h]:t[c]=t[c].split("\\").pop()}return t},parseImage:function(e){var t,i=e.Content,n=e.RelativeFilename||e.Filename,r=n.slice(n.lastIndexOf(".")+1).toLowerCase();switch(r){case"bmp":t="image/bmp";break;case"jpg":case"jpeg":t="image/jpeg";break;case"png":t="image/png";break;case"tif":t="image/tiff";break;case"tga":if("function"!=typeof THREE.TGALoader)return void console.warn("FBXLoader: THREE.TGALoader is required to load TGA textures");null===THREE.Loader.Handlers.get(".tga")&&THREE.Loader.Handlers.add(/\.tga$/i,new THREE.TGALoader),t="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+r+'" is not supported.')}if("string"==typeof i)return"data:"+t+";base64,"+i;var o=new Uint8Array(i);return window.URL.createObjectURL(new Blob([o],{type:t}))},parseTextures:function(t){var i=new Map;if("Texture"in e.Objects){var n=e.Objects.Texture;for(var r in n){var o=this.parseTexture(n[r],t);i.set(parseInt(r),o)}}return i},parseTexture:function(e,t){var i=this.loadTexture(e,t);i.ID=e.id,i.name=e.attrName;var n=e.WrapModeU,r=e.WrapModeV,o=void 0!==n?n.value:0,s=void 0!==r?r.value:0;if(i.wrapS=0===o?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,i.wrapT=0===s?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,"Scaling"in e){var a=e.Scaling.value;i.repeat.x=a[0],i.repeat.y=a[1]}return i},loadTexture:function(e,i){var n,r,o=this.textureLoader.path,s=t.get(e.id).children;void 0!==s&&s.length>0&&void 0!==i[s[0].ID]&&(0!==(n=i[s[0].ID]).indexOf("blob:")&&0!==n.indexOf("data:")||this.textureLoader.setPath(void 0));var a=e.FileName.slice(-3).toLowerCase();if("tga"===a){var l=THREE.Loader.Handlers.get(".tga");null===l?(console.warn("FBXLoader: TGALoader not found, creating empty placeholder texture for",n),r=new THREE.Texture):r=l.load(n)}else"psd"===a?(console.warn("FBXLoader: PSD textures are not supported, creating empty placeholder texture for",n),r=new THREE.Texture):r=this.textureLoader.load(n);return this.textureLoader.setPath(o),r},parseMaterials:function(t){var i=new Map;if("Material"in e.Objects){var n=e.Objects.Material;for(var r in n){var o=this.parseMaterial(n[r],t);null!==o&&i.set(parseInt(r),o)}}return i},parseMaterial:function(e,i){var n=e.id,r=e.attrName,o=e.ShadingModel;if("object"==typeof o&&(o=o.value),!t.has(n))return null;var s,a=this.parseParameters(e,i,n);switch(o.toLowerCase()){case"phong":s=new THREE.MeshPhongMaterial;break;case"lambert":s=new THREE.MeshLambertMaterial;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',o),s=new THREE.MeshPhongMaterial({color:3342591})}return s.setValues(a),s.name=r,s},parseParameters:function(e,i,n){var r={};e.BumpFactor&&(r.bumpScale=e.BumpFactor.value),e.Diffuse?r.color=(new THREE.Color).fromArray(e.Diffuse.value):e.DiffuseColor&&"Color"===e.DiffuseColor.type&&(r.color=(new THREE.Color).fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(r.displacementScale=e.DisplacementFactor.value),e.Emissive?r.emissive=(new THREE.Color).fromArray(e.Emissive.value):e.EmissiveColor&&"Color"===e.EmissiveColor.type&&(r.emissive=(new THREE.Color).fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(r.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(r.opacity=parseFloat(e.Opacity.value)),r.opacity<1&&(r.transparent=!0),e.ReflectionFactor&&(r.reflectivity=e.ReflectionFactor.value),e.Shininess&&(r.shininess=e.Shininess.value),e.Specular?r.specular=(new THREE.Color).fromArray(e.Specular.value):e.SpecularColor&&"Color"===e.SpecularColor.type&&(r.specular=(new THREE.Color).fromArray(e.SpecularColor.value));var o=this;return t.get(n).children.forEach((function(e){var t=e.relationship;switch(t){case"Bump":r.bumpMap=o.getTexture(i,e.ID);break;case"DiffuseColor":r.map=o.getTexture(i,e.ID);break;case"DisplacementColor":r.displacementMap=o.getTexture(i,e.ID);break;case"EmissiveColor":r.emissiveMap=o.getTexture(i,e.ID);break;case"NormalMap":r.normalMap=o.getTexture(i,e.ID);break;case"ReflectionColor":r.envMap=o.getTexture(i,e.ID),r.envMap.mapping=THREE.EquirectangularReflectionMapping;break;case"SpecularColor":r.specularMap=o.getTexture(i,e.ID);break;case"TransparentColor":r.alphaMap=o.getTexture(i,e.ID),r.transparent=!0;break;default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",t)}})),r},getTexture:function(i,n){return"LayeredTexture"in e.Objects&&n in e.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),n=t.get(n).children[0].ID),i.get(n)},parseDeformers:function(){var i={},n={};if("Deformer"in e.Objects){var r=e.Objects.Deformer;for(var o in r){var s=r[o],a=t.get(parseInt(o));if("Skin"===s.attrType){var l=this.parseSkeleton(a,r);l.ID=o,a.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),l.geometryID=a.parents[0].ID,i[o]=l}else if("BlendShape"===s.attrType){var c={id:o};c.rawTargets=this.parseMorphTargets(a,r),c.id=o,a.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),n[o]=c}}}return{skeletons:i,morphTargets:n}},parseSkeleton:function(e,t){var i=[];return e.children.forEach((function(e){var n=t[e.ID];if("Cluster"===n.attrType){var r={ID:e.ID,indices:[],weights:[],transform:(new THREE.Matrix4).fromArray(n.Transform.a),transformLink:(new THREE.Matrix4).fromArray(n.TransformLink.a),linkMode:n.Mode};"Indexes"in n&&(r.indices=n.Indexes.a,r.weights=n.Weights.a),i.push(r)}})),{rawBones:i,bones:[]}},parseMorphTargets:function(e,i){for(var n=[],r=0;r<e.children.length;r++){if(8===r){console.warn("FBXLoader: maximum of 8 morph targets supported. Ignoring additional targets.");break}var o=e.children[r],s=i[o.ID],a={name:s.attrName,initialWeight:s.DeformPercent,id:s.id,fullWeights:s.FullWeights.a};if("BlendShapeChannel"!==s.attrType)return;t.get(parseInt(o.ID)).children.forEach((function(e){void 0===e.relationship&&(a.geoID=e.ID)})),n.push(a)}return n},parseScene:function(n,r,o){i=new THREE.Group;var a=this.parseModels(n.skeletons,r,o),l=e.Objects.Model,c=this;a.forEach((function(e){var n=l[e.ID];c.setLookAtProperties(e,n),t.get(e.ID).parents.forEach((function(t){var i=a.get(t.ID);void 0!==i&&i.add(e)})),null===e.parent&&i.add(e)})),this.bindSkeleton(n.skeletons,r,a),this.createAmbientLight(),this.setupMorphMaterials();var h=(new s).parse();1===i.children.length&&i.children[0].isGroup&&(i.children[0].animations=h,i=i.children[0]),i.animations=h},parseModels:function(i,n,r){var o=new Map,s=e.Objects.Model;for(var a in s){var l=parseInt(a),c=s[a],h=t.get(l),u=this.buildSkeleton(h,i,l,c.attrName);if(!u){switch(c.attrType){case"Camera":u=this.createCamera(h);break;case"Light":u=this.createLight(h);break;case"Mesh":u=this.createMesh(h,n,r);break;case"NurbsCurve":u=this.createCurve(h,n);break;default:u=new THREE.Group}u.name=THREE.PropertyBinding.sanitizeNodeName(c.attrName),u.ID=l}this.setModelTransforms(u,c),o.set(l,u)}return o},buildSkeleton:function(e,t,i,n){var r=null;return e.parents.forEach((function(e){for(var o in t){var s=t[o];s.rawBones.forEach((function(t,o){if(t.ID===e.ID){var a=r;(r=new THREE.Bone).matrixWorld.copy(t.transformLink),r.name=THREE.PropertyBinding.sanitizeNodeName(n),r.ID=i,s.bones[o]=r,null!==a&&r.add(a)}}))}})),r},createCamera:function(t){var i,n;if(t.children.forEach((function(t){var i=e.Objects.NodeAttribute[t.ID];void 0!==i&&(n=i)})),void 0===n)i=new THREE.Object3D;else{var r=0;void 0!==n.CameraProjectionType&&1===n.CameraProjectionType.value&&(r=1);var o=1;void 0!==n.NearPlane&&(o=n.NearPlane.value/1e3);var s=1e3;void 0!==n.FarPlane&&(s=n.FarPlane.value/1e3);var a=window.innerWidth,l=window.innerHeight;void 0!==n.AspectWidth&&void 0!==n.AspectHeight&&(a=n.AspectWidth.value,l=n.AspectHeight.value);var c=a/l,h=45;void 0!==n.FieldOfView&&(h=n.FieldOfView.value);var u=n.FocalLength?n.FocalLength.value:null;switch(r){case 0:i=new THREE.PerspectiveCamera(h,c,o,s),null!==u&&i.setFocalLength(u);break;case 1:i=new THREE.OrthographicCamera(-a/2,a/2,l/2,-l/2,o,s);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+r+"."),i=new THREE.Object3D}}return i},createLight:function(t){var i,n;if(t.children.forEach((function(t){var i=e.Objects.NodeAttribute[t.ID];void 0!==i&&(n=i)})),void 0===n)i=new THREE.Object3D;else{var r;r=void 0===n.LightType?0:n.LightType.value;var o=16777215;void 0!==n.Color&&(o=(new THREE.Color).fromArray(n.Color.value));var s=void 0===n.Intensity?1:n.Intensity.value/100;void 0!==n.CastLightOnObject&&0===n.CastLightOnObject.value&&(s=0);var a=0;switch(void 0!==n.FarAttenuationEnd&&(a=void 0!==n.EnableFarAttenuation&&0===n.EnableFarAttenuation.value?0:n.FarAttenuationEnd.value),r){case 0:i=new THREE.PointLight(o,s,a,1);break;case 1:i=new THREE.DirectionalLight(o,s);break;case 2:var l=Math.PI/3;void 0!==n.InnerAngle&&(l=THREE.Math.degToRad(n.InnerAngle.value));var c=0;void 0!==n.OuterAngle&&(c=THREE.Math.degToRad(n.OuterAngle.value),c=Math.max(c,1)),i=new THREE.SpotLight(o,s,a,l,c,1);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a THREE.PointLight."),i=new THREE.PointLight(o,s)}void 0!==n.CastShadows&&1===n.CastShadows.value&&(i.castShadow=!0)}return i},createMesh:function(e,t,i){var n,r=null,o=null,s=[];return e.children.forEach((function(e){t.has(e.ID)&&(r=t.get(e.ID)),i.has(e.ID)&&s.push(i.get(e.ID))})),s.length>1?o=s:s.length>0?o=s[0]:(o=new THREE.MeshPhongMaterial({color:13421772}),s.push(o)),"color"in r.attributes&&s.forEach((function(e){e.vertexColors=THREE.VertexColors})),r.FBX_Deformer?(s.forEach((function(e){e.skinning=!0})),n=new THREE.SkinnedMesh(r,o)):n=new THREE.Mesh(r,o),n},createCurve:function(e,t){var i=e.children.reduce((function(e,i){return t.has(i.ID)&&(e=t.get(i.ID)),e}),null),n=new THREE.LineBasicMaterial({color:3342591,linewidth:1});return new THREE.Line(i,n)},setModelTransforms:function(e,t){var i={};"RotationOrder"in t&&(i.eulerOrder=parseInt(t.RotationOrder.value)),"Lcl_Translation"in t&&(i.translation=t.Lcl_Translation.value),"RotationOffset"in t&&(i.rotationOffset=t.RotationOffset.value),"Lcl_Rotation"in t&&(i.rotation=t.Lcl_Rotation.value),"PreRotation"in t&&(i.preRotation=t.PreRotation.value),"PostRotation"in t&&(i.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(i.scale=t.Lcl_Scaling.value);var n=E(i);e.applyMatrix(n)},setLookAtProperties:function(n,r){"LookAtProperty"in r&&t.get(n.ID).children.forEach((function(t){if("LookAtProperty"===t.relationship){var r=e.Objects.Model[t.ID];if("Lcl_Translation"in r){var o=r.Lcl_Translation.value;void 0!==n.target?(n.target.position.fromArray(o),i.add(n.target)):n.lookAt((new THREE.Vector3).fromArray(o))}}}))},bindSkeleton:function(e,i,n){var r=this.parsePoseNodes();for(var o in e){var s=e[o];t.get(parseInt(s.ID)).parents.forEach((function(e){if(i.has(e.ID)){var o=e.ID;t.get(o).parents.forEach((function(e){n.has(e.ID)&&n.get(e.ID).bind(new THREE.Skeleton(s.bones),r[e.ID])}))}}))}},parsePoseNodes:function(){var t={};if("Pose"in e.Objects){var i=e.Objects.Pose;for(var n in i)if("BindPose"===i[n].attrType){var r=i[n].PoseNode;Array.isArray(r)?r.forEach((function(e){t[e.Node]=(new THREE.Matrix4).fromArray(e.Matrix.a)})):t[r.Node]=(new THREE.Matrix4).fromArray(r.Matrix.a)}}return t},createAmbientLight:function(){if("GlobalSettings"in e&&"AmbientColor"in e.GlobalSettings){var t=e.GlobalSettings.AmbientColor.value,n=t[0],r=t[1],o=t[2];if(0!==n||0!==r||0!==o){var s=new THREE.Color(n,r,o);i.add(new THREE.AmbientLight(s,1))}}},setupMorphMaterials:function(){i.traverse((function(e){if(e.isMesh&&(e.geometry.morphAttributes.position||e.geometry.morphAttributes.normal)){var t=e.uuid,n=e.material.uuid,r=!1;i.traverse((function(e){e.isMesh&&e.material.uuid===n&&e.uuid!==t&&(r=!0)})),!0===r&&(e.material=e.material.clone()),e.material.morphTargets=!0}}))}},o.prototype={constructor:o,parse:function(i){var n=new Map;if("Geometry"in e.Objects){var r=e.Objects.Geometry;for(var o in r){var s=t.get(parseInt(o)),a=this.parseGeometry(s,r[o],i);n.set(parseInt(o),a)}}return n},parseGeometry:function(e,t,i){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,i);case"NurbsCurve":return this.parseNurbsGeometry(t)}},parseMeshGeometry:function(t,i,n){var r=n.skeletons,o=n.morphTargets,s=t.parents.map((function(t){return e.Objects.Model[t.ID]}));if(0!==s.length){var a=t.children.reduce((function(e,t){return void 0!==r[t.ID]&&(e=r[t.ID]),e}),null),l=t.children.reduce((function(e,t){return void 0!==o[t.ID]&&(e=o[t.ID]),e}),null),c=s[0],h={};"RotationOrder"in c&&(h.eulerOrder=c.RotationOrder.value),"GeometricTranslation"in c&&(h.translation=c.GeometricTranslation.value),"GeometricRotation"in c&&(h.rotation=c.GeometricRotation.value),"GeometricScaling"in c&&(h.scale=c.GeometricScaling.value);var u=E(h);return this.genGeometry(i,a,l,u)}},genGeometry:function(e,t,i,n){var r=new THREE.BufferGeometry;e.attrName&&(r.name=e.attrName);var o=this.parseGeoNode(e,t),s=this.genBuffers(o),a=new THREE.Float32BufferAttribute(s.vertex,3);if(n.applyToBufferAttribute(a),r.addAttribute("position",a),s.colors.length>0&&r.addAttribute("color",new THREE.Float32BufferAttribute(s.colors,3)),t&&(r.addAttribute("skinIndex",new THREE.Uint16BufferAttribute(s.weightsIndices,4)),r.addAttribute("skinWeight",new THREE.Float32BufferAttribute(s.vertexWeights,4)),r.FBX_Deformer=t),s.normal.length>0){var l=new THREE.Float32BufferAttribute(s.normal,3);(new THREE.Matrix3).getNormalMatrix(n).applyToBufferAttribute(l),r.addAttribute("normal",l)}if(s.uvs.forEach((function(e,t){var i="uv"+(t+1).toString();0===t&&(i="uv"),r.addAttribute(i,new THREE.Float32BufferAttribute(s.uvs[t],2))})),o.material&&"AllSame"!==o.material.mappingType){var c=s.materialIndex[0],h=0;if(s.materialIndex.forEach((function(e,t){e!==c&&(r.addGroup(h,t-h,c),c=e,h=t)})),r.groups.length>0){var u=r.groups[r.groups.length-1],d=u.start+u.count;d!==s.materialIndex.length&&r.addGroup(d,s.materialIndex.length-d,c)}0===r.groups.length&&r.addGroup(0,s.materialIndex.length,s.materialIndex[0])}return this.addMorphTargets(r,e,i,n),r},parseGeoNode:function(e,t){var i={};if(i.vertexPositions=void 0!==e.Vertices?e.Vertices.a:[],i.vertexIndices=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(i.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(i.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(i.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){i.uv=[];for(var n=0;e.LayerElementUV[n];)i.uv.push(this.parseUVs(e.LayerElementUV[n])),n++}return i.weightTable={},null!==t&&(i.skeleton=t,t.rawBones.forEach((function(e,t){e.indices.forEach((function(n,r){void 0===i.weightTable[n]&&(i.weightTable[n]=[]),i.weightTable[n].push({id:t,weight:e.weights[r]})}))}))),i},genBuffers:function(e){var t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]},i=0,n=0,r=!1,o=[],s=[],a=[],l=[],c=[],h=[],u=this;return e.vertexIndices.forEach((function(d,p){var m=!1;d<0&&(d^=-1,m=!0);var g=[],v=[];if(o.push(3*d,3*d+1,3*d+2),e.color){var y=f(p,i,d,e.color);a.push(y[0],y[1],y[2])}if(e.skeleton){if(void 0!==e.weightTable[d]&&e.weightTable[d].forEach((function(e){v.push(e.weight),g.push(e.id)})),v.length>4){r||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),r=!0);var b=[0,0,0,0],E=[0,0,0,0];v.forEach((function(e,t){var i=e,n=g[t];E.forEach((function(e,t,r){if(i>e){r[t]=i,i=e;var o=b[t];b[t]=n,n=o}}))})),g=b,v=E}for(;v.length<4;)v.push(0),g.push(0);for(var x=0;x<4;++x)c.push(v[x]),h.push(g[x])}if(e.normal&&(y=f(p,i,d,e.normal),s.push(y[0],y[1],y[2])),e.material&&"AllSame"!==e.material.mappingType)var w=f(p,i,d,e.material)[0];e.uv&&e.uv.forEach((function(e,t){var n=f(p,i,d,e);void 0===l[t]&&(l[t]=[]),l[t].push(n[0]),l[t].push(n[1])})),n++,m&&(u.genFace(t,e,o,w,s,a,l,c,h,n),i++,n=0,o=[],s=[],a=[],l=[],c=[],h=[])})),t},genFace:function(e,t,i,n,r,o,s,a,l,c){for(var h=2;h<c;h++)e.vertex.push(t.vertexPositions[i[0]]),e.vertex.push(t.vertexPositions[i[1]]),e.vertex.push(t.vertexPositions[i[2]]),e.vertex.push(t.vertexPositions[i[3*(h-1)]]),e.vertex.push(t.vertexPositions[i[3*(h-1)+1]]),e.vertex.push(t.vertexPositions[i[3*(h-1)+2]]),e.vertex.push(t.vertexPositions[i[3*h]]),e.vertex.push(t.vertexPositions[i[3*h+1]]),e.vertex.push(t.vertexPositions[i[3*h+2]]),t.skeleton&&(e.vertexWeights.push(a[0]),e.vertexWeights.push(a[1]),e.vertexWeights.push(a[2]),e.vertexWeights.push(a[3]),e.vertexWeights.push(a[4*(h-1)]),e.vertexWeights.push(a[4*(h-1)+1]),e.vertexWeights.push(a[4*(h-1)+2]),e.vertexWeights.push(a[4*(h-1)+3]),e.vertexWeights.push(a[4*h]),e.vertexWeights.push(a[4*h+1]),e.vertexWeights.push(a[4*h+2]),e.vertexWeights.push(a[4*h+3]),e.weightsIndices.push(l[0]),e.weightsIndices.push(l[1]),e.weightsIndices.push(l[2]),e.weightsIndices.push(l[3]),e.weightsIndices.push(l[4*(h-1)]),e.weightsIndices.push(l[4*(h-1)+1]),e.weightsIndices.push(l[4*(h-1)+2]),e.weightsIndices.push(l[4*(h-1)+3]),e.weightsIndices.push(l[4*h]),e.weightsIndices.push(l[4*h+1]),e.weightsIndices.push(l[4*h+2]),e.weightsIndices.push(l[4*h+3])),t.color&&(e.colors.push(o[0]),e.colors.push(o[1]),e.colors.push(o[2]),e.colors.push(o[3*(h-1)]),e.colors.push(o[3*(h-1)+1]),e.colors.push(o[3*(h-1)+2]),e.colors.push(o[3*h]),e.colors.push(o[3*h+1]),e.colors.push(o[3*h+2])),t.material&&"AllSame"!==t.material.mappingType&&(e.materialIndex.push(n),e.materialIndex.push(n),e.materialIndex.push(n)),t.normal&&(e.normal.push(r[0]),e.normal.push(r[1]),e.normal.push(r[2]),e.normal.push(r[3*(h-1)]),e.normal.push(r[3*(h-1)+1]),e.normal.push(r[3*(h-1)+2]),e.normal.push(r[3*h]),e.normal.push(r[3*h+1]),e.normal.push(r[3*h+2])),t.uv&&t.uv.forEach((function(t,i){void 0===e.uvs[i]&&(e.uvs[i]=[]),e.uvs[i].push(s[i][0]),e.uvs[i].push(s[i][1]),e.uvs[i].push(s[i][2*(h-1)]),e.uvs[i].push(s[i][2*(h-1)+1]),e.uvs[i].push(s[i][2*h]),e.uvs[i].push(s[i][2*h+1])}))},addMorphTargets:function(t,i,n,r){if(null!==n){t.morphAttributes.position=[],t.morphAttributes.normal=[];var o=this;n.rawTargets.forEach((function(n){var s=e.Objects.Geometry[n.geoID];void 0!==s&&o.genMorphGeometry(t,i,s,r)}))}},genMorphGeometry:function(e,t,i,n){var r=new THREE.BufferGeometry;i.attrName&&(r.name=i.attrName);for(var o=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],s=void 0!==t.Vertices?t.Vertices.a.slice():[],a=void 0!==i.Vertices?i.Vertices.a:[],l=void 0!==i.Indexes?i.Indexes.a:[],c=0;c<l.length;c++){var h=3*l[c];s[h]+=a[3*c],s[h+1]+=a[3*c+1],s[h+2]+=a[3*c+2]}var u={vertexIndices:o,vertexPositions:s},d=this.genBuffers(u),p=new THREE.Float32BufferAttribute(d.vertex,3);p.name=i.attrName,n.applyToBufferAttribute(p),e.morphAttributes.position.push(p)},parseNormals:function(e){var t=e.MappingInformationType,i=e.ReferenceInformationType,n=e.Normals.a,r=[];return"IndexToDirect"===i&&("NormalIndex"in e?r=e.NormalIndex.a:"NormalsIndex"in e&&(r=e.NormalsIndex.a)),{dataSize:3,buffer:n,indices:r,mappingType:t,referenceType:i}},parseUVs:function(e){var t=e.MappingInformationType,i=e.ReferenceInformationType,n=e.UV.a,r=[];return"IndexToDirect"===i&&(r=e.UVIndex.a),{dataSize:2,buffer:n,indices:r,mappingType:t,referenceType:i}},parseVertexColors:function(e){var t=e.MappingInformationType,i=e.ReferenceInformationType,n=e.Colors.a,r=[];return"IndexToDirect"===i&&(r=e.ColorIndex.a),{dataSize:4,buffer:n,indices:r,mappingType:t,referenceType:i}},parseMaterialIndices:function(e){var t=e.MappingInformationType,i=e.ReferenceInformationType;if("NoMappingInformation"===t)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:i};for(var n=e.Materials.a,r=[],o=0;o<n.length;++o)r.push(o);return{dataSize:1,buffer:n,indices:r,mappingType:t,referenceType:i}},parseNurbsGeometry:function(e){if(void 0===THREE.NURBSCurve)return console.error("THREE.FBXLoader: The loader relies on THREE.NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new THREE.BufferGeometry;var t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new THREE.BufferGeometry;for(var i,n,r=t-1,o=e.KnotVector.a,s=[],a=e.Points.a,l=0,c=a.length;l<c;l+=4)s.push((new THREE.Vector4).fromArray(a,l));if("Closed"===e.Form)s.push(s[0]);else if("Periodic"===e.Form)for(i=r,n=o.length-1-i,l=0;l<r;++l)s.push(s[l]);var h=new THREE.NURBSCurve(r,o,s,i,n).getPoints(7*s.length),u=new Float32Array(3*h.length);h.forEach((function(e,t){e.toArray(u,3*t)}));var d=new THREE.BufferGeometry;return d.addAttribute("position",new THREE.BufferAttribute(u,3)),d}},s.prototype={constructor:s,parse:function(){var e=[],t=this.parseClips();if(void 0===t)return e;for(var i in t){var n=t[i],r=this.addClip(n);e.push(r)}return e},parseClips:function(){if(void 0!==e.Objects.AnimationCurve){var t=this.parseAnimationCurveNodes();this.parseAnimationCurves(t);var i=this.parseAnimationLayers(t);return this.parseAnimStacks(i)}},parseAnimationCurveNodes:function(){var t=e.Objects.AnimationCurveNode,i=new Map;for(var n in t){var r=t[n];if(null!==r.attrName.match(/S|R|T|DeformPercent/)){var o={id:r.id,attr:r.attrName,curves:{}};i.set(o.id,o)}}return i},parseAnimationCurves:function(i){var n=e.Objects.AnimationCurve;for(var r in n){var o={id:n[r].id,times:n[r].KeyTime.a.map(d),values:n[r].KeyValueFloat.a},s=t.get(o.id);if(void 0!==s){var a=s.parents[0].ID,l=s.parents[0].relationship;l.match(/X/)?i.get(a).curves.x=o:l.match(/Y/)?i.get(a).curves.y=o:l.match(/Z/)?i.get(a).curves.z=o:l.match(/d|DeformPercent/)&&i.has(a)&&(i.get(a).curves.morph=o)}}},parseAnimationLayers:function(i){var n=e.Objects.AnimationLayer,r=new Map;for(var o in n){var s=[],a=t.get(parseInt(o));if(void 0!==a){var l=a.children,c=this;l.forEach((function(n,r){if(i.has(n.ID)){var o=i.get(n.ID);if(void 0!==o.curves.x||void 0!==o.curves.y||void 0!==o.curves.z){if(void 0===s[r]){t.get(n.ID).parents.forEach((function(e){void 0!==e.relationship&&(p=e.ID)}));var a=e.Objects.Model[p.toString()],l={modelName:THREE.PropertyBinding.sanitizeNodeName(a.attrName),initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1],transform:c.getModelAnimTransform(a)};"PreRotation"in a&&(l.preRotations=a.PreRotation.value),"PostRotation"in a&&(l.postRotations=a.PostRotation.value),s[r]=l}s[r][o.attr]=o}else if(void 0!==o.curves.morph){if(void 0===s[r]){var h;t.get(n.ID).parents.forEach((function(e){void 0!==e.relationship&&(h=e.ID)}));var u=t.get(h).parents[0].ID,d=t.get(u).parents[0].ID,p=t.get(d).parents[0].ID;a=e.Objects.Model[p],l={modelName:THREE.PropertyBinding.sanitizeNodeName(a.attrName),morphName:e.Objects.Deformer[h].attrName},s[r]=l}s[r][o.attr]=o}}})),r.set(parseInt(o),s)}}return r},getModelAnimTransform:function(e){var t={};return"RotationOrder"in e&&(t.eulerOrder=parseInt(e.RotationOrder.value)),"Lcl_Translation"in e&&(t.translation=e.Lcl_Translation.value),"RotationOffset"in e&&(t.rotationOffset=e.RotationOffset.value),"Lcl_Rotation"in e&&(t.rotation=e.Lcl_Rotation.value),"PreRotation"in e&&(t.preRotation=e.PreRotation.value),"PostRotation"in e&&(t.postRotation=e.PostRotation.value),"Lcl_Scaling"in e&&(t.scale=e.Lcl_Scaling.value),E(t)},parseAnimStacks:function(i){var n=e.Objects.AnimationStack,r={};for(var o in n){var s=t.get(parseInt(o)).children;s.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");var a=i.get(s[0].ID);r[o]={name:n[o].attrName,layer:a}}return r},addClip:function(e){var t=[],i=this;return e.layer.forEach((function(e){t=t.concat(i.generateTracks(e))})),new THREE.AnimationClip(e.name,-1,t)},generateTracks:function(e){var t=[],i=new THREE.Vector3,n=new THREE.Quaternion,r=new THREE.Vector3;if(e.transform&&e.transform.decompose(i,n,r),i=i.toArray(),n=(new THREE.Euler).setFromQuaternion(n).toArray(),r=r.toArray(),void 0!==e.T&&Object.keys(e.T.curves).length>0){var o=this.generateVectorTrack(e.modelName,e.T.curves,i,"position");void 0!==o&&t.push(o)}if(void 0!==e.R&&Object.keys(e.R.curves).length>0){var s=this.generateRotationTrack(e.modelName,e.R.curves,n,e.preRotations,e.postRotations);void 0!==s&&t.push(s)}if(void 0!==e.S&&Object.keys(e.S.curves).length>0){var a=this.generateVectorTrack(e.modelName,e.S.curves,r,"scale");void 0!==a&&t.push(a)}if(void 0!==e.DeformPercent){var l=this.generateMorphTrack(e);void 0!==l&&t.push(l)}return t},generateVectorTrack:function(e,t,i,n){var r=this.getTimesForAllAxes(t),o=this.getKeyframeTrackValues(r,t,i);return new THREE.VectorKeyframeTrack(e+"."+n,r,o)},generateRotationTrack:function(e,t,i,n,r){void 0!==t.x&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(THREE.Math.degToRad)),void 0!==t.y&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(THREE.Math.degToRad)),void 0!==t.z&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(THREE.Math.degToRad));var o=this.getTimesForAllAxes(t),s=this.getKeyframeTrackValues(o,t,i);void 0!==n&&((n=n.map(THREE.Math.degToRad)).push("ZYX"),n=(new THREE.Euler).fromArray(n),n=(new THREE.Quaternion).setFromEuler(n)),void 0!==r&&((r=r.map(THREE.Math.degToRad)).push("ZYX"),r=(new THREE.Euler).fromArray(r),r=(new THREE.Quaternion).setFromEuler(r).inverse());for(var a=new THREE.Quaternion,l=new THREE.Euler,c=[],h=0;h<s.length;h+=3)l.set(s[h],s[h+1],s[h+2],"ZYX"),a.setFromEuler(l),void 0!==n&&a.premultiply(n),void 0!==r&&a.multiply(r),a.toArray(c,h/3*4);return new THREE.QuaternionKeyframeTrack(e+".quaternion",o,c)},generateMorphTrack:function(e){var t=e.DeformPercent.curves.morph,n=t.values.map((function(e){return e/100})),r=i.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new THREE.NumberKeyframeTrack(e.modelName+".morphTargetInfluences["+r+"]",t.times,n)},getTimesForAllAxes:function(e){var t=[];return void 0!==e.x&&(t=t.concat(e.x.times)),void 0!==e.y&&(t=t.concat(e.y.times)),void 0!==e.z&&(t=t.concat(e.z.times)),t.sort((function(e,t){return e-t})).filter((function(e,t,i){return i.indexOf(e)==t}))},getKeyframeTrackValues:function(e,t,i){var n=i,r=[],o=-1,s=-1,a=-1;return e.forEach((function(e){if(t.x&&(o=t.x.times.indexOf(e)),t.y&&(s=t.y.times.indexOf(e)),t.z&&(a=t.z.times.indexOf(e)),-1!==o){var i=t.x.values[o];r.push(i),n[0]=i}else r.push(n[0]);if(-1!==s){var l=t.y.values[s];r.push(l),n[1]=l}else r.push(n[1]);if(-1!==a){var c=t.z.values[a];r.push(c),n[2]=c}else r.push(n[2])})),r},interpolateRotations:function(e){for(var t=1;t<e.values.length;t++){var i=e.values[t-1],n=e.values[t]-i,r=Math.abs(n);if(r>=180){for(var o=r/180,s=n/o,a=i+s,l=e.times[t-1],c=(e.times[t]-l)/o,h=l+c,u=[],d=[];h<e.times[t];)u.push(h),h+=c,d.push(a),a+=s;e.times=k(e.times,t,u),e.values=k(e.values,t,d)}}}},a.prototype={constructor:a,getPrevNode:function(){return this.nodeStack[this.currentIndent-2]},getCurrentNode:function(){return this.nodeStack[this.currentIndent-1]},getCurrentProp:function(){return this.currentProp},pushStack:function(e){this.nodeStack.push(e),this.currentIndent+=1},popStack:function(){this.nodeStack.pop(),this.currentIndent-=1},setCurrentProp:function(e,t){this.currentProp=e,this.currentPropName=t},parse:function(e){this.currentIndent=0,console.log("FBXTree: ",h),this.allNodes=new h,this.nodeStack=[],this.currentProp=[],this.currentPropName="";var t=this,i=e.split(/[\r\n]+/);return i.forEach((function(e,n){var r=e.match(/^[\s\t]*;/),o=e.match(/^[\s\t]*$/);if(!r&&!o){var s=e.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),a=e.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),l=e.match("^\\t{"+(t.currentIndent-1)+"}}");s?t.parseNodeBegin(e,s):a?t.parseNodeProperty(e,a,i[++n]):l?t.popStack():e.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(e)}})),this.allNodes},parseNodeBegin:function(e,t){var i=t[1].trim().replace(/^"/,"").replace(/"$/,""),n=t[2].split(",").map((function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")})),r={name:i},o=this.parseNodeAttr(n),s=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(i,r):i in s?("PoseNode"===i?s.PoseNode.push(r):void 0!==s[i].id&&(s[i]={},s[i][s[i].id]=s[i]),""!==o.id&&(s[i][o.id]=r)):"number"==typeof o.id?(s[i]={},s[i][o.id]=r):"Properties70"!==i&&(s[i]="PoseNode"===i?[r]:r),"number"==typeof o.id&&(r.id=o.id),""!==o.name&&(r.attrName=o.name),""!==o.type&&(r.attrType=o.type),this.pushStack(r)},parseNodeAttr:function(e){var t=e[0];""!==e[0]&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));var i="",n="";return e.length>1&&(i=e[1].replace(/^(\w+)::/,""),n=e[2]),{id:t,name:i,type:n}},parseNodeProperty:function(e,t,i){var n=t[1].replace(/^"/,"").replace(/"$/,"").trim(),r=t[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===n&&","===r&&(r=i.replace(/"/g,"").replace(/,$/,"").trim());var o=this.getCurrentNode();if("Properties70"!==o.name){if("C"===n){var s=r.split(",").slice(1),a=parseInt(s[0]),l=parseInt(s[1]),c=r.split(",").slice(3);n="connections",function(e,t){for(var i=0,n=e.length,r=t.length;i<r;i++,n++)e[n]=t[i]}(r=[a,l],c=c.map((function(e){return e.trim().replace(/^"/,"")}))),void 0===o[n]&&(o[n]=[])}"Node"===n&&(o.id=r),n in o&&Array.isArray(o[n])?o[n].push(r):"a"!==n?o[n]=r:o.a=r,this.setCurrentProp(o,n),"a"===n&&","!==r.slice(-1)&&(o.a=w(r))}else this.parseNodeSpecialProperty(e,n,r)},parseNodePropertyContinued:function(e){var t=this.getCurrentNode();t.a+=e,","!==e.slice(-1)&&(t.a=w(t.a))},parseNodeSpecialProperty:function(e,t,i){var n=i.split('",').map((function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")})),r=n[0],o=n[1],s=n[2],a=n[3],l=n[4];switch(o){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":l=parseFloat(l);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":l=w(l)}this.getPrevNode()[r]={type:o,type2:s,flag:a,value:l},this.setCurrentProp(this.getPrevNode(),r)}},l.prototype={constructor:l,parse:function(e){var t=new c(e);t.skip(23);var i=t.getUint32();console.log("THREE.FBXLoader: FBX binary version: "+i);for(var n=new h;!this.endOfContent(t);){var r=this.parseNode(t,i);null!==r&&n.add(r.name,r)}return n},endOfContent:function(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()},parseNode:function(e,t){var i={},n=t>=7500?e.getUint64():e.getUint32(),r=t>=7500?e.getUint64():e.getUint32(),o=(t>=7500?e.getUint64():e.getUint32(),e.getUint8()),s=e.getString(o);if(0===n)return null;for(var a=[],l=0;l<r;l++)a.push(this.parseProperty(e));var c=a.length>0?a[0]:"",h=a.length>1?a[1]:"",u=a.length>2?a[2]:"";for(i.singleProperty=1===r&&e.getOffset()===n;n>e.getOffset();){var d=this.parseNode(e,t);null!==d&&this.parseSubNode(s,i,d)}return i.propertyList=a,"number"==typeof c&&(i.id=c),""!==h&&(i.attrName=h),""!==u&&(i.attrType=u),""!==s&&(i.name=s),i},parseSubNode:function(e,t,i){if(!0===i.singleProperty){var n=i.propertyList[0];Array.isArray(n)?(t[i.name]=i,i.a=n):t[i.name]=n}else if("Connections"===e&&"C"===i.name){var r=[];i.propertyList.forEach((function(e,t){0!==t&&r.push(e)})),void 0===t.connections&&(t.connections=[]),t.connections.push(r)}else if("Properties70"===i.name)Object.keys(i).forEach((function(e){t[e]=i[e]}));else if("Properties70"===e&&"P"===i.name){var o,s=i.propertyList[0],a=i.propertyList[1],l=i.propertyList[2],c=i.propertyList[3];0===s.indexOf("Lcl ")&&(s=s.replace("Lcl ","Lcl_")),0===a.indexOf("Lcl ")&&(a=a.replace("Lcl ","Lcl_")),o="Color"===a||"ColorRGB"===a||"Vector"===a||"Vector3D"===a||0===a.indexOf("Lcl_")?[i.propertyList[4],i.propertyList[5],i.propertyList[6]]:i.propertyList[4],t[s]={type:a,type2:l,flag:c,value:o}}else void 0===t[i.name]?"number"==typeof i.id?(t[i.name]={},t[i.name][i.id]=i):t[i.name]=i:"PoseNode"===i.name?(Array.isArray(t[i.name])||(t[i.name]=[t[i.name]]),t[i.name].push(i)):void 0===t[i.name][i.id]&&(t[i.name][i.id]=i)},parseProperty:function(e){var t=e.getString(1);switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":var i=e.getUint32();return e.getArrayBuffer(i);case"S":return i=e.getUint32(),e.getString(i);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":var n=e.getUint32(),r=e.getUint32(),o=e.getUint32();if(0===r)switch(t){case"b":case"c":return e.getBooleanArray(n);case"d":return e.getFloat64Array(n);case"f":return e.getFloat32Array(n);case"i":return e.getInt32Array(n);case"l":return e.getInt64Array(n)}"undefined"==typeof Zlib&&console.error("THREE.FBXLoader: External library Inflate.min.js required, obtain or import from https://github.com/imaya/zlib.js");var s=new c(new Zlib.Inflate(new Uint8Array(e.getArrayBuffer(o))).decompress().buffer);switch(t){case"b":case"c":return s.getBooleanArray(n);case"d":return s.getFloat64Array(n);case"f":return s.getFloat32Array(n);case"i":return s.getInt32Array(n);case"l":return s.getInt64Array(n)}default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}},c.prototype={constructor:c,getOffset:function(){return this.offset},size:function(){return this.dv.buffer.byteLength},skip:function(e){this.offset+=e},getBoolean:function(){return 1==(1&this.getUint8())},getBooleanArray:function(e){for(var t=[],i=0;i<e;i++)t.push(this.getBoolean());return t},getUint8:function(){var e=this.dv.getUint8(this.offset);return this.offset+=1,e},getInt16:function(){var e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e},getInt32:function(){var e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e},getInt32Array:function(e){for(var t=[],i=0;i<e;i++)t.push(this.getInt32());return t},getUint32:function(){var e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e},getInt64:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,4294967295==(e=4294967295&~e)&&(t=t+1&4294967295),-(4294967296*t+(e=e+1&4294967295))):4294967296*t+e},getInt64Array:function(e){for(var t=[],i=0;i<e;i++)t.push(this.getInt64());return t},getUint64:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e},getFloat32:function(){var e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e},getFloat32Array:function(e){for(var t=[],i=0;i<e;i++)t.push(this.getFloat32());return t},getFloat64:function(){var e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e},getFloat64Array:function(e){for(var t=[],i=0;i<e;i++)t.push(this.getFloat64());return t},getArrayBuffer:function(e){var t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t},getString:function(e){for(var t=[],i=0;i<e;i++)t[i]=this.getUint8();var n=t.indexOf(0);return n>=0&&(t=t.slice(0,n)),THREE.LoaderUtils.decodeText(new Uint8Array(t))}},h.prototype={constructor:h,add:function(e,t){this[e]=t}};var p=[];function f(e,t,i,n){var r;switch(n.mappingType){case"ByPolygonVertex":r=e;break;case"ByPolygon":r=t;break;case"ByVertice":r=i;break;case"AllSame":r=n.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+n.mappingType)}"IndexToDirect"===n.referenceType&&(r=n.indices[r]);var o=r*n.dataSize,s=o+n.dataSize;return function(e,t,i,n){for(var r=i,o=0;r<n;r++,o++)e[o]=t[r];return e}(p,n.buffer,o,s)}var m=new THREE.Matrix4,g=new THREE.Euler,v=new THREE.Vector3,y=new THREE.Vector3,b=new THREE.Matrix4;function E(e){var t=new THREE.Matrix4;y.set(0,0,0),b.identity();var i,n=e.eulerOrder?x(e.eulerOrder):x(0);return e.translation&&y.fromArray(e.translation),e.rotationOffset&&y.add(v.fromArray(e.rotationOffset)),e.rotation&&((i=e.rotation.map(THREE.Math.degToRad)).push(n),b.makeRotationFromEuler(g.fromArray(i))),e.preRotation&&((i=e.preRotation.map(THREE.Math.degToRad)).push(n),m.makeRotationFromEuler(g.fromArray(i)),b.premultiply(m)),e.postRotation&&((i=e.postRotation.map(THREE.Math.degToRad)).push(n),m.makeRotationFromEuler(g.fromArray(i)),m.getInverse(m),b.multiply(m)),e.scale&&t.scale(v.fromArray(e.scale)),t.setPosition(y),t.multiply(b),t}function x(e){var t=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===e?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),t[0]):t[e]}function w(e){return e.split(",").map((function(e){return parseFloat(e)}))}function T(e,t,i){return void 0===t&&(t=0),void 0===i&&(i=e.byteLength),THREE.LoaderUtils.decodeText(new Uint8Array(e,t,i))}function k(e,t,i){return e.slice(0,t).concat(i).concat(e.slice(t))}return n}()},6453:e=>{e.exports=Object.assign((function(){}),{FACE_1:0,FACE_2:1,FACE_3:2,FACE_4:3,L_SHOULDER_1:4,R_SHOULDER_1:5,L_SHOULDER_2:6,R_SHOULDER_2:7,SELECT:8,START:9,DPAD_UP:12,DPAD_DOWN:13,DPAD_LEFT:14,DPAD_RIGHT:15,VENDOR:16})},4379:e=>{e.exports=function(e,t,i){this.type=e,this.index=t,this.pressed=i.pressed,this.value=i.value}},2667:e=>{e.exports={size:5,cellSize:10,extrudeSettings:{amount:1,bevelEnabled:!0,bevelSegments:1,steps:1,bevelSize:.5,bevelThickness:.5},autogenerated:!0,cells:[{q:-1,r:0,s:1,h:1,walkable:!0,userData:{}},{q:0,r:-1,s:1,h:1,walkable:!0,userData:{}},{q:0,r:0,s:0,h:1,walkable:!0,userData:{}},{q:1,r:-1,s:0,h:1,walkable:!0,userData:{}},{q:-1,r:1,s:0,h:0,walkable:!0,userData:{}},{q:0,r:1,s:-1,h:0,walkable:!0,userData:{}},{q:1,r:0,s:-1,h:0,walkable:!0,userData:{}}]}},4657:e=>{function t(e){const t=document.getElementById(e),i=t.parentNode;try{i&&i.removeChild(t)}catch(e){}}e.exports=function(e){return e=e||{},function(i,n){return function(e,i,n){return new n((function(n,r){const o=i.timeout||5e3,s="script_"+Date.now()+"_"+Math.ceil(1e5*Math.random()),a=function(e,t){var i=document.createElement("script");return i.type="text/javascript",i.async=!0,i.id=t,i.src=e,i}(e,s),l=setTimeout((function(){r(new Error("Script request to "+e+" timed out")),t(s)}),o),c=function(e){clearTimeout(e)};a.addEventListener("load",(function(e){n({ok:!0}),c(l),t(s)})),a.addEventListener("error",(function(i){r(new Error("Script request to "+e+" failed "+i)),c(l),t(s)})),function(e){const t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}(a)}))}(i,n=n||{},e.Promise||Promise)}}},3471:e=>{var t,i,n=e.exports={VERSION:"0.1.1",PI:Math.PI,TAU:2*Math.PI,DEG_TO_RAD:.0174532925,RAD_TO_DEG:57.2957795,SQRT3:Math.sqrt(3),TILE:"tile",ENT:"entity",STR:"structure",HEX:"hex",SQR:"square",ABS:"abstract"};n.Board=function(e,t){if(!e)throw new Error("You must pass in a grid system for the board to use.");this.tiles=[],this.tileGroup=null,this.group=new THREE.Object3D,this.grid=null,this.overlay=null,this.finder=new n.AStarFinder(t),n.Loader.init(),this.setGrid(e)},n.Board.prototype={setEntityOnTile:function(e,t){var i=this.grid.cellToPixel(t.cell);e.position.copy(i),e.position.y+=e.heightOffset||0,e.tile&&(e.tile.entity=null),e.tile=t,t.entity=e},addTile:function(e){-1===this.tiles.indexOf(e)&&(this.tiles.push(e),this.snapTileToGrid(e),e.position.y=0,this.tileGroup.add(e.mesh),this.grid.add(e.cell),e.cell.tile=e)},removeTile:function(e){if(e){var t=this.tiles.indexOf(e);this.grid.remove(e.cell),-1!==t&&this.tiles.splice(t,1),e.dispose()}},removeAllTiles:function(){if(this.tileGroup)for(var e=this.tileGroup.children,t=0;t<e.length;t++)this.tileGroup.remove(e[t])},getTileAtCell:function(e){var t=this.grid.cellToHash(e);return e.tile||(void 0!==this.grid.cells[t]?this.grid.cells[t].tile:null)},snapToGrid:function(e){var t=this.grid.pixelToCell(e);e.copy(this.grid.cellToPixel(t))},snapTileToGrid:function(e){if(e.cell)e.position.copy(this.grid.cellToPixel(e.cell));else{var t=this.grid.pixelToCell(e.position);e.position.copy(this.grid.cellToPixel(t))}return e},getRandomTile:function(){var e=n.Tools.randomInt(0,this.tiles.length-1);return this.tiles[e]},findPath:function(e,t,i){return this.finder.findPath(e.cell,t.cell,i,this.grid)},setGrid:function(e){this.group.remove(this.tileGroup),this.grid&&e!==this.grid&&(this.removeAllTiles(),this.tiles.forEach((function(e){this.grid.remove(e.cell),e.dispose()})),this.grid.dispose()),this.grid=e,this.tiles=[],this.tileGroup=new THREE.Object3D,this.group.add(this.tileGroup)},generateOverlay:function(e){var t=new THREE.LineBasicMaterial({color:0,opacity:.3});this.overlay&&this.group.remove(this.overlay),this.overlay=new THREE.Object3D,this.grid.generateOverlay(e,this.overlay,t),this.group.add(this.overlay)},generateTilemap:function(e){this.reset();var t=this.grid.generateTiles(e);this.tiles=t,this.tileGroup=new THREE.Object3D;for(var i=0;i<t.length;i++)this.tileGroup.add(t[i].mesh);this.group.add(this.tileGroup)},reset:function(){this.removeAllTiles(),this.tileGroup&&this.group.remove(this.tileGroup)}},n.Board.prototype.constructor=n.Board,n.Cell=function(e,t,i,r){this.q=e||0,this.r=t||0,this.s=i||0,this.h=r||1,this.tile=null,this.userData={},this.walkable=!0,this._calcCost=0,this._priority=0,this._visited=!1,this._parent=null,this.uniqueID=n.LinkedList.generateID()},n.Cell.prototype={set:function(e,t,i){return this.q=e,this.r=t,this.s=i,this},copy:function(e){return this.q=e.q,this.r=e.r,this.s=e.s,this.h=e.h,this.tile=e.tile||null,this.userData=e.userData||{},this.walkable=e.walkable,this},add:function(e){return this.q+=e.q,this.r+=e.r,this.s+=e.s,this},equals:function(e){return this.q===e.q&&this.r===e.r&&this.s===e.s}},n.Cell.prototype.constructor=n.Cell,n.HexGrid=function(e){e=e||{},this.type=n.HEX,this.size=5,this.cellSize=void 0===e.cellSize?10:e.cellSize,this.cells={},this.numCells=0,this.extrudeSettings=null,this.autogenerated=!1;var t,i=[];for(t=0;6>t;t++)i.push(this._createVertex(t));for(this.cellShape=new THREE.Shape,this.cellShape.moveTo(i[0].x,i[0].y),t=1;6>t;t++)this.cellShape.lineTo(i[t].x,i[t].y);this.cellShape.lineTo(i[0].x,i[0].y),this.cellShape.autoClose=!0,this.cellGeo=new THREE.Geometry,this.cellGeo.vertices=i,this.cellGeo.verticesNeedUpdate=!0,this.cellShapeGeo=new THREE.ShapeGeometry(this.cellShape),this._cellWidth=2*this.cellSize,this._cellLength=.5*n.SQRT3*this._cellWidth,this._hashDelimeter=".",this._directions=[new n.Cell(1,-1,0),new n.Cell(1,0,-1),new n.Cell(0,1,-1),new n.Cell(-1,1,0),new n.Cell(-1,0,1),new n.Cell(0,-1,1)],this._diagonals=[new n.Cell(2,-1,-1),new n.Cell(1,1,-2),new n.Cell(-1,2,-1),new n.Cell(-2,1,1),new n.Cell(-1,-1,2),new n.Cell(1,-2,1)],this._list=[],this._vec3=new THREE.Vector3,this._cel=new n.Cell,this._conversionVec=new THREE.Vector3,this._geoCache=[],this._matCache=[]},n.HexGrid.TWO_THIRDS=2/3,n.HexGrid.prototype={cellToPixel:function(e){return this._vec3.x=e.q*this._cellWidth*.75,this._vec3.y=e.h,this._vec3.z=-(e.s-e.r)*this._cellLength*.5,this._vec3},pixelToCell:function(e){var t=e.x*(n.HexGrid.TWO_THIRDS/this.cellSize),i=(-e.x/3+n.SQRT3/3*e.z)/this.cellSize;return this._cel.set(t,i,-t-i),this._cubeRound(this._cel)},getCellAt:function(e){var t=e.x*(n.HexGrid.TWO_THIRDS/this.cellSize),i=(-e.x/3+n.SQRT3/3*e.z)/this.cellSize;return this._cel.set(t,i,-t-i),this._cubeRound(this._cel),this.cells[this.cellToHash(this._cel)]},getNeighbors:function(e,t,i){var n,r,o=this._directions.length;for(this._list.length=0,n=0;o>n;n++)this._cel.copy(e),this._cel.add(this._directions[n]),!(r=this.cells[this.cellToHash(this._cel)])||i&&!i(e,r)||this._list.push(r);if(t)for(n=0;o>n;n++)this._cel.copy(e),this._cel.add(this._diagonals[n]),!(r=this.cells[this.cellToHash(this._cel)])||i&&!i(e,r)||this._list.push(r);return this._list},getRandomCell:function(){var e,t=0,i=n.Tools.randomInt(0,this.numCells);for(e in this.cells){if(t===i)return this.cells[e];t++}return this.cells[e]},cellToHash:function(e){return e.q+this._hashDelimeter+e.r+this._hashDelimeter+e.s},distance:function(e,t){return Math.max(Math.abs(e.q-t.q),Math.abs(e.r-t.r),Math.abs(e.s-t.s))+(t.h-e.h)},clearPath:function(){var e,t;for(e in this.cells)(t=this.cells[e])._calcCost=0,t._priority=0,t._parent=null,t._visited=!1},traverse:function(e){var t;for(t in this.cells)e(this.cells[t])},generateTile:function(e,t,i){var r=Math.abs(e.h);1>r&&(r=1);var o=this._geoCache[r];o||(this.extrudeSettings.amount=r,o=new THREE.ExtrudeGeometry(this.cellShape,this.extrudeSettings),this._geoCache[r]=o);var s=new n.Tile({size:this.cellSize,scale:t,cell:e,geometry:o,material:i});return e.tile=s,s},generateTiles:function(e){e=e||{};var t,i,r,o=[],s={tileScale:.95,cellSize:this.cellSize,material:null,extrudeSettings:{amount:1,bevelEnabled:!0,bevelSegments:1,steps:1,bevelSize:.5,bevelThickness:.5}};for(t in s=n.Tools.merge(s,e),this.cellSize=s.cellSize,this._cellWidth=2*this.cellSize,this._cellLength=.5*n.SQRT3*this._cellWidth,this.autogenerated=!0,this.extrudeSettings=s.extrudeSettings,this.cells)r=this.cells[t],(i=this.generateTile(r,s.tileScale,s.material)).position.copy(this.cellToPixel(r)),i.position.y=0,o.push(i);return o},generateTilePoly:function(e){e||(e=new THREE.MeshBasicMaterial({color:2405631}));var t=new THREE.Mesh(this.cellShapeGeo,e);return this._vec3.set(1,0,0),t.rotateOnAxis(this._vec3,n.PI/2),t},generate:function(e){var t,i,r,o;for(e=e||{},this.size=void 0===e.size?this.size:e.size,t=-this.size;t<this.size+1;t++)for(i=-this.size;i<this.size+1;i++)r=-t-i,Math.abs(t)<=this.size&&Math.abs(i)<=this.size&&Math.abs(r)<=this.size&&(o=new n.Cell(t,i,r),this.add(o))},generateOverlay:function(e,t,i){var r,o,s,a=this.cellShape.createPointsGeometry();for(r=-e;e+1>r;r++)for(o=-e;e+1>o;o++)if(s=-r-o,Math.abs(r)<=e&&Math.abs(o)<=e&&Math.abs(s)<=e){this._cel.set(r,o,s);var l=new THREE.Line(a,i);l.position.copy(this.cellToPixel(this._cel)),l.rotation.x=90*n.DEG_TO_RAD,t.add(l)}},add:function(e){var t=this.cellToHash(e);if(!this.cells[t])return this.cells[t]=e,this.numCells++,e},remove:function(e){var t=this.cellToHash(e);this.cells[t]&&(delete this.cells[t],this.numCells--)},dispose:function(){this.cells=null,this.numCells=0,this.cellShape=null,this.cellGeo.dispose(),this.cellGeo=null,this.cellShapeGeo.dispose(),this.cellShapeGeo=null,this._list=null,this._vec3=null,this._conversionVec=null,this._geoCache=null,this._matCache=null},load:function(e,t,i){var r=this;n.Tools.getJSON({url:e,callback:function(e){r.fromJSON(e),t.call(i||null,e)},cache:!1,scope:r})},fromJSON:function(e){var t,i,r=e.cells;for(this.cells={},this.numCells=0,this.size=e.size,this.cellSize=e.cellSize,this._cellWidth=2*this.cellSize,this._cellLength=.5*n.SQRT3*this._cellWidth,this.extrudeSettings=e.extrudeSettings,this.autogenerated=e.autogenerated,t=0;t<r.length;t++)(i=new n.Cell).copy(r[t]),this.add(i)},toJSON:function(){var e,t,i={size:this.size,cellSize:this.cellSize,extrudeSettings:this.extrudeSettings,autogenerated:this.autogenerated},n=[];for(t in this.cells)e=this.cells[t],n.push({q:e.q,r:e.r,s:e.s,h:e.h,walkable:e.walkable,userData:e.userData});return i.cells=n,i},_createVertex:function(e){var t=n.TAU/6*e;return new THREE.Vector3(this.cellSize*Math.cos(t),this.cellSize*Math.sin(t),0)},_cubeRound:function(e){var t=Math.round(e.q),i=Math.round(e.r),n=Math.round(e.s),r=Math.abs(t-e.q),o=Math.abs(i-e.r),s=Math.abs(n-e.s);return r>o&&r>s?t=-i-n:o>s?i=-t-n:n=-t-i,this._cel.set(t,i,n)}},n.HexGrid.prototype.constructor=n.HexGrid,n.SqrGrid=function(e){e=e||{},this.type=n.SQR,this.size=5,this.cellSize=void 0===e.cellSize?10:e.cellSize,this.cells={},this.numCells=0,this.extrudeSettings=null,this.autogenerated=!1;var t=[];t.push(new THREE.Vector3),t.push(new THREE.Vector3(-this.cellSize,this.cellSize)),t.push(new THREE.Vector3(this.cellSize,this.cellSize)),t.push(new THREE.Vector3(this.cellSize,-this.cellSize)),this.cellShape=new THREE.Shape,this.cellShape.moveTo(-this.cellSize,-this.cellSize),this.cellShape.lineTo(-this.cellSize,this.cellSize),this.cellShape.lineTo(this.cellSize,this.cellSize),this.cellShape.lineTo(this.cellSize,-this.cellSize),this.cellShape.lineTo(-this.cellSize,-this.cellSize),this.cellGeo=new THREE.Geometry,this.cellGeo.vertices=t,this.cellGeo.verticesNeedUpdate=!0,this.cellShapeGeo=new THREE.ShapeGeometry(this.cellShape),this._fullCellSize=2*this.cellSize,this._hashDelimeter=".",this._directions=[new n.Cell(1,0,0),new n.Cell(0,-1,0),new n.Cell(-1,0,0),new n.Cell(0,1,0)],this._diagonals=[new n.Cell(-1,-1,0),new n.Cell(-1,1,0),new n.Cell(1,1,0),new n.Cell(1,-1,0)],this._list=[],this._vec3=new THREE.Vector3,this._cel=new n.Cell,this._conversionVec=new THREE.Vector3,this._geoCache=[],this._matCache=[]},n.SqrGrid.prototype={cellToPixel:function(e){return this._vec3.x=e.q*this._fullCellSize,this._vec3.y=e.h,this._vec3.z=e.r*this._fullCellSize,this._vec3},pixelToCell:function(e){var t=Math.round(e.x/this._fullCellSize),i=Math.round(e.z/this._fullCellSize);return this._cel.set(t,i,0)},getCellAt:function(e){var t=Math.round(e.x/this._fullCellSize),i=Math.round(e.z/this._fullCellSize);return this._cel.set(t,i),this.cells[this.cellToHash(this._cel)]},getNeighbors:function(e,t,i){var n,r,o=this._directions.length;for(this._list.length=0,n=0;o>n;n++)this._cel.copy(e),this._cel.add(this._directions[n]),!(r=this.cells[this.cellToHash(this._cel)])||i&&!i(e,r)||this._list.push(r);if(t)for(n=0;o>n;n++)this._cel.copy(e),this._cel.add(this._diagonals[n]),!(r=this.cells[this.cellToHash(this._cel)])||i&&!i(e,r)||this._list.push(r);return this._list},getRandomCell:function(){var e,t=0,i=n.Tools.randomInt(0,this.numCells);for(e in this.cells){if(t===i)return this.cells[e];t++}return this.cells[e]},cellToHash:function(e){return e.q+this._hashDelimeter+e.r},distance:function(e,t){return Math.max(Math.abs(e.q-t.q),Math.abs(e.r-t.r))+(t.h-e.h)},clearPath:function(){var e,t;for(e in this.cells)(t=this.cells[e])._calcCost=0,t._priority=0,t._parent=null,t._visited=!1},traverse:function(e){var t;for(t in this.cells)e(this.cells[t])},generateTile:function(e,t,i){var r=Math.abs(e.h);1>r&&(r=1);var o=this._geoCache[r];o||(this.extrudeSettings.amount=r,o=new THREE.ExtrudeGeometry(this.cellShape,this.extrudeSettings),this._geoCache[r]=o);var s=new n.Tile({size:this.cellSize,scale:t,cell:e,geometry:o,material:i});return e.tile=s,s},generateTiles:function(e){e=e||{};var t,i,r,o=[],s={tileScale:.95,cellSize:this.cellSize,material:null,extrudeSettings:{amount:1,bevelEnabled:!0,bevelSegments:1,steps:1,bevelSize:.5,bevelThickness:.5}};for(t in s=n.Tools.merge(s,e),this.cellSize=s.cellSize,this._fullCellSize=2*this.cellSize,this.autogenerated=!0,this.extrudeSettings=s.extrudeSettings,this.cells)r=this.cells[t],(i=this.generateTile(r,s.tileScale,s.material)).position.copy(this.cellToPixel(r)),i.position.y=0,o.push(i);return o},generateTilePoly:function(e){e||(e=new THREE.MeshBasicMaterial({color:2405631}));var t=new THREE.Mesh(this.cellShapeGeo,e);return this._vec3.set(1,0,0),t.rotateOnAxis(this._vec3,n.PI/2),t},generate:function(e){e=e||{},this.size=void 0===e.size?this.size:e.size;var t,i,r,o=Math.ceil(this.size/2);for(t=-o;o>t;t++)for(i=-o;o>i;i++)r=new n.Cell(t,i+1),this.add(r)},generateOverlay:function(e,t,i){var r,o,s=Math.ceil(e/2);for(r=-s;s>r;r++)for(o=-s;s>o;o++){this._cel.set(r,o);var a=new THREE.Line(this.cellGeo,i);a.position.copy(this.cellToPixel(this._cel)),a.rotation.x=90*n.DEG_TO_RAD,t.add(a)}},add:function(e){var t=this.cellToHash(e);if(!this.cells[t])return this.cells[t]=e,this.numCells++,e},remove:function(e){var t=this.cellToHash(e);this.cells[t]&&(delete this.cells[t],this.numCells--)},dispose:function(){this.cells=null,this.numCells=0,this.cellShape=null,this.cellGeo.dispose(),this.cellGeo=null,this.cellShapeGeo.dispose(),this.cellShapeGeo=null,this._list=null,this._vec3=null,this._conversionVec=null,this._geoCache=null,this._matCache=null},load:function(e,t,i){n.Tools.getJSON({url:e,callback:function(e){this.fromJSON(e),t.call(i||null,e)},cache:!1,scope:this})},fromJSON:function(e){var t,i,r=e.cells;for(this.cells={},this.numCells=0,this.size=e.size,this.cellSize=e.cellSize,this._fullCellSize=2*this.cellSize,this.extrudeSettings=e.extrudeSettings,this.autogenerated=e.autogenerated,t=0;t<r.length;t++)(i=new n.Cell).copy(r[t]),this.add(i)},toJSON:function(){var e,t,i={size:this.size,cellSize:this.cellSize,extrudeSettings:this.extrudeSettings,autogenerated:this.autogenerated},n=[];for(t in this.cells)e=this.cells[t],n.push({q:e.q,r:e.r,s:e.s,h:e.h,walkable:e.walkable,userData:e.userData});return i.cells=n,i}},n.SqrGrid.prototype.constructor=n.SqrGrid,n.Tile=function(e){e=e||{};var t={cell:null,geometry:null,material:null};if(!(t=n.Tools.merge(t,e)).cell||!t.geometry)throw new Error("Missing vg.Tile configuration");this.cell=t.cell,this.cell.tile&&this.cell.tile!==this&&this.cell.tile.dispose(),this.cell.tile=this,this.uniqueID=n.Tools.generateID(),this.geometry=t.geometry,this.material=t.material,this.material||(this.material=new THREE.MeshPhongMaterial({color:n.Tools.randomizeRGB("30, 30, 30",13)})),this.objectType=n.TILE,this.entity=null,this.userData={},this.selected=!1,this.highlight="0x0084cc",this.mesh=new THREE.Mesh(this.geometry,this.material),this.mesh.userData.structure=this,this.position=this.mesh.position,this.rotation=this.mesh.rotation,this.rotation.x=-90*n.DEG_TO_RAD,this.mesh.scale.set(t.scale,t.scale,1),this.material.emissive?this._emissive=this.material.emissive.getHex():this._emissive=null},n.Tile.prototype={select:function(){return this.material.emissive&&this.material.emissive.setHex(this.highlight),this.selected=!0,this},deselect:function(){return null!==this._emissive&&this.material.emissive&&this.material.emissive.setHex(this._emissive),this.selected=!1,this},toggle:function(){return this.selected?this.deselect():this.select(),this},dispose:function(){this.cell&&this.cell.tile&&(this.cell.tile=null),this.cell=null,this.position=null,this.rotation=null,this.mesh.parent&&this.mesh.parent.remove(this.mesh),this.mesh.userData.structure=null,this.mesh=null,this.material=null,this.userData=null,this.entity=null,this.geometry=null,this._emissive=null}},n.Tile.prototype.constructor=n.Tile,t=function(){this.obj=null,this.next=null,this.prev=null,this.free=!0},(i=function(){this.first=null,this.last=null,this.length=0,this.objToNodeMap={},this.uniqueID=Date.now()+""+Math.floor(1e3*Math.random()),this.sortArray=[]}).generateID=function(){return Math.random().toString(36).slice(2)+Date.now()},(i.prototype={getNode:function(e){return this.objToNodeMap[e.uniqueID]},addNode:function(e){var n=new t;if(!e.uniqueID)try{e.uniqueID=i.generateID()}catch(e){return console.error("[LinkedList.addNode] obj passed is immutable: cannot attach necessary identifier"),null}return n.obj=e,n.free=!1,this.objToNodeMap[e.uniqueID]=n,n},swapObjects:function(e,t){this.objToNodeMap[e.obj.uniqueID]=null,this.objToNodeMap[t.uniqueID]=e,e.obj=t},add:function(e){var t=this.objToNodeMap[e.uniqueID];if(t){if(!1===t.free)return;t.obj=e,t.free=!1,t.next=null,t.prev=null}else t=this.addNode(e);if(this.first){if(!this.last)throw new Error("[LinkedList.add] No last in the list -- that shouldn't happen here");this.last.next=t,t.prev=this.last,this.last=t,t.next=null}else this.first=t,this.last=t,t.next=null,t.prev=null;this.length++,this.showDebug&&this.dump("after add")},has:function(e){return!!this.objToNodeMap[e.uniqueID]},moveUp:function(e){this.dump("before move up");var t=this.getNode(e);if(!t)throw"Oops, trying to move an object that isn't in the list";if(t.prev){var i=t.prev,n=i.prev;t==this.last&&(this.last=i);var r=t.next;n&&(n.next=t),t.next=i,t.prev=i.prev,i.next=r,i.prev=t,this.first==i&&(this.first=t)}},moveDown:function(e){var t=this.getNode(e);if(!t)throw"Oops, trying to move an object that isn't in the list";if(t.next){var i=t.next;this.moveUp(i.obj),this.last==i&&(this.last=t)}},sort:function(e){var t,i,n=this.sortArray,r=this.first;for(n.length=0;r;)n.push(r.obj),r=r.next;for(this.clear(),n.sort(e),i=n.length,t=0;i>t;t++)this.add(n[t])},remove:function(e){var t=this.getNode(e);return!(!t||t.free||(t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),t.prev||(this.first=t.next),t.next||(this.last=t.prev),t.free=!0,t.prev=null,t.next=null,this.length--,0))},shift:function(){var e=this.first;return 0===this.length?null:(e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),this.first=e.next,e.next||(this.last=null),e.free=!0,e.prev=null,e.next=null,this.length--,e.obj)},pop:function(){var e=this.last;return 0===this.length?null:(e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),this.last=e.prev,e.prev||(this.first=null),e.free=!0,e.prev=null,e.next=null,this.length--,e.obj)},concat:function(e){for(var t=e.first;t;)this.add(t.obj),t=t.next},clear:function(){for(var e=this.first;e;)e.free=!0,e=e.next;this.first=null,this.length=0},dispose:function(){for(var e=this.first;e;)e.obj=null,e=e.next;this.first=null,this.objToNodeMap=null},dump:function(e){console.log("===================="+e+"=====================");for(var t=this.first;t;)console.log("{"+t.obj.toString()+"} previous="+(t.prev?t.prev.obj:"NULL")),t=t.next();console.log("==================================="),console.log("Last: {"+(this.last?this.last.obj:"NULL")+"} First: {"+(this.first?this.first.obj:"NULL")+"}")}}).constructor=i,n.LinkedList=i,function(){var e=function(e,t,i,n,r){this._listener=t,this.isOnce=i,this.context=n,this.signal=e,this._priority=r||0};(e.prototype={active:!0,params:null,execute:function(e){var t,i;return this.active&&this._listener&&(i=this.params?this.params.concat(e):e,t=this._listener.apply(this.context,i),this.isOnce&&this.detach()),t},detach:function(){return this.isBound()?this.signal.remove(this._listener,this.context):null},isBound:function(){return!!this.signal&&!!this._listener},_destroy:function(){delete this.signal,delete this._listener,delete this.context},toString:function(){return"[SignalBinding isOnce:"+this.isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}}).constructor=e;var t=function(){this._bindings=[],this._prevParams=null;var e=this;this.dispatch=function(){t.prototype.dispatch.apply(e,arguments)}};t.prototype={memorize:!1,_shouldPropagate:!0,active:!0,validateListener:function(e,t){if("function"!=typeof e)throw new Error("Signal: listener is a required param of {fn}() and should be a Function.".replace("{fn}",t))},_registerListener:function(t,i,n,r){var o,s=this._indexOfListener(t,n);if(-1!==s){if((o=this._bindings[s]).isOnce!==i)throw new Error("You cannot add"+(i?"":"Once")+"() then add"+(i?"Once":"")+"() the same listener without removing the relationship first.")}else o=new e(this,t,i,n,r),this._addBinding(o);return this.memorize&&this._prevParams&&o.execute(this._prevParams),o},_addBinding:function(e){var t=this._bindings.length;do{t--}while(this._bindings[t]&&e._priority<=this._bindings[t]._priority);this._bindings.splice(t+1,0,e)},_indexOfListener:function(e,t){for(var i,n=this._bindings.length;n--;)if((i=this._bindings[n])._listener===e&&i.context===t)return n;return-1},has:function(e,t){return-1!==this._indexOfListener(e,t)},add:function(e,t,i){return this.validateListener(e,"add"),this._registerListener(e,!1,t,i)},addOnce:function(e,t,i){return this.validateListener(e,"addOnce"),this._registerListener(e,!0,t,i)},remove:function(e,t){this.validateListener(e,"remove");var i=this._indexOfListener(e,t);return-1!==i&&(this._bindings[i]._destroy(),this._bindings.splice(i,1)),e},removeAll:function(e){void 0===e&&(e=null);for(var t=this._bindings.length;t--;)e?this._bindings[t].context===e&&(this._bindings[t]._destroy(),this._bindings.splice(t,1)):this._bindings[t]._destroy();e||(this._bindings.length=0)},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(this.active){var e,t=Array.prototype.slice.call(arguments),i=this._bindings.length;if(this.memorize&&(this._prevParams=t),i){e=this._bindings.slice(),this._shouldPropagate=!0;do{i--}while(e[i]&&this._shouldPropagate&&!1!==e[i].execute(t))}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}},t.prototype.constructor=t,n.Signal=t}(),n.AStarFinder=function(e){e=e||{};var t={allowDiagonal:!1,heuristicFilter:null};t=n.Tools.merge(t,e),this.allowDiagonal=t.allowDiagonal,this.heuristicFilter=t.heuristicFilter,this.list=new n.LinkedList},n.AStarFinder.prototype={findPath:function(e,t,i,r){var o,s,a,l,c,h;for(i=i||this.heuristicFilter,r.clearPath(),this.list.clear(),this.list.add(e);this.list.length>0;){if(this.list.sort(this.compare),(o=this.list.shift())._visited=!0,o===t)return n.PathUtil.backtrace(t);for(c=0,h=(a=r.getNeighbors(o,this.allowDiagonal,i)).length;h>c;c++)if((l=a[c]).walkable&&(s=o._calcCost+r.distance(o,l),!l._visited||s<l._calcCost)){if(l._visited=!0,l._parent=o,l._calcCost=s,l._priority=s+r.distance(t,l),l===t)return n.PathUtil.backtrace(t);this.list.add(l)}}return null},compare:function(e,t){return e._priority-t._priority}},n.AStarFinder.prototype.constructor=n.AStarFinder,n.PathUtil={backtrace:function(e){for(var t=[e];e._parent;)e=e._parent,t.push(e);return t.reverse()},biBacktrace:function(e,t){var i=this.backtrace(e),n=this.backtrace(t);return i.concat(n.reverse())},pathLength:function(e){var t,i,n,r,o,s=0;for(t=1;t<e.length;++t)i=e[t-1],n=e[t],r=i[0]-n[0],o=i[1]-n[1],s+=Math.sqrt(r*r+o*o);return s},interpolate:function(e,t,i,n){var r,o,s,a,l,c,h=Math.abs,u=[];for(r=i>e?1:-1,o=n>t?1:-1,l=(s=h(i-e))-(a=h(n-t));e!==i||t!==n;)u.push([e,t]),(c=2*l)>-a&&(l-=a,e+=r),s>c&&(l+=s,t+=o);return u},expandPath:function(e){var t,i,n,r,o,s,a=[],l=e.length;if(2>l)return a;for(o=0;l-1>o;++o)for(t=e[o],i=e[o+1],r=(n=this.interpolate(t[0],t[1],i[0],i[1])).length,s=0;r-1>s;++s)a.push(n[s]);return a.push(e[l-1]),a},smoothenPath:function(e,t){var i,n,r,o,s,a,l,c,h,u,d,p,f=t.length,m=t[0][0],g=t[0][1],v=t[f-1][0],y=t[f-1][1];for(s=[[i=m,n=g]],l=2;f>l;++l){for(r=(h=t[l])[0],o=h[1],u=this.interpolate(i,n,r,o),p=!1,c=1;c<u.length;++c)if(d=u[c],!e.isWalkableAt(d[0],d[1])){p=!0;break}p&&(a=t[l-1],s.push(a),i=a[0],n=a[1])}return s.push([v,y]),s},compressPath:function(e){if(e.length<3)return e;var t,i,n,r,o,s,a=[],l=e[0][0],c=e[0][1],h=e[1][0],u=e[1][1],d=h-l,p=u-c;for(d/=o=Math.sqrt(d*d+p*p),p/=o,a.push([l,c]),s=2;s<e.length;s++)t=h,i=u,n=d,r=p,d=(h=e[s][0])-t,p=(u=e[s][1])-i,p/=o=Math.sqrt(d*d+p*p),((d/=o)!==n||p!==r)&&a.push([t,i]);return a.push([h,u]),a}},n.Loader={manager:null,imageLoader:null,crossOrigin:!1,init:function(e){this.crossOrigin=e||!1,this.manager=new THREE.LoadingManager((function(){}),(function(){}),(function(){console.warn("Error loading images")})),this.imageLoader=new THREE.ImageLoader(this.manager),this.imageLoader.crossOrigin=e},loadTexture:function(e,t,i,n){var r=new THREE.Texture(null,t);return this.imageLoader.load(e,(function(e){r.image=e,r.needsUpdate=!0,i&&i(r)}),null,(function(e){n&&n(e)})),r.sourceFile=e,r}},n.MouseCaster=function(e,t,i){this.down=!1,this.rightDown=!1,this.pickedObject=null,this.selectedObject=null,this.allHits=null,this.active=!0,this.shift=!1,this.ctrl=!1,this.wheel=0,this.position=new THREE.Vector3,this.screenPosition=new THREE.Vector2,this.signal=new n.Signal,this.group=e,this._camera=t,this._raycaster=new THREE.Raycaster,this._preventDefault=!1,(i=i||document).addEventListener("mousemove",this._onDocumentMouseMove.bind(this),!1),i.addEventListener("mousedown",this._onDocumentMouseDown.bind(this),!1),i.addEventListener("mouseup",this._onDocumentMouseUp.bind(this),!1),i.addEventListener("mousewheel",this._onMouseWheel.bind(this),!1),i.addEventListener("DOMMouseScroll",this._onMouseWheel.bind(this),!1)},n.MouseCaster.OVER="over",n.MouseCaster.OUT="out",n.MouseCaster.DOWN="down",n.MouseCaster.UP="up",n.MouseCaster.CLICK="click",n.MouseCaster.WHEEL="wheel",n.MouseCaster.prototype={update:function(){if(this.active){this._raycaster.setFromCamera(this.screenPosition,this._camera);var e,t,i=this._raycaster.intersectObject(this.group,!0);i.length>0?(t=(e=i[0]).object.userData.structure,this.pickedObject!=t&&(this.pickedObject&&this.signal.dispatch(n.MouseCaster.OUT,this.pickedObject),this.pickedObject=t,this.selectedObject=null,this.signal.dispatch(n.MouseCaster.OVER,this.pickedObject)),this.position.copy(e.point),this.screenPosition.z=e.distance):(this.pickedObject&&this.signal.dispatch(n.MouseCaster.OUT,this.pickedObject),this.pickedObject=null,this.selectedObject=null),this.allHits=i}},preventDefault:function(){this._preventDefault=!0},_onDocumentMouseDown:function(e){return(e=e||window.event).preventDefault(),this._preventDefault?(this._preventDefault=!1,!1):(this.pickedObject&&(this.selectedObject=this.pickedObject),this.shift=e.shiftKey,this.ctrl=e.ctrlKey,this.down=1===e.which,this.rightDown=3===e.which,void this.signal.dispatch(n.MouseCaster.DOWN,this.pickedObject))},_onDocumentMouseUp:function(e){return e.preventDefault(),this._preventDefault?(this._preventDefault=!1,!1):(this.shift=e.shiftKey,this.ctrl=e.ctrlKey,this.signal.dispatch(n.MouseCaster.UP,this.pickedObject),this.selectedObject&&this.pickedObject&&this.selectedObject.uniqueID===this.pickedObject.uniqueID&&this.signal.dispatch(n.MouseCaster.CLICK,this.pickedObject),this.down=1!==e.which&&this.down,void(this.rightDown=3!==e.which&&this.rightDown))},_onDocumentMouseMove:function(e){e.preventDefault(),this.screenPosition.x=e.clientX/window.innerWidth*2-1,this.screenPosition.y=-e.clientY/window.innerHeight*2+1},_onMouseWheel:function(e){if(this.active){e.preventDefault(),e.stopPropagation();var t=0;void 0!==e.wheelDelta?t=e.wheelDelta:void 0!==e.detail&&(t=-e.detail),t>0?this.wheel++:this.wheel--,this.signal.dispatch(n.MouseCaster.WHEEL,this.wheel)}}},n.MouseCaster.prototype.constructor=n.MouseCaster,n.Scene=function(e,t){var i={element:document.body,alpha:!0,antialias:!0,clearColor:"#fff",sortObjects:!1,fog:null,light:new THREE.DirectionalLight(16777215),lightPosition:null,cameraType:"PerspectiveCamera",cameraPosition:null,orthoZoom:4},r={minDistance:100,maxDistance:1e3,zoomSpeed:2,noZoom:!1};if(i=n.Tools.merge(i,e),"boolean"!=typeof t&&(r=n.Tools.merge(r,t)),this.renderer=new THREE.WebGLRenderer({alpha:i.alpha,antialias:i.antialias}),this.renderer.setClearColor(i.clearColor,0),this.renderer.sortObjects=i.sortObjects,this.width=window.innerWidth,this.height=window.innerHeight,this.orthoZoom=i.orthoZoom,this.container=new THREE.Scene,this.container.fog=i.fog,this.container.add(new THREE.AmbientLight(14540253)),i.lightPosition||i.light.position.set(-1,1,-1).normalize(),this.container.add(i.light),"OrthographicCamera"===i.cameraType){var o=window.innerWidth/this.orthoZoom,s=window.innerHeight/this.orthoZoom;this.camera=new THREE.OrthographicCamera(o/-2,o/2,s/2,s/-2,1,5e3)}else this.camera=new THREE.PerspectiveCamera(50,this.width/this.height,1,5e3);this.contolled=!!t,this.contolled&&(this.controls=new THREE.OrbitControls(this.camera,this.renderer.domElement),this.controls.minDistance=r.minDistance,this.controls.maxDistance=r.maxDistance,this.controls.zoomSpeed=r.zoomSpeed,this.controls.noZoom=r.noZoom),i.cameraPosition&&this.camera.position.copy(i.cameraPosition),window.addEventListener("resize",function(){if(this.width=window.innerWidth,this.height=window.innerHeight,"OrthographicCamera"===this.camera.type){var e=this.width/this.orthoZoom,t=this.height/this.orthoZoom;this.camera.left=e/-2,this.camera.right=e/2,this.camera.top=t/2,this.camera.bottom=t/-2}else this.camera.aspect=this.width/this.height;this.camera.updateProjectionMatrix(),this.renderer.setSize(this.width,this.height)}.bind(this),!1),this.attachTo(i.element)},n.Scene.prototype={attachTo:function(e){e.style.width=this.width+"px",e.style.height=this.height+"px",this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.width,this.height),e.appendChild(this.renderer.domElement)},add:function(e){this.container.add(e)},remove:function(e){this.container.remove(e)},render:function(){this.contolled&&this.controls.update(),this.renderer.render(this.container,this.camera)},updateOrthoZoom:function(){if(this.orthoZoom<=0)this.orthoZoom=0;else{var e=this.width/this.orthoZoom,t=this.height/this.orthoZoom;this.camera.left=e/-2,this.camera.right=e/2,this.camera.top=t/2,this.camera.bottom=t/-2,this.camera.updateProjectionMatrix()}},focusOn:function(e){this.camera.lookAt(e.position)}},n.Scene.prototype.constructor=n.Scene,n.SelectionManager=function(e){this.mouse=e,this.onSelect=new n.Signal,this.onDeselect=new n.Signal,this.selected=null,this.toggleSelection=!1,this.mouse.signal.add(this.onMouse,this)},n.SelectionManager.prototype={select:function(e,t){e&&(t=t||!0,this.selected!==e&&this.clearSelection(t),e.selected?this.toggleSelection&&(t&&this.onDeselect.dispatch(e),e.deselect()):e.select(),this.selected=e,t&&this.onSelect.dispatch(e))},clearSelection:function(e){e=e||!0,this.selected&&(e&&this.onDeselect.dispatch(this.selected),this.selected.deselect()),this.selected=null},onMouse:function(e,t){switch(e){case n.MouseCaster.DOWN:t||this.clearSelection();break;case n.MouseCaster.CLICK:this.select(t)}}},n.SelectionManager.prototype.constructor=n.SelectionManager,n.Tools={clamp:function(e,t,i){return Math.max(t,Math.min(i,e))},sign:function(e){return e&&e/Math.abs(e)},random:function(e,t){return 1===arguments.length?Math.random()*e-.5*e:Math.random()*(t-e)+e},randomInt:function(e,t){return 1===arguments.length?Math.random()*e-.5*e|0:Math.random()*(t-e+1)+e|0},normalize:function(e,t,i){return(e-t)/(i-t)},getShortRotation:function(e){return(e%=this.TAU)>this.PI?e-=this.TAU:e<-this.PI&&(e+=this.TAU),e},generateID:function(){return Math.random().toString(36).slice(2)+Date.now()},isPlainObject:function(e){if("object"!=typeof e||e.nodeType||e===e.window)return!1;try{if(e.constructor&&!Object.prototype.hasOwnProperty.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(e){return!1}return!0},merge:function(e,t){var i=this,n=Array.isArray(t),r=n&&[]||{};return n?(e=e||[],r=r.concat(e),t.forEach((function(t,n){void 0===r[n]?r[n]=t:i.isPlainObject(t)?r[n]=i.merge(e[n],t):-1===e.indexOf(t)&&r.push(t)})),r):(e&&i.isPlainObject(e)&&Object.keys(e).forEach((function(t){r[t]=e[t]})),Object.keys(t).forEach((function(n){t[n]&&i.isPlainObject(t[n])&&e[n]?r[n]=i.merge(e[n],t[n]):r[n]=t[n]})),r)},now:function(){return window.nwf?window.nwf.system.Performance.elapsedTime:window.performance.now()},empty:function(e){for(;e.lastChild;)e.removeChild(e.lastChild)},radixSort:function(e,t,i,n){if(n=n||31,!((t=t||0)>=(i=i||e.length)-1||0>n)){for(var r=t,o=i,s=1<<n;o>r;)if(e[r]&s){--o;var a=e[r];e[r]=e[o],e[o]=a}else++r;this.radixSort(e,t,o,n-1),this.radixSort(e,o,i,n-1)}},randomizeRGB:function(e,t){var i,n,r=e.split(","),o="rgb(";for(t=this.randomInt(t),i=0;3>i;i++)0>(n=parseInt(r[i])+t)?n=0:n>255&&(n=255),o+=n+",";return(o=o.substring(0,o.length-1))+")"},getJSON:function(e){var t=new XMLHttpRequest,i=void 0!==e.cache&&e.cache?e.url:e.url+"?t="+Math.floor(1e4*Math.random())+Date.now();t.onreadystatechange=function(){if(200!==this.status)0!==this.status&&console.warn("[Tools.getJSON] Error: "+this.status+" ("+this.statusText+") :: "+e.url);else{var t=null;try{t=JSON.parse(this.responseText)}catch(e){return}e.callback.call(e.scope||null,t)}},t.open("GET",i,!0),t.setRequestHeader("Accept","application/json"),t.setRequestHeader("Content-Type","application/json"),t.send("")}}},7454:()=>{!function(e){var t="KeyboardEvent"in e;t||(e.KeyboardEvent=function(){throw TypeError("Illegal constructor")}),"DOM_KEY_LOCATION_STANDARD"in e.KeyboardEvent||(e.KeyboardEvent.DOM_KEY_LOCATION_STANDARD=0),"DOM_KEY_LOCATION_LEFT"in e.KeyboardEvent||(e.KeyboardEvent.DOM_KEY_LOCATION_LEFT=1),"DOM_KEY_LOCATION_RIGHT"in e.KeyboardEvent||(e.KeyboardEvent.DOM_KEY_LOCATION_RIGHT=2),"DOM_KEY_LOCATION_NUMPAD"in e.KeyboardEvent||(e.KeyboardEvent.DOM_KEY_LOCATION_NUMPAD=3);var i=window.KeyboardEvent.DOM_KEY_LOCATION_STANDARD,n=window.KeyboardEvent.DOM_KEY_LOCATION_LEFT,r=window.KeyboardEvent.DOM_KEY_LOCATION_RIGHT,o=window.KeyboardEvent.DOM_KEY_LOCATION_NUMPAD;function s(e,t){return-1!==String(e).indexOf(t)}var a=s(navigator.platform,"Win")?"win":s(navigator.platform,"Mac")?"mac":s(navigator.platform,"CrOS")?"cros":s(navigator.platform,"Linux")?"linux":s(navigator.userAgent,"iPad")||s(navigator.platform,"iPod")||s(navigator.platform,"iPhone")?"ios":"",l=s(navigator.userAgent,"Chrome/")?"chrome":s(navigator.vendor,"Apple")?"safari":s(navigator.userAgent,"MSIE")?"ie":s(navigator.userAgent,"Gecko/")?"moz":s(navigator.userAgent,"Opera/")?"opera":"",c=l+"-"+a;function h(e,t,i){c!==t&&l!==t&&a!==t||Object.keys(i).forEach((function(t){e[t]=i[t]}))}var u={3:{code:"Cancel"},6:{code:"Help"},8:{code:"Backspace"},9:{code:"Tab"},12:{code:"Clear"},13:{code:"Enter"},16:{code:"Shift"},17:{code:"Control"},18:{code:"Alt"},19:{code:"Pause"},20:{code:"CapsLock"},21:{code:"KanaMode"},22:{code:"HangulMode"},23:{code:"JunjaMode"},24:{code:"FinalMode"},25:{code:"KanjiMode"},27:{code:"Escape"},28:{code:"Convert"},29:{code:"NonConvert"},30:{code:"Accept"},31:{code:"ModeChange"},32:{code:"Space"},33:{code:"PageUp"},34:{code:"PageDown"},35:{code:"End"},36:{code:"Home"},37:{code:"ArrowLeft"},38:{code:"ArrowUp"},39:{code:"ArrowRight"},40:{code:"ArrowDown"},41:{code:"Select"},42:{code:"Print"},43:{code:"Execute"},44:{code:"PrintScreen"},45:{code:"Insert"},46:{code:"Delete"},47:{code:"Help"},48:{code:"Digit0",keyCap:"0"},49:{code:"Digit1",keyCap:"1"},50:{code:"Digit2",keyCap:"2"},51:{code:"Digit3",keyCap:"3"},52:{code:"Digit4",keyCap:"4"},53:{code:"Digit5",keyCap:"5"},54:{code:"Digit6",keyCap:"6"},55:{code:"Digit7",keyCap:"7"},56:{code:"Digit8",keyCap:"8"},57:{code:"Digit9",keyCap:"9"},65:{code:"KeyA",keyCap:"a"},66:{code:"KeyB",keyCap:"b"},67:{code:"KeyC",keyCap:"c"},68:{code:"KeyD",keyCap:"d"},69:{code:"KeyE",keyCap:"e"},70:{code:"KeyF",keyCap:"f"},71:{code:"KeyG",keyCap:"g"},72:{code:"KeyH",keyCap:"h"},73:{code:"KeyI",keyCap:"i"},74:{code:"KeyJ",keyCap:"j"},75:{code:"KeyK",keyCap:"k"},76:{code:"KeyL",keyCap:"l"},77:{code:"KeyM",keyCap:"m"},78:{code:"KeyN",keyCap:"n"},79:{code:"KeyO",keyCap:"o"},80:{code:"KeyP",keyCap:"p"},81:{code:"KeyQ",keyCap:"q"},82:{code:"KeyR",keyCap:"r"},83:{code:"KeyS",keyCap:"s"},84:{code:"KeyT",keyCap:"t"},85:{code:"KeyU",keyCap:"u"},86:{code:"KeyV",keyCap:"v"},87:{code:"KeyW",keyCap:"w"},88:{code:"KeyX",keyCap:"x"},89:{code:"KeyY",keyCap:"y"},90:{code:"KeyZ",keyCap:"z"},91:{code:"OSLeft",location:n},92:{code:"OSRight",location:r},93:{code:"ContextMenu"},95:{code:"Standby"},96:{code:"Numpad0",keyCap:"0",location:o},97:{code:"Numpad1",keyCap:"1",location:o},98:{code:"Numpad2",keyCap:"2",location:o},99:{code:"Numpad3",keyCap:"3",location:o},100:{code:"Numpad4",keyCap:"4",location:o},101:{code:"Numpad5",keyCap:"5",location:o},102:{code:"Numpad6",keyCap:"6",location:o},103:{code:"Numpad7",keyCap:"7",location:o},104:{code:"Numpad8",keyCap:"8",location:o},105:{code:"Numpad9",keyCap:"9",location:o},106:{code:"NumpadMultiply",keyCap:"*",location:o},107:{code:"NumpadAdd",keyCap:"+",location:o},108:{code:"NumpadComma",keyCap:",",location:o},109:{code:"NumpadSubtract",keyCap:"-",location:o},110:{code:"NumpadDecimal",keyCap:".",location:o},111:{code:"NumpadDivide",keyCap:"/",location:o},112:{code:"F1"},113:{code:"F2"},114:{code:"F3"},115:{code:"F4"},116:{code:"F5"},117:{code:"F6"},118:{code:"F7"},119:{code:"F8"},120:{code:"F9"},121:{code:"F10"},122:{code:"F11"},123:{code:"F12"},124:{code:"F13"},125:{code:"F14"},126:{code:"F15"},127:{code:"F16"},128:{code:"F17"},129:{code:"F18"},130:{code:"F19"},131:{code:"F20"},132:{code:"F21"},133:{code:"F22"},134:{code:"F23"},135:{code:"F24"},144:{code:"NumLock",location:o},145:{code:"ScrollLock"},160:{code:"ShiftLeft",location:n},161:{code:"ShiftRight",location:r},162:{code:"ControlLeft",location:n},163:{code:"ControlRight",location:r},164:{code:"AltLeft",location:n},165:{code:"AltRight",location:r},166:{code:"BrowserBack"},167:{code:"BrowserForward"},168:{code:"BrowserRefresh"},169:{code:"BrowserStop"},170:{code:"BrowserSearch"},171:{code:"BrowserFavorites"},172:{code:"BrowserHome"},173:{code:"VolumeMute"},174:{code:"VolumeDown"},175:{code:"VolumeUp"},176:{code:"MediaTrackNext"},177:{code:"MediaTrackPrevious"},178:{code:"MediaStop"},179:{code:"MediaPlayPause"},180:{code:"LaunchMail"},181:{code:"MediaSelect"},182:{code:"LaunchApp1"},183:{code:"LaunchApp2"},186:{code:"Semicolon",keyCap:";"},187:{code:"Equal",keyCap:"="},188:{code:"Comma",keyCap:","},189:{code:"Minus",keyCap:"-"},190:{code:"Period",keyCap:"."},191:{code:"Slash",keyCap:"/"},192:{code:"Backquote",keyCap:"`"},219:{code:"BracketLeft",keyCap:"["},220:{code:"Backslash",keyCap:"\\"},221:{code:"BracketRight",keyCap:"]"},222:{code:"Quote",keyCap:"'"},226:{code:"IntlBackslash",keyCap:"\\"},229:{code:"Process"},246:{code:"Attn"},247:{code:"CrSel"},248:{code:"ExSel"},249:{code:"EraseEof"},250:{code:"Play"},251:{code:"ZoomToggle"},254:{code:"Clear"}};h(u,"moz",{59:{code:"Semicolon",keyCap:";"},61:{code:"Equal",keyCap:"="},107:{code:"Equal",keyCap:"="},109:{code:"Minus",keyCap:"-"},187:{code:"NumpadAdd",keyCap:"+",location:o},189:{code:"NumpadSubtract",keyCap:"-",location:o}}),h(u,"moz-mac",{12:{code:"NumLock",location:o},173:{code:"Minus",keyCap:"-"}}),h(u,"moz-win",{173:{code:"Minus",keyCap:"-"}}),h(u,"chrome-mac",{93:{code:"OSRight",location:r}}),h(u,"safari",{3:{code:"Enter"},25:{code:"Tab"}}),h(u,"ios",{10:{code:"Enter",location:i}}),h(u,"safari-mac",{91:{code:"OSLeft",location:n},93:{code:"OSRight",location:r},229:{code:"KeyQ",keyCap:"Q"}});var d={};"cros"===a&&(d["U+00A0"]={code:"ShiftLeft",location:n},d["U+00A1"]={code:"ShiftRight",location:r},d["U+00A2"]={code:"ControlLeft",location:n},d["U+00A3"]={code:"ControlRight",location:r},d["U+00A4"]={code:"AltLeft",location:n},d["U+00A5"]={code:"AltRight",location:r}),"chrome-mac"===c&&(d["U+0010"]={code:"ContextMenu"}),"safari-mac"===c&&(d["U+0010"]={code:"ContextMenu"}),"ios"===a&&(d["U+0010"]={code:"Function"},d["U+001C"]={code:"ArrowLeft"},d["U+001D"]={code:"ArrowRight"},d["U+001E"]={code:"ArrowUp"},d["U+001F"]={code:"ArrowDown"},d["U+0001"]={code:"Home"},d["U+0004"]={code:"End"},d["U+000B"]={code:"PageUp"},d["U+000C"]={code:"PageDown"});var p=[];p[n]={16:{code:"ShiftLeft",location:n},17:{code:"ControlLeft",location:n},18:{code:"AltLeft",location:n}},p[r]={16:{code:"ShiftRight",location:r},17:{code:"ControlRight",location:r},18:{code:"AltRight",location:r}},p[o]={13:{code:"NumpadEnter",location:o}},h(p[o],"moz",{109:{code:"NumpadSubtract",location:o},107:{code:"NumpadAdd",location:o}}),h(p[n],"moz-mac",{224:{code:"OSLeft",location:n}}),h(p[r],"moz-mac",{224:{code:"OSRight",location:r}}),h(p[r],"moz-win",{91:{code:"OSRight",location:r}}),h(p[r],"mac",{93:{code:"OSRight",location:r}}),h(p[o],"chrome-mac",{12:{code:"NumLock",location:o}}),h(p[o],"safari-mac",{12:{code:"NumLock",location:o},187:{code:"NumpadAdd",location:o},189:{code:"NumpadSubtract",location:o},190:{code:"NumpadDecimal",location:o},191:{code:"NumpadDivide",location:o}});var f={ShiftLeft:{key:"Shift"},ShiftRight:{key:"Shift"},ControlLeft:{key:"Control"},ControlRight:{key:"Control"},AltLeft:{key:"Alt"},AltRight:{key:"Alt"},OSLeft:{key:"OS"},OSRight:{key:"OS"},NumpadEnter:{key:"Enter"},Space:{key:" "},Digit0:{key:"0",shiftKey:")"},Digit1:{key:"1",shiftKey:"!"},Digit2:{key:"2",shiftKey:"@"},Digit3:{key:"3",shiftKey:"#"},Digit4:{key:"4",shiftKey:"$"},Digit5:{key:"5",shiftKey:"%"},Digit6:{key:"6",shiftKey:"^"},Digit7:{key:"7",shiftKey:"&"},Digit8:{key:"8",shiftKey:"*"},Digit9:{key:"9",shiftKey:"("},KeyA:{key:"a",shiftKey:"A"},KeyB:{key:"b",shiftKey:"B"},KeyC:{key:"c",shiftKey:"C"},KeyD:{key:"d",shiftKey:"D"},KeyE:{key:"e",shiftKey:"E"},KeyF:{key:"f",shiftKey:"F"},KeyG:{key:"g",shiftKey:"G"},KeyH:{key:"h",shiftKey:"H"},KeyI:{key:"i",shiftKey:"I"},KeyJ:{key:"j",shiftKey:"J"},KeyK:{key:"k",shiftKey:"K"},KeyL:{key:"l",shiftKey:"L"},KeyM:{key:"m",shiftKey:"M"},KeyN:{key:"n",shiftKey:"N"},KeyO:{key:"o",shiftKey:"O"},KeyP:{key:"p",shiftKey:"P"},KeyQ:{key:"q",shiftKey:"Q"},KeyR:{key:"r",shiftKey:"R"},KeyS:{key:"s",shiftKey:"S"},KeyT:{key:"t",shiftKey:"T"},KeyU:{key:"u",shiftKey:"U"},KeyV:{key:"v",shiftKey:"V"},KeyW:{key:"w",shiftKey:"W"},KeyX:{key:"x",shiftKey:"X"},KeyY:{key:"y",shiftKey:"Y"},KeyZ:{key:"z",shiftKey:"Z"},Numpad0:{key:"0"},Numpad1:{key:"1"},Numpad2:{key:"2"},Numpad3:{key:"3"},Numpad4:{key:"4"},Numpad5:{key:"5"},Numpad6:{key:"6"},Numpad7:{key:"7"},Numpad8:{key:"8"},Numpad9:{key:"9"},NumpadMultiply:{key:"*"},NumpadAdd:{key:"+"},NumpadComma:{key:","},NumpadSubtract:{key:"-"},NumpadDecimal:{key:"."},NumpadDivide:{key:"/"},Semicolon:{key:";",shiftKey:":"},Equal:{key:"=",shiftKey:"+"},Comma:{key:",",shiftKey:"<"},Minus:{key:"-",shiftKey:"_"},Period:{key:".",shiftKey:">"},Slash:{key:"/",shiftKey:"?"},Backquote:{key:"`",shiftKey:"~"},BracketLeft:{key:"[",shiftKey:"{"},Backslash:{key:"\\",shiftKey:"|"},BracketRight:{key:"]",shiftKey:"}"},Quote:{key:"'",shiftKey:'"'},IntlBackslash:{key:"\\",shiftKey:"|"}};h(f,"mac",{OSLeft:{key:"Meta"},OSRight:{key:"Meta"}});var m,g,v,y={Esc:"Escape",Nonconvert:"NonConvert",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Menu:"ContextMenu",MediaNextTrack:"MediaTrackNext",MediaPreviousTrack:"MediaTrackPrevious",SelectMedia:"MediaSelect",HalfWidth:"Hankaku",FullWidth:"Zenkaku",RomanCharacters:"Romaji",Crsel:"CrSel",Exsel:"ExSel",Zoom:"ZoomToggle"},b=(m=u,g="code",v={},Object.keys(m).forEach((function(e){var t=m[e];g in t&&(v[t.code]=t)})),v);try{var E=t&&"location"in new KeyboardEvent("")}catch(e){}function x(e){var t="keyCode"in e?e.keyCode:"which"in e?e.which:0,i=function(){if(E||"keyLocation"in e){var i=E?e.location:e.keyLocation;if(i&&t in p[i])return p[i][t]}return"keyIdentifier"in e&&e.keyIdentifier in d?d[e.keyIdentifier]:t in u?u[t]:null}();if(!i)return null;var n,r=(n=f[i.code])?e.shiftKey&&"shiftKey"in n?n.shiftKey:n.key:i.code;return{code:i.code,key:r,location:i.location,keyCap:i.keyCap}}"KeyboardEvent"in e&&"defineProperty"in Object&&function(){function e(e,t,i){t in e||Object.defineProperty(e,t,i)}if(e(KeyboardEvent.prototype,"code",{get:function(){var e=x(this);return e?e.code:""}}),"key"in KeyboardEvent.prototype){var t=Object.getOwnPropertyDescriptor(KeyboardEvent.prototype,"key");Object.defineProperty(KeyboardEvent.prototype,"key",{get:function(){var e=t.get.call(this);return y.hasOwnProperty(e)?y[e]:e}})}e(KeyboardEvent.prototype,"key",{get:function(){var e=x(this);return e&&"key"in e?e.key:"Unidentified"}}),e(KeyboardEvent.prototype,"location",{get:function(){var e=x(this);return e&&"location"in e?e.location:i}}),e(KeyboardEvent.prototype,"locale",{get:function(){return""}})}(),"queryKeyCap"in e.KeyboardEvent||(e.KeyboardEvent.queryKeyCap=function(e,t){if(e=String(e),!b.hasOwnProperty(e))return"Undefined";if(t&&"en-us"!==String(t).toLowerCase())throw Error("Unsupported locale");var i=b[e];return i.keyCap||i.code||"Undefined"}),e.identifyKey=function(e){if(!("code"in e)){var t=x(e);e.code=t?t.code:"",e.key=t&&"key"in t?t.key:"Unidentified",e.location="location"in e?e.location:"keyLocation"in e?e.keyLocation:t&&"location"in t?t.location:i,e.locale=""}}}(window)},3386:e=>{e.exports=AFRAME.registerComponent("checkpoint-controls",{schema:{enabled:{default:!0},mode:{default:"teleport",oneOf:["teleport","animate"]},animateSpeed:{default:3}},init:function(){this.active=!0,this.checkpoint=null,this.isNavMeshConstrained=!1,this.offset=new THREE.Vector3,this.position=new THREE.Vector3,this.targetPosition=new THREE.Vector3},play:function(){this.active=!0},pause:function(){this.active=!1},setCheckpoint:function(e){const t=this.el;this.active&&this.checkpoint!==e&&(this.checkpoint&&t.emit("navigation-end",{checkpoint:this.checkpoint}),this.checkpoint=e,this.sync(),this.position.distanceTo(this.targetPosition)<.1?this.checkpoint=null:(t.emit("navigation-start",{checkpoint:e}),"teleport"===this.data.mode&&(this.el.setAttribute("position",this.targetPosition),this.checkpoint=null,t.emit("navigation-end",{checkpoint:e}),t.components["movement-controls"].updateNavLocation())))},isVelocityActive:function(){return!(!this.active||!this.checkpoint)},getVelocity:function(){if(!this.active)return;const e=this.data,t=this.offset,i=this.position,n=this.targetPosition,r=this.checkpoint;return this.sync(),i.distanceTo(n)<.1?(this.checkpoint=null,this.el.emit("navigation-end",{checkpoint:r}),t.set(0,0,0)):(t.setLength(e.animateSpeed),t)},sync:function(){const e=this.offset,t=this.position,i=this.targetPosition;t.copy(this.el.getAttribute("position")),this.checkpoint.object3D.getWorldPosition(i),i.add(this.checkpoint.components.checkpoint.getOffset()),e.copy(i).sub(t)}})},5062:(e,t,i)=>{const n=i(6453),r=i(4379),o=.2,s="left",a="right";e.exports=AFRAME.registerComponent("gamepad-controls",{GamepadButton:n,schema:{enabled:{default:!0},camera:{default:"[camera]",type:"selector"},rotationSensitivity:{default:2}},init:function(){const e=this.el.sceneEl;this.system=e.systems["tracked-controls-webxr"]||{controllers:[]},this.prevTime=window.performance.now(),this.buttons={};const t=this.el.object3D.rotation;this.pitch=new THREE.Object3D,this.pitch.rotation.x=THREE.Math.degToRad(t.x),this.yaw=new THREE.Object3D,this.yaw.position.y=10,this.yaw.rotation.y=THREE.Math.degToRad(t.y),this.yaw.add(this.pitch),this._lookVector=new THREE.Vector2,this._moveVector=new THREE.Vector2,this._dpadVector=new THREE.Vector2,e.addBehavior(this)},update:function(){this.tick()},tick:function(e,t){this.updateButtonState(),this.updateRotation(t)},remove:function(){},isVelocityActive:function(){if(!this.data.enabled||!this.isConnected())return!1;const e=this._dpadVector,t=this._moveVector;this.getDpad(e),this.getJoystick(1,t);const i=e.x||t.x,n=e.y||t.y;return Math.abs(i)>o||Math.abs(n)>o},getVelocityDelta:function(){const e=this._dpadVector,t=this._moveVector;this.getDpad(e),this.getJoystick(1,t);const i=e.x||t.x,n=e.y||t.y,r=new THREE.Vector3;return Math.abs(i)>o&&(r.x+=i),Math.abs(n)>o&&(r.z+=n),r},isRotationActive:function(){if(!this.data.enabled||!this.isConnected())return!1;const e=this._lookVector;return this.getJoystick(2,e),Math.abs(e.x)>o||Math.abs(e.y)>o},updateRotation:function(e){if(!this.isRotationActive())return;const t=this.data,i=this.yaw,n=this.pitch,r=t.camera.components["look-controls"],s=r&&r.pitchObject&&r.yawObject;s&&(n.rotation.copy(r.pitchObject.rotation),i.rotation.copy(r.yawObject.rotation));const a=this._lookVector;this.getJoystick(2,a),Math.abs(a.x)<=o&&(a.x=0),Math.abs(a.y)<=o&&(a.y=0),a.multiplyScalar(t.rotationSensitivity*e/1e3),i.rotation.y-=a.x,n.rotation.x-=a.y,n.rotation.x=Math.max(-Math.PI/2,Math.min(Math.PI/2,n.rotation.x)),t.camera.object3D.rotation.set(n.rotation.x,i.rotation.y,0),s&&(r.pitchObject.rotation.copy(n.rotation),r.yawObject.rotation.copy(i.rotation))},updateButtonState:function(){const e=this.getGamepad(a);if(this.data.enabled&&e)for(var t=0;t<e.buttons.length;t++)e.buttons[t].pressed&&!this.buttons[t]?this.emit(new r("gamepadbuttondown",t,e.buttons[t])):!e.buttons[t].pressed&&this.buttons[t]&&this.emit(new r("gamepadbuttonup",t,e.buttons[t])),this.buttons[t]=e.buttons[t].pressed;else Object.keys(this.buttons)&&(this.buttons={})},emit:function(e){this.el.emit(e.type,e),this.el.emit(e.type+":"+e.index,new r(e.type,e.index,e))},getGamepad:function(){const e=[],t=[];return function(i){const n=this.el.sceneEl.components["proxy-controls"],r=n&&n.isConnected()&&n.getGamepad(0);if(r)return r;e.length=0;for(let t=0;t<this.system.controllers.length;t++){const n=this.system.controllers[t],r=n?n.gamepad:null;if(e.push(r),r&&r.handedness===i)return r}const o=navigator.getGamepads?navigator.getGamepads():t;for(let e=0;e<o.length;e++){const t=o[e];if(t&&t.hand===i)return t}return e[0]||o[0]}}(),getButton:function(e){return this.getGamepad(a).buttons[e]},getAxis:function(e){return this.getGamepad(e>1?a:s).axes[e]},getJoystick:function(e,t){const i=this.getGamepad(1===e?s:a);if("xr-standard"===i.mapping)switch(e){case 1:return t.set(i.axes[2],i.axes[3]);case 2:return t.set(i.axes[0],i.axes[1])}else switch(e){case 1:return t.set(i.axes[0],i.axes[1]);case 2:return t.set(i.axes[2],i.axes[3])}throw new Error('Unexpected joystick index "%d".',e)},getDpad:function(e){const t=this.getGamepad(s);return t.buttons[n.DPAD_RIGHT]?e.set((t.buttons[n.DPAD_RIGHT].pressed?1:0)+(t.buttons[n.DPAD_LEFT].pressed?-1:0),(t.buttons[n.DPAD_UP].pressed?-1:0)+(t.buttons[n.DPAD_DOWN].pressed?1:0)):e.set(0,0)},isConnected:function(){const e=this.getGamepad(s);return!(!e||!e.connected)},getID:function(){return this.getGamepad(s).id}})},2406:(e,t,i)=>{i(3386),i(5062),i(2250),i(9048),i(3819),i(9893)},2250:(e,t,i)=>{i(7454);const n=window.KeyboardEvent;e.exports=AFRAME.registerComponent("keyboard-controls",{schema:{enabled:{default:!0},debug:{default:!1}},init:function(){this.dVelocity=new THREE.Vector3,this.localKeys={},this.listeners={keydown:this.onKeyDown.bind(this),keyup:this.onKeyUp.bind(this),blur:this.onBlur.bind(this)},this.attachEventListeners()},isVelocityActive:function(){return this.data.enabled&&!!Object.keys(this.getKeys()).length},getVelocityDelta:function(){const e=this.data,t=this.getKeys();return this.dVelocity.set(0,0,0),e.enabled&&((t.KeyW||t.ArrowUp)&&(this.dVelocity.z-=1),(t.KeyA||t.ArrowLeft)&&(this.dVelocity.x-=1),(t.KeyS||t.ArrowDown)&&(this.dVelocity.z+=1),(t.KeyD||t.ArrowRight)&&(this.dVelocity.x+=1)),this.dVelocity.clone()},play:function(){this.attachEventListeners()},pause:function(){this.removeEventListeners()},remove:function(){this.pause()},attachEventListeners:function(){window.addEventListener("keydown",this.listeners.keydown,!1),window.addEventListener("keyup",this.listeners.keyup,!1),window.addEventListener("blur",this.listeners.blur,!1)},removeEventListeners:function(){window.removeEventListener("keydown",this.listeners.keydown),window.removeEventListener("keyup",this.listeners.keyup),window.removeEventListener("blur",this.listeners.blur)},onKeyDown:function(e){AFRAME.utils.shouldCaptureKeyEvent(e)&&(this.localKeys[e.code]=!0,this.emit(e))},onKeyUp:function(e){AFRAME.utils.shouldCaptureKeyEvent(e)&&(delete this.localKeys[e.code],this.emit(e))},onBlur:function(){for(let e in this.localKeys)this.localKeys.hasOwnProperty(e)&&delete this.localKeys[e]},emit:function(e){"__keyboard-controls-proxy"in e&&this.el.emit(e.type,e),this.el.emit(e.type+":"+e.code,new n(e.type,e)),this.data.debug&&console.log(e.type+":"+e.code)},isPressed:function(e){return e in this.getKeys()},getKeys:function(){return this.isProxied()?this.el.sceneEl.components["proxy-controls"].getKeyboard():this.localKeys},isProxied:function(){const e=this.el.sceneEl.components["proxy-controls"];return e&&e.isConnected()}})},3819:e=>{const t="-controls";e.exports=AFRAME.registerComponent("movement-controls",{dependencies:["rotation"],schema:{enabled:{default:!0},controls:{default:["gamepad","trackpad","keyboard","touch"]},speed:{default:.3,min:0},fly:{default:!1},constrainToNavMesh:{default:!1},camera:{default:"[movement-controls] [camera]",type:"selector"}},init:function(){const e=this.el;this.velocityCtrl=null,this.velocity=new THREE.Vector3,this.heading=new THREE.Quaternion,this.navGroup=null,this.navNode=null,e.sceneEl.hasLoaded?this.injectControls():e.sceneEl.addEventListener("loaded",this.injectControls.bind(this))},update:function(e){const t=this.el,i=this.data,n=t.sceneEl.systems.nav;t.sceneEl.hasLoaded&&this.injectControls(),n&&i.constrainToNavMesh!==e.constrainToNavMesh&&(i.constrainToNavMesh?n.addAgent(this):n.removeAgent(this))},injectControls:function(){const e=this.data;var i;for(let n=0;n<e.controls.length;n++)i=e.controls[n]+t,this.el.components[i]||this.el.setAttribute(i,"")},updateNavLocation:function(){this.navGroup=null,this.navNode=null},tick:function(){const e=new THREE.Vector3,t=new THREE.Vector3,i=new THREE.Vector3;return function(n,r){if(!r)return;const o=this.el,s=this.data;if(!s.enabled)return;this.updateVelocityCtrl();const a=this.velocityCtrl,l=this.velocity;if(a)if(r/1e3>.2?l.set(0,0,0):this.updateVelocity(r),s.constrainToNavMesh&&!1!==a.isNavMeshConstrained){if(l.lengthSq()<1e-5)return;e.copy(o.object3D.position),t.copy(l).multiplyScalar(r/1e3).add(e);const n=o.sceneEl.systems.nav;this.navGroup=null===this.navGroup?n.getGroup(e):this.navGroup,this.navNode=this.navNode||n.getNode(e,this.navGroup),this.navNode=n.clampStep(e,t,this.navGroup,this.navNode,i),o.object3D.position.copy(i)}else o.hasAttribute("velocity")?o.setAttribute("velocity",l):(o.object3D.position.x+=l.x*r/1e3,o.object3D.position.y+=l.y*r/1e3,o.object3D.position.z+=l.z*r/1e3)}}(),updateVelocityCtrl:function(){const e=this.data;if(e.enabled){for(let i=0,n=e.controls.length;i<n;i++){const n=this.el.components[e.controls[i]+t];if(n&&n.isVelocityActive())return void(this.velocityCtrl=n)}this.velocityCtrl=null}},updateVelocity:function(){const e=new THREE.Vector2,t=new THREE.Quaternion;return function(i){let n;const r=this.el,o=this.velocityCtrl,s=this.velocity,a=this.data;if(o){if(!o.getVelocityDelta){if(o.getVelocity)return void s.copy(o.getVelocity());if(o.getPositionDelta)return void s.copy(o.getPositionDelta(i).multiplyScalar(1e3/i));throw new Error("Incompatible movement controls: ",o)}n=o.getVelocityDelta(i)}if(r.hasAttribute("velocity")&&!a.constrainToNavMesh&&s.copy(this.el.getAttribute("velocity")),n&&a.enabled){const i=a.camera;t.copy(i.object3D.quaternion),t.premultiply(r.object3D.quaternion),n.applyQuaternion(t);const o=n.length();a.fly?(s.copy(n),s.multiplyScalar(16.66667*this.data.speed)):(e.set(n.x,n.z),e.setLength(o*this.data.speed*16.66667),s.x=e.x,s.z=e.y)}}}()})},9048:e=>{e.exports=AFRAME.registerComponent("touch-controls",{schema:{enabled:{default:!0},reverseEnabled:{default:!0}},init:function(){this.dVelocity=new THREE.Vector3,this.bindMethods(),this.direction=0},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners(),this.dVelocity.set(0,0,0)},remove:function(){this.pause()},addEventListeners:function(){const e=this.el.sceneEl,t=e.canvas;t?(t.addEventListener("touchstart",this.onTouchStart),t.addEventListener("touchend",this.onTouchEnd)):e.addEventListener("render-target-loaded",this.addEventListeners.bind(this))},removeEventListeners:function(){const e=this.el.sceneEl&&this.el.sceneEl.canvas;e&&(e.removeEventListener("touchstart",this.onTouchStart),e.removeEventListener("touchend",this.onTouchEnd))},isVelocityActive:function(){return this.data.enabled&&!!this.direction},getVelocityDelta:function(){return this.dVelocity.z=this.direction,this.dVelocity.clone()},bindMethods:function(){this.onTouchStart=this.onTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this)},onTouchStart:function(e){this.direction=-1,this.data.reverseEnabled&&2===e.touches.length&&(this.direction=1),e.preventDefault()},onTouchEnd:function(e){this.direction=0,e.preventDefault()}})},9893:e=>{e.exports=AFRAME.registerComponent("trackpad-controls",{schema:{enabled:{default:!0},enableNegX:{default:!0},enablePosX:{default:!0},enableNegZ:{default:!0},enablePosZ:{default:!0},mode:{default:"touch",oneOf:["swipe","touch","press"]}},init:function(){this.dVelocity=new THREE.Vector3,this.zVel=0,this.xVel=0,this.bindMethods()},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners(),this.dVelocity.set(0,0,0)},remove:function(){this.pause()},addEventListeners:function(){const e=this.data,t=this.el.sceneEl;switch(t.addEventListener("axismove",this.onAxisMove),e.mode){case"swipe":case"touch":t.addEventListener("trackpadtouchstart",this.onTouchStart),t.addEventListener("trackpadtouchend",this.onTouchEnd);break;case"press":t.addEventListener("trackpaddown",this.onTouchStart),t.addEventListener("trackpadup",this.onTouchEnd)}},removeEventListeners:function(){const e=this.el.sceneEl;e.removeEventListener("axismove",this.onAxisMove),e.removeEventListener("trackpadtouchstart",this.onTouchStart),e.removeEventListener("trackpadtouchend",this.onTouchEnd),e.removeEventListener("trackpaddown",this.onTouchStart),e.removeEventListener("trackpadup",this.onTouchEnd)},isVelocityActive:function(){return this.data.enabled&&this.isMoving},getVelocityDelta:function(){return this.dVelocity.z=this.isMoving?-this.zVel:1,this.dVelocity.x=this.isMoving?this.xVel:1,this.dVelocity.clone()},bindMethods:function(){this.onTouchStart=this.onTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onAxisMove=this.onAxisMove.bind(this)},onTouchStart:function(e){switch(this.data.mode){case"swipe":this.canRecordAxis=!0,this.startingAxisData=[];break;case"touch":case"press":this.isMoving=!0}e.preventDefault()},onTouchEnd:function(e){"swipe"==this.data.mode&&(this.startingAxisData=[]),this.isMoving=!1,e.preventDefault()},onAxisMove:function(e){switch(this.data.mode){case"swipe":return this.handleSwipeAxis(e);case"touch":case"press":return this.handleTouchAxis(e)}},handleSwipeAxis:function(e){const t=this.data,i=e.detail.axis;if(0===this.startingAxisData.length&&this.canRecordAxis&&(this.canRecordAxis=!1,this.startingAxisData[0]=i[0],this.startingAxisData[1]=i[1]),this.startingAxisData.length>0){let e=0,n=0;t.enableNegX&&i[0]<this.startingAxisData[0]&&(e=-1),t.enablePosX&&i[0]>this.startingAxisData[0]&&(e=1),t.enablePosZ&&i[1]>this.startingAxisData[1]&&(n=-1),t.enableNegZ&&i[1]<this.startingAxisData[1]&&(n=1);const r=Math.abs(this.startingAxisData[1]-i[1]);Math.abs(this.startingAxisData[0]-i[0])>r?(this.zVel=0,this.xVel=e,this.isMoving=!0):(this.xVel=0,this.zVel=n,this.isMoving=!0)}},handleTouchAxis:function(e){const t=this.data,i=e.detail.axis;let n=0,r=0;t.enableNegX&&i[0]<0&&(n=-1),t.enablePosX&&i[0]>0&&(n=1),t.enablePosZ&&i[1]>0&&(r=-1),t.enableNegZ&&i[1]<0&&(r=1),Math.abs(i[0])>Math.abs(i[1])?(this.zVel=0,this.xVel=n):(this.xVel=0,this.zVel=r)}})},6591:e=>{const t={once:THREE.LoopOnce,repeat:THREE.LoopRepeat,pingpong:THREE.LoopPingPong};function i(e){return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&")}e.exports=AFRAME.registerComponent("animation-mixer",{schema:{clip:{default:"*"},duration:{default:0},clampWhenFinished:{default:!1,type:"boolean"},crossFadeDuration:{default:0},loop:{default:"repeat",oneOf:Object.keys(t)},repetitions:{default:1/0,min:0},timeScale:{default:1}},init:function(){this.model=null,this.mixer=null,this.activeActions=[];const e=this.el.getObject3D("mesh");e?this.load(e):this.el.addEventListener("model-loaded",(e=>{this.load(e.detail.model)}))},load:function(e){const t=this.el;this.model=e,this.mixer=new THREE.AnimationMixer(e),this.mixer.addEventListener("loop",(e=>{t.emit("animation-loop",{action:e.action,loopDelta:e.loopDelta})})),this.mixer.addEventListener("finished",(e=>{t.emit("animation-finished",{action:e.action,direction:e.direction})})),this.data.clip&&this.update({})},remove:function(){this.mixer&&this.mixer.stopAllAction()},update:function(e){if(!e)return;const i=this.data,n=AFRAME.utils.diff(i,e);if("clip"in n)return this.stopAction(),void(i.clip&&this.playAction());this.activeActions.forEach((e=>{"duration"in n&&i.duration&&e.setDuration(i.duration),"clampWhenFinished"in n&&(e.clampWhenFinished=i.clampWhenFinished),("loop"in n||"repetitions"in n)&&e.setLoop(t[i.loop],i.repetitions),"timeScale"in n&&e.setEffectiveTimeScale(i.timeScale)}))},stopAction:function(){const e=this.data;for(let t=0;t<this.activeActions.length;t++)e.crossFadeDuration?this.activeActions[t].fadeOut(e.crossFadeDuration):this.activeActions[t].stop();this.activeActions.length=0},playAction:function(){if(!this.mixer)return;const e=this.model,n=this.data,r=e.animations||(e.geometry||{}).animations||[];if(!r.length)return;const o=(s=n.clip,new RegExp("^"+s.split(/\*+/).map(i).join(".*")+"$"));var s;for(let i,s=0;i=r[s];s++)if(i.name.match(o)){const r=this.mixer.clipAction(i,e);r.enabled=!0,r.clampWhenFinished=n.clampWhenFinished,n.duration&&r.setDuration(n.duration),1!==n.timeScale&&r.setEffectiveTimeScale(n.timeScale),r.setLoop(t[n.loop],n.repetitions).fadeIn(n.crossFadeDuration).play(),this.activeActions.push(r)}},tick:function(e,t){this.mixer&&!isNaN(t)&&this.mixer.update(t/1e3)}})},2290:(e,t,i)=>{THREE.ColladaLoader=i(203),e.exports.Component=AFRAME.registerComponent("collada-model-legacy",{schema:{type:"asset"},init:function(){this.model=null,this.loader=new THREE.ColladaLoader},update:function(){var e=this,t=this.el,i=this.data,n=this.el.sceneEl.systems.renderer;i&&(this.remove(),this.loader.load(i,(function(i){e.model=i.scene,e.model.traverse((function(e){if(e.isMesh){var t=e.material;t.color&&n.applyColorCorrection(t.color),t.map&&n.applyColorCorrection(t.map),t.emissive&&n.applyColorCorrection(t.emissive),t.emissiveMap&&n.applyColorCorrection(t.emissiveMap)}})),t.setObject3D("mesh",e.model),t.emit("model-loaded",{format:"collada",model:e.model})})))},remove:function(){this.model&&this.el.removeObject3D("mesh")}})},5310:(e,t,i)=>{THREE.FBXLoader=i(9434),e.exports=AFRAME.registerComponent("fbx-model",{schema:{src:{type:"asset"},crossorigin:{default:""}},init:function(){this.model=null},update:function(){const e=this.data;if(!e.src)return;this.remove();const t=new THREE.FBXLoader;e.crossorigin&&t.setCrossOrigin(e.crossorigin),t.load(e.src,this.load.bind(this))},load:function(e){this.model=e,this.el.setObject3D("mesh",e),this.el.emit("model-loaded",{format:"fbx",model:e})},remove:function(){this.model&&this.el.removeObject3D("mesh")}})},8837:(e,t,i)=>{const n=i(4657)(),r=function(){let e;return function(){return e=e||n("https://cdn.jsdelivr.net/gh/mrdoob/three.js@r86/examples/js/loaders/GLTFLoader.js"),e}}();e.exports=AFRAME.registerComponent("gltf-model-legacy",{schema:{type:"model"},init:function(){this.model=null,this.loader=null,this.loaderPromise=r().then((()=>{this.loader=new THREE.GLTFLoader,this.loader.setCrossOrigin("Anonymous")}))},update:function(){const e=this,t=this.el,i=this.data;i&&(this.remove(),this.loaderPromise.then((()=>{this.loader.load(i,(function(i){e.model=i.scene,e.model.animations=i.animations,t.setObject3D("mesh",e.model),t.emit("model-loaded",{format:"gltf",model:e.model})}))})))},remove:function(){this.model&&this.el.removeObject3D("mesh")}})},9874:(e,t,i)=>{i(6591),i(2290),i(5310),i(8837),i(171)},171:e=>{e.exports=AFRAME.registerComponent("object-model",{schema:{src:{type:"asset"},crossorigin:{default:""}},init:function(){this.model=null},update:function(){let e;const t=this.data;t.src&&(this.remove(),e=new THREE.ObjectLoader,t.crossorigin&&e.setCrossOrigin(t.crossorigin),e.load(t.src,(e=>{e.traverse((e=>{e instanceof THREE.SkinnedMesh&&e.material&&(e.material.skinning=!!(e.geometry&&e.geometry.bones||[]).length)})),this.load(e)})))},load:function(e){this.model=e,this.el.setObject3D("mesh",e),this.el.emit("model-loaded",{format:"json",model:e})},remove:function(){this.model&&this.el.removeObject3D("mesh")}})},7642:e=>{e.exports=AFRAME.registerComponent("checkpoint",{schema:{offset:{default:{x:0,y:0,z:0},type:"vec3"}},init:function(){this.active=!1,this.targetEl=null,this.fire=this.fire.bind(this),this.offset=new THREE.Vector3},update:function(){this.offset.copy(this.data.offset)},play:function(){this.el.addEventListener("click",this.fire)},pause:function(){this.el.removeEventListener("click",this.fire)},remove:function(){this.pause()},fire:function(){const e=this.el.sceneEl.querySelector("[checkpoint-controls]");if(!e)throw new Error("No `checkpoint-controls` component found.");e.components["checkpoint-controls"].setCheckpoint(this.el)},getOffset:function(){return this.offset.copy(this.data.offset)}})},4795:e=>{function t(e,t,i,n){e&&(t=t||[],e.traverse((e=>{var r;e.isMesh&&((r=e.material)?Array.isArray(r)?r:r.materials?r.materials:[r]:[]).forEach((e=>{e&&!("envMap"in e)||t.length&&-1===t.indexOf(e.name)||(e.envMap=i,e.reflectivity=n,e.needsUpdate=!0)}))})))}e.exports=AFRAME.registerComponent("cube-env-map",{multiple:!0,schema:{path:{default:""},extension:{default:"jpg",oneOf:["jpg","png"]},format:{default:"RGBFormat",oneOf:["RGBFormat","RGBAFormat"]},enableBackground:{default:!1},reflectivity:{default:1,min:0,max:1},materials:{default:[]}},init:function(){const e=this.data;this.texture=(new THREE.CubeTextureLoader).load([e.path+"posx."+e.extension,e.path+"negx."+e.extension,e.path+"posy."+e.extension,e.path+"negy."+e.extension,e.path+"posz."+e.extension,e.path+"negz."+e.extension]),this.texture.format=THREE[e.format],this.object3dsetHandler=()=>{const e=this.el.getObject3D("mesh"),i=this.data;t(e,i.materials,this.texture,i.reflectivity)},this.el.addEventListener("object3dset",this.object3dsetHandler)},update:function(e){const i=this.data,n=this.el.getObject3D("mesh");let r=[],o=[];if(i.materials.length&&(e.materials?(r=i.materials.filter((t=>!e.materials.includes(t))),o=e.materials.filter((e=>!i.materials.includes(e)))):r=i.materials),r.length&&t(n,r,this.texture,i.reflectivity),o.length&&t(n,o,null,1),e.materials&&i.reflectivity!==e.reflectivity){const r=i.materials.filter((t=>e.materials.includes(t)));r.length&&t(n,r,this.texture,i.reflectivity)}this.data.enableBackground&&!e.enableBackground?this.setBackground(this.texture):!this.data.enableBackground&&e.enableBackground&&this.setBackground(null)},remove:function(){this.el.removeEventListener("object3dset",this.object3dsetHandler);const e=this.el.getObject3D("mesh"),i=this.data;t(e,i.materials,null,1),i.enableBackground&&this.setBackground(null)},setBackground:function(e){this.el.sceneEl.object3D.background=e}})},9511:e=>{e.exports=AFRAME.registerComponent("grab",{init:function(){this.system=this.el.sceneEl.systems.physics,this.GRABBED_STATE="grabbed",this.grabbing=!1,this.hitEl=null,this.physics=this.el.sceneEl.systems.physics,this.constraint=null,this.onHit=this.onHit.bind(this),this.onGripOpen=this.onGripOpen.bind(this),this.onGripClose=this.onGripClose.bind(this)},play:function(){const e=this.el;e.addEventListener("hit",this.onHit),e.addEventListener("gripdown",this.onGripClose),e.addEventListener("gripup",this.onGripOpen),e.addEventListener("trackpaddown",this.onGripClose),e.addEventListener("trackpadup",this.onGripOpen),e.addEventListener("triggerdown",this.onGripClose),e.addEventListener("triggerup",this.onGripOpen)},pause:function(){const e=this.el;e.removeEventListener("hit",this.onHit),e.removeEventListener("gripdown",this.onGripClose),e.removeEventListener("gripup",this.onGripOpen),e.removeEventListener("trackpaddown",this.onGripClose),e.removeEventListener("trackpadup",this.onGripOpen),e.removeEventListener("triggerdown",this.onGripClose),e.removeEventListener("triggerup",this.onGripOpen)},onGripClose:function(){this.grabbing=!0},onGripOpen:function(){const e=this.hitEl;this.grabbing=!1,e&&(e.removeState(this.GRABBED_STATE),this.hitEl=void 0,this.system.removeConstraint(this.constraint),this.constraint=null)},onHit:function(e){const t=e.detail.el;t&&!t.is(this.GRABBED_STATE)&&this.grabbing&&!this.hitEl&&(t.addState(this.GRABBED_STATE),this.hitEl=t,this.constraint=new CANNON.LockConstraint(this.el.body,t.body),this.system.addConstraint(this.constraint))}})},9236:(e,t,i)=>{i(7642),i(4795),i(9511),i(765),i(837),i(8310),i(8240),i(1790)},765:e=>{e.exports=AFRAME.registerComponent("jump-ability",{dependencies:["velocity"],schema:{on:{default:"keydown:Space gamepadbuttondown:0"},playerHeight:{default:1.764},maxJumps:{default:1},distance:{default:5},debug:{default:!1}},init:function(){this.velocity=0,this.numJumps=0;const e=this.beginJump.bind(this),t=this.data.on.split(" ");this.bindings={};for(let i=0;i<t.length;i++)this.bindings[t[i]]=e,this.el.addEventListener(t[i],e);this.bindings.collide=this.onCollide.bind(this),this.el.addEventListener("collide",this.bindings.collide)},remove:function(){for(var e in this.bindings)this.bindings.hasOwnProperty(e)&&(this.el.removeEventListener(e,this.bindings[e]),delete this.bindings[e]);this.el.removeEventListener("collide",this.bindings.collide),delete this.bindings.collide},beginJump:function(){if(this.numJumps<this.data.maxJumps){const e=this.data,t=Math.sqrt(-2*e.distance*-24.8),i=this.el.getAttribute("velocity");this.el.setAttribute("velocity",{x:i.x,y:t,z:i.z}),this.numJumps++,this.el.emit("jumpstart")}},onCollide:function(){this.numJumps>0&&this.el.emit("jumpend"),this.numJumps=0}})},837:e=>{const t=1e-6;e.exports=AFRAME.registerComponent("kinematic-body",{dependencies:["velocity"],schema:{mass:{default:5},radius:{default:1.3},linearDamping:{default:.05},enableSlopes:{default:!0},enableJumps:{default:!1}},init:function(){this.system=this.el.sceneEl.systems.physics,this.system.addComponent(this);const e=this.el,t=this.data,i=(new CANNON.Vec3).copy(e.object3D.getWorldPosition(new THREE.Vector3));this.body=new CANNON.Body({material:this.system.getMaterial("staticMaterial"),position:i,mass:t.mass,linearDamping:t.linearDamping,fixedRotation:!0}),this.body.addShape(new CANNON.Sphere(t.radius),new CANNON.Vec3(0,t.radius,0)),this.body.el=this.el,this.el.body=this.body,this.system.addBody(this.body),e.hasAttribute("wasd-controls")&&console.warn("[kinematic-body] Not compatible with wasd-controls, use movement-controls.")},remove:function(){this.system.removeBody(this.body),this.system.removeComponent(this),delete this.el.body},beforeStep:function(e,t){if(!t)return;const i=this.el,n=this.data,r=this.body;n.enableJumps||r.velocity.set(0,0,0),r.position.copy(i.getAttribute("position"))},step:function(){const e=new THREE.Vector3,i=new THREE.Vector3,n=new THREE.Vector3,r=new THREE.Vector3;return function(o,s){if(!s)return;let a,l,c=this.body,h=this.data,u=!1,d=-1/0,p=this.system.getContacts();s=Math.min(s,1e3*this.system.data.maxInterval),r.set(0,0,0),e.copy(this.el.getAttribute("velocity")),c.velocity.copy(e);for(var f,m=0;f=p[m];m++)if(f.enabled){if(c.id===f.bi.id)f.ni.negate(n);else{if(c.id!==f.bj.id)continue;n.copy(f.ni)}u=c.velocity.dot(n)<-t,u&&n.y<=.5?e.projectOnPlane(n):n.y>.5&&(a=c.id===f.bi.id?Math.abs(f.rj.y+f.bj.position.y):Math.abs(f.ri.y+f.bi.position.y),a>d&&(d=a,r.copy(n),l=c.id===f.bi.id?f.bj:f.bi))}i.copy(e).normalize(),l&&(!h.enableJumps||i.y<.5)?(h.enableSlopes?r.y<1-t&&r.copy(this.raycastToGround(l,r)):r.set(0,1,0),e.projectOnPlane(r)):this.system.driver.world&&e.add(this.system.driver.world.gravity.scale(4*s/1e3)),c.velocity.copy(e),this.el.setAttribute("velocity",c.velocity),this.el.setAttribute("position",c.position)}}(),raycastToGround:function(e,t){let i,n,r=this.body.position,o=this.body.position.clone();return i=new CANNON.Ray(r,o),i._updateDirection(),i.intersectBody(e),i.hasHit?(n=i.result.hitNormalWorld,Math.abs(n.y)>Math.abs(t.y)?n:t):t}})},8310:e=>{e.exports=AFRAME.registerComponent("mesh-smooth",{init:function(){this.el.addEventListener("model-loaded",(e=>{e.detail.model.traverse((e=>{e.isMesh&&e.geometry.computeVertexNormals()}))}))}})},8240:e=>{e.exports=AFRAME.registerComponent("normal-material",{init:function(){this.material=new THREE.MeshNormalMaterial({flatShading:!0}),this.applyMaterial=this.applyMaterial.bind(this),this.el.addEventListener("object3dset",this.applyMaterial)},remove:function(){this.el.removeEventListener("object3dset",this.applyMaterial)},applyMaterial:function(){this.el.object3D.traverse((e=>{e.isMesh&&(e.material=this.material)}))}})},1790:e=>{e.exports=AFRAME.registerComponent("sphere-collider",{schema:{objects:{default:""},state:{default:"collided"},radius:{default:.05},watch:{default:!0}},init:function(){this.observer=null,this.els=[],this.collisions=[],this.handleHit=this.handleHit.bind(this),this.handleHitEnd=this.handleHitEnd.bind(this)},remove:function(){this.pause()},play:function(){const e=this.el.sceneEl;this.data.watch&&(this.observer=new MutationObserver(this.update.bind(this,null)),this.observer.observe(e,{childList:!0,subtree:!0}))},pause:function(){this.observer&&(this.observer.disconnect(),this.observer=null)},update:function(){const e=this.data;let t;t=e.objects?this.el.sceneEl.querySelectorAll(e.objects):this.el.sceneEl.children,this.els=Array.prototype.slice.call(t)},tick:function(){const e=new THREE.Vector3,t=new THREE.Vector3,i=new THREE.Vector3,n=new THREE.Vector3,r=new THREE.Box3,o=new Map;return function(){const s=this.el,a=this.data,l=s.getObject3D("mesh"),c=[];let h;var u;l&&(o.clear(),s.object3D.getWorldPosition(e),s.object3D.getWorldScale(i),h=a.radius*(u=i,Math.max.apply(null,u.toArray())),this.els.forEach((function(i){let s,a,l,u;i.isEntity&&(a=i.getObject3D("mesh"),a&&(r.setFromObject(a).getSize(n),u=Math.max(n.x,n.y,n.z)/2,s=Math.sqrt(2*u*u),r.getCenter(t),s&&(l=e.distanceTo(t),l<s+h&&(c.push(i),o.set(i,l)))))})),c.sort(((e,t)=>o.get(e)>o.get(t)?1:-1)).forEach(this.handleHit),0===c.length&&s.emit("hit",{el:null}),this.collisions.filter((e=>!o.has(e))).forEach(this.handleHitEnd),this.collisions=c)}}(),handleHit:function(e){e.emit("hit"),e.addState(this.data.state),this.el.emit("hit",{el:e})},handleHitEnd:function(e){e.emit("hitend"),e.removeState(this.data.state),this.el.emit("hitend",{el:e})}})},2578:(e,t,i)=>{i(8453),i(1250),i(1465)},1250:e=>{e.exports=AFRAME.registerComponent("nav-agent",{schema:{destination:{type:"vec3"},active:{default:!1},speed:{default:2}},init:function(){this.system=this.el.sceneEl.systems.nav,this.system.addAgent(this),this.group=null,this.path=[],this.raycaster=new THREE.Raycaster},remove:function(){this.system.removeAgent(this)},update:function(){this.path.length=0},updateNavLocation:function(){this.group=null,this.path=[]},tick:function(){const e=new THREE.Vector3,t=new THREE.Vector3,i=new THREE.Vector3;return function(n,r){const o=this.el,s=this.data,a=this.raycaster,l=s.speed*r/1e3;if(!s.active)return;if(!this.path.length){const t=this.el.object3D.position;this.group=this.group||this.system.getGroup(t),this.path=this.system.getPath(t,e.copy(s.destination),this.group)||[],o.emit("navigation-start")}if(!this.path.length)return console.warn("[nav] Unable to find path to %o.",s.destination),this.el.setAttribute("nav-agent",{active:!1}),void o.emit("navigation-end");const c=o.object3D.position,h=this.path[0];let u;if(t.subVectors(h,c),t.length()<l){if(this.path.shift(),!this.path.length)return this.el.setAttribute("nav-agent",{active:!1}),void o.emit("navigation-end");i.copy(c),u=this.path[0]}else i.copy(t.setLength(l)).add(c),u=h;u.y=c.y,o.object3D.lookAt(u),a.ray.origin.copy(i),a.ray.origin.y+=1.5,a.ray.direction.y=-1;const d=a.intersectObject(this.system.getNavMesh());d.length?(t.subVectors(d[0].point,c),c.add(t.setLength(l))):c.copy(i)}}()})},8453:e=>{e.exports=AFRAME.registerComponent("nav-mesh",{init:function(){this.system=this.el.sceneEl.systems.nav,this.hasLoadedNavMesh=!1,this.el.addEventListener("object3dset",this.loadNavMesh.bind(this))},play:function(){this.hasLoadedNavMesh||this.loadNavMesh()},loadNavMesh:function(){const e=this.el.getObject3D("mesh"),t=this.el.sceneEl.object3D;if(!e)return;let i;if(e.traverse((e=>{e.isMesh&&(i=e)})),!i)return;const n=i.geometry.isBufferGeometry?(new THREE.Geometry).fromBufferGeometry(i.geometry):i.geometry.clone();t.updateMatrixWorld(),n.applyMatrix(i.matrixWorld),this.system.setNavMeshGeometry(n),this.hasLoadedNavMesh=!0}})},1465:(e,t,i)=>{const{Pathfinding:n}=i(6594),r=new n,o="level";e.exports=AFRAME.registerSystem("nav",{init:function(){this.navMesh=null,this.agents=new Set},setNavMeshGeometry:function(e){this.navMesh=new THREE.Mesh(e),r.setZoneData(o,n.createZone(e)),Array.from(this.agents).forEach((e=>e.updateNavLocation()))},getNavMesh:function(){return this.navMesh},addAgent:function(e){this.agents.add(e)},removeAgent:function(e){this.agents.delete(e)},getPath:function(e,t,i){return this.navMesh?r.findPath(e,t,o,i):null},getGroup:function(e){return this.navMesh?r.getGroup(o,e):null},getNode:function(e,t){return this.navMesh?r.getClosestNode(e,o,t,!0):null},clampStep:function(e,t,i,n,s){return this.navMesh?n?r.clampStep(e,t,n,o,i,s):(s.copy(t),this.getNode(t,i)):(s.copy(t),null)}})},386:e=>{e.exports=AFRAME.registerPrimitive("a-grid",{defaultComponents:{geometry:{primitive:"plane",width:75,height:75},rotation:{x:-90,y:0,z:0},material:{src:"url(https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v1.16.3/assets/grid.png)",repeat:"75 75"}},mappings:{width:"geometry.width",height:"geometry.height",src:"material.src"}})},3535:(e,t,i)=>{const n=i(3471),r=i(2667);e.exports.Primitive=AFRAME.registerPrimitive("a-hexgrid",{defaultComponents:{hexgrid:{}},mappings:{src:"hexgrid.src"}}),e.exports.Component=AFRAME.registerComponent("hexgrid",{dependencies:["material"],schema:{src:{type:"asset"}},init:function(){const e=this.data;e.src?fetch(e.src).then((e=>e.json())).then((e=>this.addMesh(e))):this.addMesh(r)},addMesh:function(e){const t=new n.HexGrid;t.fromJSON(e);const i=new n.Board(t);i.generateTilemap(),this.el.setObject3D("mesh",i.group),this.addMaterial()},addMaterial:function(){const e=(this.el.components.material||{}).material;e&&this.el.object3D.traverse((t=>{t.isMesh&&(t.material=e)}))},remove:function(){this.el.removeObject3D("mesh")}})},9307:e=>{e.exports.Primitive=AFRAME.registerPrimitive("a-ocean",{defaultComponents:{ocean:{},rotation:{x:-90,y:0,z:0}},mappings:{width:"ocean.width",depth:"ocean.depth",density:"ocean.density",amplitude:"ocean.amplitude",amplitudeVariance:"ocean.amplitudeVariance",speed:"ocean.speed",speedVariance:"ocean.speedVariance",color:"ocean.color",opacity:"ocean.opacity"}}),e.exports.Component=AFRAME.registerComponent("ocean",{schema:{width:{default:10,min:0},depth:{default:10,min:0},density:{default:10},amplitude:{default:.1},amplitudeVariance:{default:.3},speed:{default:1},speedVariance:{default:2},color:{default:"#7AD2F7",type:"color"},opacity:{default:.8}},play:function(){const e=this.el,t=this.data;let i=e.components.material;const n=new THREE.PlaneGeometry(t.width,t.depth,t.density,t.density);n.mergeVertices(),this.waves=[];for(let e,i=0,r=n.vertices.length;i<r;i++)e=n.vertices[i],this.waves.push({z:e.z,ang:Math.random()*Math.PI*2,amp:t.amplitude+Math.random()*t.amplitudeVariance,speed:(t.speed+Math.random()*t.speedVariance)/1e3});i||(i={},i.material=new THREE.MeshPhongMaterial({color:t.color,transparent:t.opacity<1,opacity:t.opacity,shading:THREE.FlatShading})),this.mesh=new THREE.Mesh(n,i.material),e.setObject3D("mesh",this.mesh)},remove:function(){this.el.removeObject3D("mesh")},tick:function(e,t){if(!t)return;const i=this.mesh.geometry.vertices;for(let e,n,r=0;e=i[r];r++)n=this.waves[r],e.z=n.z+Math.sin(n.ang)*n.amp,n.ang+=n.speed*t;this.mesh.geometry.verticesNeedUpdate=!0}})},699:e=>{e.exports.Primitive=AFRAME.registerPrimitive("a-tube",{defaultComponents:{tube:{}},mappings:{path:"tube.path",segments:"tube.segments",radius:"tube.radius","radial-segments":"tube.radialSegments",closed:"tube.closed"}}),e.exports.Component=AFRAME.registerComponent("tube",{schema:{path:{default:[]},segments:{default:64},radius:{default:1},radialSegments:{default:8},closed:{default:!1}},init:function(){const e=this.el,t=this.data;let i=e.components.material;if(!t.path.length)return void console.error("[a-tube] `path` property expected but not found.");const n=new THREE.CatmullRomCurve3(t.path.map((function(e){return e=e.split(" "),new THREE.Vector3(Number(e[0]),Number(e[1]),Number(e[2]))}))),r=new THREE.TubeGeometry(n,t.segments,t.radius,t.radialSegments,t.closed);i||(i={},i.material=new THREE.MeshPhongMaterial),this.mesh=new THREE.Mesh(r,i.material),this.el.setObject3D("mesh",this.mesh)},update:function(e){Object.keys(e).length&&(this.remove(),this.init())},remove:function(){this.mesh&&this.el.removeObject3D("mesh")}})},6699:(e,t,i)=>{i(386),i(3535),i(9307),i(699)},8581:()=>{if("undefined"==typeof AFRAME)throw new Error("Component attempted to register before AFRAME was available.");AFRAME.registerComponent("haptics",{schema:{actuatorIndex:{default:0},dur:{default:100},enabled:{default:!0},events:{type:"array"},eventsFrom:{type:"string"},force:{default:1}},multiple:!0,init:function(){this.data;var e=this;this.callPulse=function(){e.pulse()};var t=function(){e.gamepad=e.el.components["tracked-controls"].controller,e.gamepad.gamepad&&(e.gamepad=e.gamepad.gamepad),e.gamepad&&e.gamepad.hapticActuators&&e.gamepad.hapticActuators.length&&e.addEventListeners()};this.el.components["tracked-controls"]&&this.el.components["tracked-controls"].controller?t():this.el.addEventListener("controllerconnected",(function(){t()}))},remove:function(){this.removeEventListeners()},pulse:function(e,t){var i=this.data;i.enabled&&this.gamepad&&this.gamepad.hapticActuators&&this.gamepad.hapticActuators[i.actuatorIndex].pulse(e||i.force,t||i.dur)},addEventListeners:function(){var e,t,i=this.data;for(t=i.eventsFrom?document.querySelector(i.eventsFrom):this.el,e=0;e<i.events.length;e++)t.addEventListener(i.events[e],this.callPulse)},removeEventListeners:function(){var e,t,i=this.data;for(t=i.eventsFrom?document.querySelector(i.eventsFrom):this.el,e=0;e<i.events.length;e++)t.removeEventListener(i.events[e],this.callPulse)}})},7571:()=>{AFRAME.registerComponent("proxy-event",{schema:{captureBubbles:{default:!1},enabled:{default:!0},event:{type:"string"},from:{type:"string"},to:{type:"string"},as:{type:"string"},bubbles:{default:!1}},multiple:!0,init:function(){var e,t,i,n=this.data,r=this.el,o=this;if(n.from?e="PARENT"===n.from?[r.parentNode]:document.querySelectorAll(n.from):i="CHILDREN"===n.to?r.querySelectorAll("*"):"SELF"===n.to?[r]:document.querySelectorAll(n.to),n.from)for(t=0;t<e.length;t++)this.addEventListenerFrom(e[t]);else r.addEventListener(n.event,(function(e){var n=o.data;if(n.enabled&&(n.captureBubbles||e.target===r))for(t=0;t<i.length;t++)i[t].emit(n.as||n.event,e.detail?e.detail:null,n.bubbles)}))},addEventListenerFrom:function(e){var t=this.data,i=this;e.addEventListener(t.event,(function(t){var n=i.data;n.enabled&&(n.captureBubbles||t.target===e)&&i.el.emit(n.as||n.event,t.detail?t.detail:null,!1)}))}})},2596:function(e){var t;"undefined"!=typeof self&&self,t=function(){return function(e){var t={};function i(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=1)}([function(e,t,i){"use strict";var n={};e.exports.select=function(e,t,i){return n[t]||(n[t]=new Function("state","item","return "+c(t)+";")),n[t](e,i)};var r=/\.([A-Za-z][\w_-]*)/g,o=/([=&|!?:+-])(\s*)([\(]?)([A-Za-z][\w_-]*)/g,s=/^([\(]?)([A-Za-z][\w_-]*)/g,a=/state\["item"\]/g,l=/state\["(true|false)"\]/g;function c(e){return(e=(e=(e=(e=e.replace(r,'["$1"]')).replace(s,'$1state["$2"]')).replace(o,'$1$2$3state["$4"]')).replace(a,"item")).replace(l,"$1")}function h(){var e=arguments;return function(){var t;for(t=0;t<e.length;t++)e[t].apply(this,arguments)}}e.exports.generateExpression=c,e.exports.clearObject=function(e){for(var t in e)delete e[t]},e.exports.composeHandlers=function(){var e,t,i,n=arguments;for(i={},t=0;t<n.length;t++)for(e in n[t])e in i?i[e].constructor===Array?i[e].push(n[t][e]):i[e]=[i[e],n[t][e]]:i[e]=n[t][e];for(e in i)i[e].constructor===Array&&(i[e]=h.apply(this,i[e]));return i},e.exports.composeFunctions=h;var u=["||","&&","!=","!==","==","===",">","<","<=",">="],d=/\s+/,p=/\(|\)|\!/g;function f(e){return-1===(e=function(e){return 0===e.indexOf("!!")?e.replace("!!",""):0===e.indexOf("!")?e.replace("!",""):e}(e.trim())).indexOf(".")?e:e.substring(0,e.indexOf("."))}e.exports.parseKeysToWatch=function(e,t,i){var n,r;for(r=g(t,d),n=0;n<r.length;n++)if(-1===u.indexOf(r[n])&&!r[n].startsWith("'")&&-1===e.indexOf(r[n])){if(i&&"item"===r[n])continue;e.push(f(r[n]).replace(p,""))}return e};var m={};function g(e,t){return m[t]||(m[t]={}),m[t][e]||(m[t][e]=e.split(t)),m[t][e]}e.exports.split=g,e.exports.copyArray=function(e,t){var i;for(e.length=0,i=0;i<t.length;i++)e[i]=t[i]}},function(e,t,i){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};i(2);var r,o,s=i(3),a=i(0),l=i(4).wrapArray,c={initialState:{},nonBindedStateKeys:[],handlers:{},computeState:[function(){}]},h="object";AFRAME.registerState=function(e){var t=c.computeState;e.computeState&&t.push(e.computeState),AFRAME.utils.extendDeep(c,e),c.computeState=t},AFRAME.registerSystem("state",{init:function(){var e,t=this;for(e in this.arrays=[],this.dirtyArrays=[],this.diff={},this.state=AFRAME.utils.clone(c.initialState),this.subscriptions=[],this.initEventHandlers(),this.state)this.state[e]&&this.state[e].constructor===Array&&(this.arrays.push(e),this.state[e].__dirty=!0,l(this.state[e]));this.lastState=AFRAME.utils.clone(this.state),this.eventDetail={lastState:this.lastState,state:this.state},this.el.addEventListener("loaded",(function(){var e;for(e=0;e<c.computeState.length;e++)c.computeState[e](t.state,"@@INIT");for(e=0;e<t.subscriptions.length;e++)t.subscriptions[e].onStateUpdate(t.state)}))},dispatch:(o=[],function(e,t){var i,n;for(c.handlers[e](this.state,t),i=0;i<c.computeState.length;i++)c.computeState[i](this.state,e,t);for(n in this.diff)delete this.diff[n];for(s(this.lastState,this.state,this.diff,c.nonBindedStateKeys),this.dirtyArrays.length=0,i=0;i<this.arrays.length;i++)this.state[this.arrays[i]].__dirty&&this.dirtyArrays.push(this.arrays[i]);for(o.length=0,i=0;i<this.subscriptions.length;i++){if("bind-for"===this.subscriptions[i].name){if(!this.state[this.subscriptions[i].keysToWatch[0]].__dirty)continue}else if(!this.shouldUpdate(this.subscriptions[i].keysToWatch,this.diff,this.dirtyArrays))continue;-1===o.indexOf(this.subscriptions[i])&&o.push(this.subscriptions[i])}for(i=0;i<o.length;i++)o[i].onStateUpdate();for(n in this.state)this.state[n]&&this.state[n].constructor===Array&&(this.state[n].__dirty=!1);this.copyState(this.lastState,this.state),this.eventDetail.action=e,this.eventDetail.payload=t,this.el.emit("stateupdate",this.eventDetail)}),copyState:function(e,t,i){var n;for(n in t)if(i||-1===c.nonBindedStateKeys.indexOf(n))if(t[n]&&t[n].constructor===Object){if(!(n in e)){e[n]=AFRAME.utils.clone(t[n]);continue}this.copyState(e[n],t[n],!0)}else e[n]=t[n]},subscribe:function(e){this.subscriptions.push(e)},unsubscribe:function(e){this.subscriptions.splice(this.subscriptions.indexOf(e),1)},shouldUpdate:function(e,t,i){for(var n=0;n<e.length;n++)if(e[n]in t||-1!==i.indexOf(e[n]))return!0;return!1},initEventHandlers:function(){var e,t=[];for(e in i=i.bind(this),c.handlers)-1===t.indexOf(e)&&(t.push(e),i(e));function i(e){var t=this;this.el.addEventListener(e,(function(i){t.dispatch(e,i.detail)}))}},renderTemplate:(r=/{{\s*(\w*\.)?([\w.]+)\s*}}/g,function(e,t,i){var o,s;if(s=e,t)for(;o=r.exec(e);)s=s.replace(o[0],(void 0===t?"undefined":n(t))===h?a.select(t,o[2])||"":t);return i?s:document.createRange().createContextualFragment(s)}),select:a.select}),AFRAME.registerComponent("bind",{schema:{default:{},parse:function(e){var t,i,n,r;if(e.constructor===Object)return e;if(-1===e.indexOf(":"))return e;for(t={},n=a.split(e,";"),i=0;i<n.length;i++)t[(r=a.split(n[i].trim(),":"))[0]]=r[1].trim();return t}},multiple:!0,init:function(){var e;this.data,this.keysToWatch=[],this.onStateUpdate=this.onStateUpdate.bind(this),this.system=this.el.sceneEl.systems.state,this.id&&(e=a.split(this.id,"__")[0]),this.isNamespacedBind=this.id&&e in AFRAME.components&&!AFRAME.components[e].isSingleProp||e in AFRAME.systems,this.lastData={},this.updateObj={},this.system.subscribe(this),this.onStateUpdate=this.onStateUpdate.bind(this)},update:function(){var e,t=this.data;if(this.keysToWatch.length=0,"string"==typeof t)a.parseKeysToWatch(this.keysToWatch,t);else for(e in t)a.parseKeysToWatch(this.keysToWatch,t[e]);this.onStateUpdate()},onStateUpdate:function(){var e,t,i,r,o=!1,s=this.el;if(s.parentNode){if(this.isNamespacedBind&&a.clearObject(this.updateObj),i=this.system.state,n(this.data)!==h){try{r=a.select(i,this.data)}catch(e){throw new Error("[aframe-state-component] Key '"+this.data+"' not found in state. #"+this.el.getAttribute("id")+"["+this.attrName+"]")}if((void 0===r?"undefined":n(r))!==h&&n(this.lastData)!==h&&this.lastData===r)return;return AFRAME.utils.entity.setComponentProperty(s,this.id,r),void(this.lastData=r)}for(e in this.data){t=this.data[e].trim();try{r=a.select(i,t)}catch(e){throw console.log(e),new Error("[aframe-state-component] Key '"+t+"' not found in state. #"+this.el.getAttribute("id")+"["+this.attrName+"]")}if((void 0===r?"undefined":n(r))===h||n(this.lastData[e])===h||this.lastData[e]!==r){if(e in AFRAME.components&&void 0===r)return void s.removeAttribute(e);this.isNamespacedBind?this.updateObj[e]=r:AFRAME.utils.entity.setComponentProperty(s,e,r),this.lastData[e]=r}}for(o in this.updateObj);this.isNamespacedBind&&o&&s.setAttribute(this.id,this.updateObj)}},remove:function(){this.system.unsubscribe(this)}}),AFRAME.registerComponent("bind-toggle",{schema:{type:"string"},multiple:!0,init:function(){this.system=this.el.sceneEl.systems.state,this.keysToWatch=[],this.onStateUpdate=this.onStateUpdate.bind(this),this.system.subscribe(this),this.onStateUpdate()},update:function(){this.keysToWatch.length=0,a.parseKeysToWatch(this.keysToWatch,this.data)},onStateUpdate:function(){var e,t,i=this.el;e=this.system.state;try{t=a.select(e,this.data)}catch(e){throw new Error("[aframe-state-component] Key '"+this.data+"' not found in state. #"+this.el.getAttribute("id")+"["+this.attrName+"]")}t?i.setAttribute(this.id,""):i.removeAttribute(this.id)},remove:function(){this.system.unsubscribe(this)}}),e.exports={composeFunctions:a.composeFunctions,composeHandlers:a.composeHandlers,select:a.select}},function(e,t,i){"use strict";var n,r,o=i(0);AFRAME.registerComponent("bind-for",{schema:{delay:{default:0},for:{type:"string",default:"item"},in:{type:"string"},key:{type:"string"},pool:{default:0},template:{type:"string"},updateInPlace:{default:!1}},init:function(){this.system=this.el.sceneEl.systems.state,this.onStateUpdate=this.onStateUpdate.bind(this),this.keysToWatch=[],this.renderedKeys=[],this.system.subscribe(this),this.el.children[0]&&"TEMPLATE"===this.el.children[0].tagName?this.template=this.el.children[0].innerHTML.trim():this.template=document.querySelector(this.data.template).innerHTML.trim();for(var e=0;e<this.data.pool;e++)this.el.appendChild(this.generateFromTemplate(null,e))},update:function(){this.keysToWatch[0]=o.split(this.data.in,".")[0],this.onStateUpdate()},onStateUpdateNaive:(r=[],function(){var e,t=this.data,i=this.el;try{e=o.select(this.system.state,t.in)}catch(e){throw new Error("[aframe-state-component] Key '"+t.in+"' not found in state. #"+i.getAttribute("id")+"["+this.attrName+"]")}r.length=0;for(var n=0;n<e.length;n++){var s=e[n];r.push(t.key?s[t.key].toString():s.toString())}for(var a=this.getElsToRemove(r,this.renderedKeys),l=0;l<a.length;l++)a[l].parentNode.removeChild(a[l]);e.length&&this.renderItems(e,r,0)}),renderItems:function(e,t,i){var n,r=this,o=this.data,s=this.el,a=e[i],l=o.key?a[o.key].toString():a.toString();if(-1===this.renderedKeys.indexOf(l))n=this.generateFromTemplate(a,i),s.appendChild(n),this.renderedKeys.push(l);else{if(e.length&&e[0].constructor===String){var c=o.key?a[o.key].toString():a.toString();(n=s.querySelector('[data-bind-for-value="'+c+'"]')).setAttribute("data-bind-for-key",i)}else{var h=this.getBindForKey(a,i);n=s.querySelector('[data-bind-for-key="'+h+'"]')}n.emit("bindforupdate",a,!1)}e[i+1]&&(this.data.delay?setTimeout((function(){r.renderItems(e,t,i+1)}),this.data.delay):this.renderItems(e,t,i+1))},onStateUpdateInPlace:function(){var e=[];return function(){var t,i,n=this.data,r=this.el;try{t=o.select(this.system.state,n.in)}catch(e){throw console.log(e),new Error("[aframe-state-component] Key '"+n.in+"' not found in state. #"+r.getAttribute("id")+"["+this.attrName+"]")}e.length=0;for(var s=0;s<t.length;s++){var a=t[s];i=n.key?a[n.key].toString():a.toString(),e.push(i)}for(var l=this.getElsToRemove(e,this.renderedKeys),c=0;c<l.length;c++)l[c].object3D.visible=!1,l[c].setAttribute("data-bind-for-active","false"),l[c].removeAttribute("data-bind-for-key"),l[c].removeAttribute("data-bind-for-value"),l[c].emit("bindfordeactivate",null,!1),l[c].pause();t.length&&this.renderItemsInPlace(t,e,0)}}(),renderItemsInPlace:function(e,t,i){var n,r=this,o=this.data,s=this.el,a=e[i],l=this.getBindForKey(a,i),c=o.key?a[o.key].toString():a.toString();if(-1===this.renderedKeys.indexOf(c)){if(s.querySelector(':scope > [data-bind-for-active="false"]'))(n=s.querySelector('[data-bind-for-active="false"]')).setAttribute("data-bind-for-key",l),n.setAttribute("data-bind-for-value",c),n.object3D.visible=!0,n.play(),n.setAttribute("data-bind-for-active","true"),n.emit("bindforupdateinplace",a,!1);else{var h=this.generateFromTemplate(a,i);h.addEventListener("loaded",(function(){h.emit("bindforupdateinplace",a,!1)})),s.appendChild(h)}this.renderedKeys.push(c)}else-1!==t.indexOf(c)&&(e.length&&e[0].constructor===String?(n=s.querySelector('[data-bind-for-value="'+c+'"]')).setAttribute("data-bind-for-key",i):n=s.querySelector('[data-bind-for-key="'+l+'"]'),n.emit("bindforupdateinplace",a,!1));e[i+1]&&(this.data.delay?setTimeout((function(){r.renderItemsInPlace(e,t,i+1)}),this.data.delay):this.renderItemsInPlace(e,t,i+1))},generateFromTemplate:function(e,t){var i=this.data;this.el.appendChild(this.system.renderTemplate(this.template,e));var n=this.el.children[this.el.children.length-1];if(!e)return n.setAttribute("data-bind-for-key",""),n.setAttribute("data-bind-for-active","false"),n;var r=this.getBindForKey(e,t);return n.setAttribute("data-bind-for-key",r),i.key||n.setAttribute("data-bind-for-value",e),n.setAttribute("data-bind-for-active","true"),n},getElsToRemove:(n=[],function(e,t){var i=this.data,r=this.el;n.length=0;for(var o=0;o<r.children.length;o++)if("TEMPLATE"!==r.children[o].tagName){var s=i.key?r.children[o].getAttribute("data-bind-for-key"):r.children[o].getAttribute("data-bind-for-value");-1===e.indexOf(s)&&-1!==t.indexOf(s)&&(n.push(r.children[o]),t.splice(t.indexOf(s),1))}return n}),getBindForKey:function(e,t){return this.data.key?e[this.data.key].toString():t.toString()},onStateUpdate:function(){this.data.updateInPlace?this.onStateUpdateInPlace():this.onStateUpdateNaive()}}),AFRAME.registerComponent("bind-item",{schema:{type:"string"},multiple:!0,init:function(){this.itemData=null,this.keysToWatch=[],this.prevValues={};var e=this.rootEl=this.el.closest("[data-bind-for-key]");if(!e)throw new Error("bind-item component must be attached to entity under a bind-for item.");e.addEventListener("bindforupdateinplace",this.updateInPlace.bind(this)),e.addEventListener("bindfordeactivate",this.deactivate.bind(this)),this.el.sceneEl.systems.state.subscribe(this)},update:function(){this.parseSelector()},updateInPlace:function(e){var t=this.propertyMap;if("false"!==this.rootEl.getAttribute("data-bind-for-active"))for(var i in e&&(this.itemData=e.detail),t){var n=this.select(this.itemData,t[i]);n!==this.prevValues[i]&&(AFRAME.utils.entity.setComponentProperty(this.el,i,n),this.prevValues[i]=n)}},onStateUpdate:function(){this.updateInPlace()},select:function(e,t){return o.select(this.el.sceneEl.systems.state.state,t,e)},deactivate:function(){this.prevValues={}},parseSelector:function(){var e=this.propertyMap={};this.keysToWatch.length=0;var t=o.split(this.id,"__")[0];if(!(t in AFRAME.components)||AFRAME.components[t].isSingleProp)e[this.id]=this.data,o.parseKeysToWatch(this.keysToWatch,this.data,!0);else for(var i=o.split(this.data,";"),n=0;n<i.length;n++){var r=o.split(i[n],":");e[this.id+"."+r[0].trim()]=r[1].trim(),o.parseKeysToWatch(this.keysToWatch,r[1].trim(),!0)}}})},function(e,t,i){"use strict";var n;e.exports=(n=[],function(e,t,i,r){var o,s,a,l,c,h,u;for(c in l=i||{},n.length=0,e)n.push(c);if(!t)return l;for(a in t)-1===n.indexOf(a)&&n.push(a);for(h=0;h<n.length;h++)c=n[h],r&&-1!==r.indexOf(c)||(o=e[c],s=t[c],((u=o&&s&&o.constructor===Object&&s.constructor===Object)&&!AFRAME.utils.deepEqual(o,s)||!u&&o!==s)&&(l[c]=s));return l})},function(e,t,i){"use strict";var n=["push","pop","shift","unshift","splice"];function r(e,t){var i=e[t];e[t]=function(){i.apply(e,arguments),e.__dirty=!0}}e.exports.wrapArray=function(e){var t;if(!e.__wrapped){for(t=0;t<n.length;t++)r(e,n[t]);e.__wrapped=!0}}}])},e.exports=t()},5174:()=>{document.addEventListener("DOMContentLoaded",(function(){let e=document.getElementById("app");e||(e=document.createElement("div"),e.id="app",document.body.appendChild(e)),e.innerHTML='<a-scene\n  timer\n  environment="preset: forest; dressingAmount: 500"\n  physics="driver: ammo;"\n  renderer="antialias: true"\n  bind__debug="debugOn"\n  cursor="rayOrigin: mouse"\n  raycaster="far: 5; objects: [raycastable]"\n  bind__raycaster="enabled: !controllerConnected"\n>\n  <a-assets>\n    \x3c!-- <require path="/Users/carmencincotti/Code/ccincotti3/webxr-cup-ball-game/src/assets.html"> --\x3e\n\x3c!-- ASSET ITEMS --\x3e\n<a-asset-item id="cup-top-obj" src="assets/models/cup.gltf"></a-asset-item>\n\n\x3c!-- IMG ITEMS --\x3e\n\x3c!-- Textures need to be image tags !--\x3e\n<img id="logo" src="assets/images/logo.png" />\n\n\x3c!-- MIXINS --\x3e\n<a-mixin\n  id="flatPanel"\n  material="shader: planeShader; ratio: 2; src: panel-texture;"\n  geometry="primitive: plane;"\n></a-mixin>\n<a-mixin\n  id="primaryFont"\n  text="font: monoid; align: center; width: 1;"\n></a-mixin>\n\n\x3c!-- COMPONENTS --\x3e\n<a-mixin\n  id="link"\n  geometry="primitive: sphere"\n  scale="0.02 0.02 0.02"\n  ammo-body="disableCollision: true; collisionFilterGroup: 16; collisionFilterMask: 2; linearDamping: 0.2; type: dynamic; activationState: disableDeactivation"\n  ammo-shape="fit: manual; type: sphere; sphereRadius: 0.02"\n  material="color: white"\n></a-mixin>\n<a-mixin\n  id="ball"\n  geometry="primitive: sphere"\n  scale="0.05 0.05 0.05"\n  ammo-body="emitCollisionEvents: true; collisionFilterGroup: 1; collisionFilterMask: 15; linearDamping: 0.2; type: dynamic; mass: 1; activationState: disableDeactivation"\n  ammo-shape="fit: manual; type: sphere; sphereRadius: 0.05"\n  material="color: red"\n></a-mixin>\n\n<a-mixin\n  id="hitPlane"\n  geometry="primitive: plane"\n  scale="0.01 0.01"\n  rotation="-90 0 0"\n  ammo-body="disableCollision: true; emitCollisionEvents: true; collisionFilterGroup: 8; collisionFilterMask: 1; type: static;"\n  ammo-shape\n  visible="false"\n></a-mixin>\n\x3c!-- </require> --\x3e</require>\n  </a-assets>\n  \x3c!-- <require path="/Users/carmencincotti/Code/ccincotti3/webxr-cup-ball-game/src/templates/intro.html"> --\x3e\n<a-entity bind__visible="isIntro">\n  <a-entity position="0 1.8 -2.8">\n    <a-image width="2.788" height="2" src="#logo"></a-image>\n  </a-entity>\n  <a-entity position="0 .8 -2.4">\n    <a-entity\n      mixin="flatPanel"\n      geometry="width: .7; height: .37"\n      position="0 .1 0"\n      proxy-event="event: click; to: a-scene; as: startGame"\n      raycastable\n    >\n      <a-entity\n        scale="4 4 4"\n        mixin="primaryFont"\n        text="value: PLAY;"\n      ></a-entity>\n    </a-entity>\n  </a-entity>\n</a-entity>\n\x3c!-- </require> --\x3e</require>\n  \x3c!-- <require path="/Users/carmencincotti/Code/ccincotti3/webxr-cup-ball-game/src/templates/game.html"> --\x3e\n<a-entity bind__visible="isGame">\n  <a-entity\n    bind__visible="!gameOver"\n    scale="6 6 6"\n    position="0 1.6 -2"\n    lookAt="#player"\n  >\n    <a-entity\n      mixin="primaryFont"\n      position="0 .02 0"\n      text="value: SCORE"\n    ></a-entity>\n    <a-entity\n      mixin="primaryFont"\n      scale="3 3 3"\n      position="0 -0.05 0"\n      bind__text="value: score"\n    ></a-entity>\n    <a-entity\n      mixin="primaryFont"\n      position="-0.1 -0.15 0"\n      text="value: TIME"\n    ></a-entity>\n    <a-entity\n      mixin="primaryFont"\n      position="0 -0.15 0"\n      bind__text="value: timeRemaining"\n    ></a-entity>\n  </a-entity>\n  <a-entity bind__visible="gameOver">\n    <a-entity\n      mixin="flatPanel"\n      geometry="width: 2; height: 2"\n      position="0.0 1.6 -2"\n      material="ratio: 1"\n    >\n      <a-entity scale="5 5 5" position="0 0.5 0">\n        <a-entity\n          mixin="primaryFont"\n          scale="1.4 1.4 1.4"\n          text="value: NICE JOB!;"\n        ></a-entity>\n        <a-entity position="0 -0.06 0">\n          <a-entity\n            mixin="primaryFont"\n            position="-0.02 0 0"\n            text="value: SCORE: "\n          ></a-entity>\n          <a-entity\n            mixin="primaryFont"\n            position="0.07 0 0"\n            bind__text="value: score"\n          ></a-entity>\n        </a-entity>\n        <a-entity\n          mixin="flatPanel"\n          geometry="width: .3; height: .1"\n          position="0 -0.15 0.01"\n          proxy-event="event: click; to: a-scene; as: startGame"\n          raycastable\n          material="selected: true"\n        >\n          <a-entity mixin="primaryFont" text="value: PLAY AGAIN;"></a-entity>\n        </a-entity>\n      </a-entity>\n    </a-entity>\n  </a-entity>\n</a-entity>\n\x3c!-- </require> --\x3e</require>\n\n  <a-entity id="rig" movement-controls>\n    <a-entity id="player" camera position="0 1.6 0" look-controls></a-entity>\n    \n      \n    <a-entity\n      id="rightHand"\n      position="0 1 0"\n      controller\n      cursor="rayOrigin: entity"\n      raycaster="far: 5; objects: [raycastable];"\n      bind__raycaster="showLine: !showCup && controllerConnected; enabled: !showCup && controllerConnected"\n      laser-controls="model: false; hand:right"\n      haptics="events: mouseenter, triggerdown, collidestart; dur: 35; force: 0.075"\n    >\n      <a-entity bind__visible="!showCup">\n        <a-box scale="0.1 0.1 0.1" id="rightHandMesh">\n        </a-box>\n      </a-entity>\n      <a-entity bind__visible="showCup">\n        <a-gltf-model\n          cup\n          bind__visible="showCup"\n          material="side: double"\n          id="rightCupTop"\n          src="#cup-top-obj"\n        >\n          <a-box\n            mixin="hitPlane"\n            id="rightHitPlane"\n            proxy-event="event: collidestart; to: a-scene; as: rightPlaneHit"\n          >\n          </a-box>\n          <a-entity\n            id="rightRope"\n            bind__rope="enabled: showCup; ropeLength: rightRopeLength"\n          >\n             \n    <a-entity\n      mixin="link"\n      id="rightLink-0"\n      bind__visible="rightRopeLength > 0"\n    ></a-entity>\n      \n    <a-entity\n      mixin="link"\n      id="rightLink-1"\n      bind__visible="rightRopeLength > 1"\n    ></a-entity>\n      \n    <a-entity\n      mixin="link"\n      id="rightLink-2"\n      bind__visible="rightRopeLength > 2"\n    ></a-entity>\n      \n    <a-entity\n      mixin="link"\n      id="rightLink-3"\n      bind__visible="rightRopeLength > 3"\n    ></a-entity>\n      \n    <a-entity\n      mixin="link"\n      id="rightLink-4"\n      bind__visible="rightRopeLength > 4"\n    ></a-entity>\n      \n    <a-entity\n      mixin="link"\n      id="rightLink-5"\n      bind__visible="rightRopeLength > 5"\n    ></a-entity>\n      \n    <a-entity\n      mixin="link"\n      id="rightLink-6"\n      bind__visible="rightRopeLength > 6"\n    ></a-entity>\n      \n    <a-entity\n      mixin="link"\n      id="rightLink-7"\n      bind__visible="rightRopeLength > 7"\n    ></a-entity>\n      \n    <a-entity\n      mixin="link"\n      id="rightLink-8"\n      bind__visible="rightRopeLength > 8"\n    ></a-entity>\n      \n    <a-entity\n      mixin="link"\n      id="rightLink-9"\n      bind__visible="rightRopeLength > 9"\n    ></a-entity>\n     \n          </a-entity>\n          <a-entity\n            id="rightBall"\n            bind__ball="ropeLength: rightRopeLength"\n            ball="target: #rightLink;"\n            mixin="ball"\n          ></a-entity>\n        </a-gltf-model>\n      </a-entity>\n    </a-entity>\n     \n    <a-entity\n      id="leftHand"\n      position="0 1 0"\n      controller\n      cursor="rayOrigin: entity"\n      raycaster="far: 5; objects: [raycastable];"\n      bind__raycaster="showLine: !showCup && controllerConnected; enabled: !showCup && controllerConnected"\n      laser-controls="model: false; hand:left"\n      haptics="events: mouseenter, triggerdown, collidestart; dur: 35; force: 0.075"\n    >\n      <a-entity bind__visible="!showCup">\n        <a-box scale="0.1 0.1 0.1" id="leftHandMesh">\n        </a-box>\n      </a-entity>\n      <a-entity bind__visible="showCup">\n        <a-gltf-model\n          cup\n          bind__visible="showCup"\n          material="side: double"\n          id="leftCupTop"\n          src="#cup-top-obj"\n        >\n          <a-box\n            mixin="hitPlane"\n            id="leftHitPlane"\n            proxy-event="event: collidestart; to: a-scene; as: leftPlaneHit"\n          >\n          </a-box>\n          <a-entity\n            id="leftRope"\n            bind__rope="enabled: showCup; ropeLength: leftRopeLength"\n          >\n             \n    <a-entity\n      mixin="link"\n      id="leftLink-0"\n      bind__visible="leftRopeLength > 0"\n    ></a-entity>\n      \n    <a-entity\n      mixin="link"\n      id="leftLink-1"\n      bind__visible="leftRopeLength > 1"\n    ></a-entity>\n      \n    <a-entity\n      mixin="link"\n      id="leftLink-2"\n      bind__visible="leftRopeLength > 2"\n    ></a-entity>\n      \n    <a-entity\n      mixin="link"\n      id="leftLink-3"\n      bind__visible="leftRopeLength > 3"\n    ></a-entity>\n      \n    <a-entity\n      mixin="link"\n      id="leftLink-4"\n      bind__visible="leftRopeLength > 4"\n    ></a-entity>\n      \n    <a-entity\n      mixin="link"\n      id="leftLink-5"\n      bind__visible="leftRopeLength > 5"\n    ></a-entity>\n      \n    <a-entity\n      mixin="link"\n      id="leftLink-6"\n      bind__visible="leftRopeLength > 6"\n    ></a-entity>\n      \n    <a-entity\n      mixin="link"\n      id="leftLink-7"\n      bind__visible="leftRopeLength > 7"\n    ></a-entity>\n      \n    <a-entity\n      mixin="link"\n      id="leftLink-8"\n      bind__visible="leftRopeLength > 8"\n    ></a-entity>\n      \n    <a-entity\n      mixin="link"\n      id="leftLink-9"\n      bind__visible="leftRopeLength > 9"\n    ></a-entity>\n     \n          </a-entity>\n          <a-entity\n            id="leftBall"\n            bind__ball="ropeLength: leftRopeLength"\n            ball="target: #leftLink;"\n            mixin="ball"\n          ></a-entity>\n        </a-gltf-model>\n      </a-entity>\n    </a-entity>\n    \n  </a-entity>\n</a-scene>\n'}))},8191:(e,t,i)=>{"use strict";i.r(t);var n=i(1296),r=i.n(n);AFRAME.registerComponent("ball",{schema:{ropeLength:{type:"number",default:r().STARTING_ROPE_LENGTH},target:{type:"string",default:""}},init:function(){this.setTarget()},update(e){e.ropeLength!==this.data.ropeLength&&this.setTarget()},setTarget:function(){this.el.setAttribute("ammo-constraint",{target:this.data.target+"-"+String(this.data.ropeLength-1),type:"hinge",pivot:"0 0.10 0"})}})},1693:()=>{AFRAME.registerComponent("controller",{init:function(){this.controllerType="",this.el.addEventListener("controllerconnected",(e=>{this.el.emit("enableControllerControls")}))}})},2049:(e,t,i)=>{const n=i(5788);AFRAME.registerComponent("cup",{init:function(){this.loaded=!1,this.el.addEventListener("model-loaded",this.onLoaded.bind(this))},onLoaded:function(){this.el.setAttribute("ammo-body",{collisionFilterMask:n.cup.mask,collisionFilterGroup:n.cup.group,type:n.cup.type}),this.el.setAttribute("ammo-shape","type","hacd"),this.el.getObject3D("mesh").traverse((function(e){e.isMesh&&(e.material=new THREE.MeshPhongMaterial({color:6439462}))})),this.loaded=!0}})},490:(e,t,i)=>{AFRAME.registerShader("planeShader",{schema:{src:{type:"map"},selected:{type:"boolean",default:!1},ratio:{type:"number",is:"uniform",default:1}},vertexShader:i(40),fragmentShader:i(1463),raw:!0,init:function(e){this.primaryColor=new THREE.Vector3(.937,.843,.6),this.secondaryColor=new THREE.Vector3(.851,.651,.427),this.selectedColor=new THREE.Vector3(0,.7,.1),this.ratio=e.ratio,this.material=new THREE.RawShaderMaterial({vertexShader:this.vertexShader,fragmentShader:this.fragmentShader,uniforms:{u_primary_color:{type:"vec3",value:this.primaryColor},u_secondary_color:{type:"vec3",value:this.secondaryColor},u_ratio:{type:"number",value:this.ratio}},transparent:!0})},update:function(e){const t=e.selected;e.ratio,this.material.uniforms.u_primary_color.value=t?this.selectedColor:this.primaryColor,this.material.uniforms.u_secondary_color.value=t?this.selectedColor:this.secondaryColor,this.material.needsUpdate=!0}})},2264:(e,t,i)=>{"use strict";i.r(t);var n=i(1296),r=i.n(n);AFRAME.registerComponent("rope",{schema:{ropeLength:{type:"number",default:r().STARTING_ROPE_LENGTH},enabled:{type:"boolean",default:!1}},init:function(){this.setLinkPhysics=this.setLinkPhysics.bind(this),this.initRope()},update:function(e){if(this.data.enabled&&e.ropeLength!==this.data.ropeLength)for(let e=0;e<this.el.children.length;e++){const t=this.el.children[e];this.setLinkPhysics(t,e)}},initRope:function(){let e=this.el.parentElement.id;for(let t=0;t<this.el.children.length;t++){const i=this.el.children[t];i.setAttribute("ammo-constraint",{target:"#"+e,type:"hinge",pivot:"0 0.10 0"}),e=i.id}},setLinkPhysics:function(e,t){e.setAttribute("ammo-body",{linearDamping:t<this.data.ropeLength?"0.2":"0.01",angularDamping:t<this.data.ropeLength?"0.01":"0"}),e.setAttribute("ammo-constraint",{pivot:t<this.data.ropeLength?"0 0.10 0":"0 0 0"})}})},4403:(e,t,i)=>{"use strict";i.r(t);var n=i(1296),r=i.n(n);AFRAME.registerState({initialState:{score:0,leftRopeLength:r().STARTING_ROPE_LENGTH,rightRopeLength:r().STARTING_ROPE_LENGTH,mode:r().MODES.INTRO,gameOver:!0,timeStart:0,timeElapsed:0,timeRemaining:r().SECONDS_TO_PLAY,controllerConnected:!1,showCup:!1,isIntro:!0,isGame:!1,debugOn:!0},handlers:{rightPlaneHit:function(e,t){"rightBall"===t.targetEl.id&&(e.score++,e.rightRopeLength<r().MAX_ROPE_LENGTH&&e.rightRopeLength++)},leftPlaneHit:function(e,t){"leftBall"===t.targetEl.id&&(e.score++,e.leftRopeLength<r().MAX_ROPE_LENGTH&&e.leftRopeLength++)},setGameMode:function(e,t){e.mode=t.mode},setTimeElapsed:function(e,t){e.timeElapsed=t.elapsed},startGame:function(e){e.mode=r().MODES.GAME,e.gameOver=!1,e.score=0,e.timeStart=e.timeElapsed,e.timeRemaining=r().SECONDS_TO_PLAY,e.leftRopeLength=r().STARTING_ROPE_LENGTH,e.rightRopeLength=r().STARTING_ROPE_LENGTH},enableControllerControls:function(e){e.controllerConnected=!0}},computeState:function(e,t){e.timeRemaining=e.gameOver||e.timeRemaining<=0?0:Math.ceil(r().SECONDS_TO_PLAY-(e.timeElapsed-e.timeStart)/1e3),e.gameOver=e.gameOver||e.timeRemaining<=0,e.isIntro=e.mode===r().MODES.INTRO,e.isGame=e.mode===r().MODES.GAME,e.showCup=!e.gameOver}})},716:()=>{AFRAME.registerComponent("timer",{init:function(){this.tick=AFRAME.utils.throttleTick(this.tick,1e3,this)},update:function(){},tick:function(e,t){this.el.emit("setTimeElapsed",{elapsed:e})}})},1296:e=>{e.exports={SECONDS_TO_PLAY:30,STARTING_ROPE_LENGTH:5,MAX_ROPE_LENGTH:10,MODES:{INTRO:"intro",GAME:"game"}}},5788:e=>{const t="kinematic",i="static",n="dynamic",r={ball:{group:1,mask:15,type:n},ground:{group:2,mask:31,type:i},cup:{group:4,mask:3,type:t},hand:{group:4,mask:7,type:t},hitPlane:{group:8,mask:1,type:i},ropeSegment:{group:16,mask:2,type:n}};e.exports=r},2985:function(e){var t;"undefined"!=typeof self&&self,t=function(){return function(e){var t={};function i(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=11)}([function(e,t,i){"use strict";var n=Array.prototype,r=Object.prototype,o={"&":"&amp;",'"':"&quot;","'":"&#39;","<":"&lt;",">":"&gt;"},s=/[&"'<>]/g;function a(e,t){return r.hasOwnProperty.call(e,t)}function l(e){return o[e]}function c(e,t,i){var n,r,o;if(e instanceof Error&&(e=(r=e).name+": "+r.message),Object.setPrototypeOf?(n=new Error(e),Object.setPrototypeOf(n,c.prototype)):(n=this,Object.defineProperty(n,"message",{enumerable:!1,writable:!0,value:e})),Object.defineProperty(n,"name",{value:"Template render error"}),Error.captureStackTrace&&Error.captureStackTrace(n,this.constructor),r){var s=Object.getOwnPropertyDescriptor(r,"stack");(o=s&&(s.get||function(){return s.value}))||(o=function(){return r.stack})}else{var a=new Error(e).stack;o=function(){return a}}return Object.defineProperty(n,"stack",{get:function(){return o.call(n)}}),Object.defineProperty(n,"cause",{value:r}),n.lineno=t,n.colno=i,n.firstUpdate=!0,n.Update=function(e){var t="("+(e||"unknown path")+")";return this.firstUpdate&&(this.lineno&&this.colno?t+=" [Line "+this.lineno+", Column "+this.colno+"]":this.lineno&&(t+=" [Line "+this.lineno+"]")),t+="\n ",this.firstUpdate&&(t+=" "),this.message=t+(this.message||""),this.firstUpdate=!1,this},n}function h(e){return"[object Function]"===r.toString.call(e)}function u(e){return"[object Array]"===r.toString.call(e)}function d(e){return"[object String]"===r.toString.call(e)}function p(e){return"[object Object]"===r.toString.call(e)}function f(e){var t,i=(t=e)?"string"==typeof t?t.split("."):[t]:[];return function(e){for(var t=e,n=0;n<i.length;n++){var r=i[n];if(!a(t,r))return;t=t[r]}return t}}function m(e){return Array.prototype.slice.call(e)}function g(e,t,i){return Array.prototype.indexOf.call(e||[],t,i)}function v(e){var t=[];for(var i in e)a(e,i)&&t.push(i);return t}(t=e.exports={}).hasOwnProp=a,t._prettifyError=function(e,i,n){if(n.Update||(n=new t.TemplateError(n)),n.Update(e),!i){var r=n;(n=new Error(r.message)).name=r.name}return n},Object.setPrototypeOf?Object.setPrototypeOf(c.prototype,Error.prototype):c.prototype=Object.create(Error.prototype,{constructor:{value:c}}),t.TemplateError=c,t.escape=function(e){return e.replace(s,l)},t.isFunction=h,t.isArray=u,t.isString=d,t.isObject=p,t.getAttrGetter=f,t.groupBy=function(e,t,i){for(var n={},r=h(t)?t:f(t),o=0;o<e.length;o++){var s=e[o],a=r(s,o);if(void 0===a&&!0===i)throw new TypeError('groupby: attribute "'+t+'" resolved to undefined');(n[a]||(n[a]=[])).push(s)}return n},t.toArray=m,t.without=function(e){var t=[];if(!e)return t;for(var i=e.length,n=m(arguments).slice(1),r=-1;++r<i;)-1===g(n,e[r])&&t.push(e[r]);return t},t.repeat=function(e,t){for(var i="",n=0;n<t;n++)i+=e;return i},t.each=function(e,t,i){if(null!=e)if(n.forEach&&e.forEach===n.forEach)e.forEach(t,i);else if(e.length===+e.length)for(var r=0,o=e.length;r<o;r++)t.call(i,e[r],r,e)},t.map=function(e,t){var i=[];if(null==e)return i;if(n.map&&e.map===n.map)return e.map(t);for(var r=0;r<e.length;r++)i[i.length]=t(e[r],r);return e.length===+e.length&&(i.length=e.length),i},t.asyncIter=function(e,t,i){var n=-1;!function r(){++n<e.length?t(e[n],n,r,i):i()}()},t.asyncFor=function(e,t,i){var n=v(e||{}),r=n.length,o=-1;!function s(){o++;var a=n[o];o<r?t(a,e[a],o,r,s):i()}()},t.indexOf=g,t.keys=v,t._entries=function(e){return v(e).map((function(t){return[t,e[t]]}))},t._values=function(e){return v(e).map((function(t){return e[t]}))},t._assign=t.extend=function(e,t){return e=e||{},v(t).forEach((function(i){e[i]=t[i]})),e},t.inOperator=function(e,t){if(u(t)||d(t))return-1!==t.indexOf(e);if(p(t))return e in t;throw new Error('Cannot use "in" operator to search for "'+e+'" in unexpected types.')}},function(e,t,i){"use strict";function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function r(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}function o(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,s(e,t)}function s(e,t){return s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},s(e,t)}var a=i(16),l=i(0);function c(e,t,i){i=i||{},l.keys(i).forEach((function(t){var n,r;i[t]=(n=e.prototype[t],r=i[t],"function"!=typeof n||"function"!=typeof r?r:function(){var e=this.parent;this.parent=n;var t=r.apply(this,arguments);return this.parent=e,t})}));var n=function(e){function i(){return e.apply(this,arguments)||this}return o(i,e),r(i,[{key:"typename",get:function(){return t}}]),i}(e);return l._assign(n.prototype,i),n}var h=function(){function e(){this.init.apply(this,arguments)}return e.prototype.init=function(){},e.extend=function(e,t){return"object"==typeof e&&(t=e,e="anonymous"),c(this,e,t)},r(e,[{key:"typename",get:function(){return this.constructor.name}}]),e}(),u=function(e){function t(){var t,i;return(t=i=e.call(this)||this).init.apply(t,arguments),i}return o(t,e),t.prototype.init=function(){},t.extend=function(e,t){return"object"==typeof e&&(t=e,e="anonymous"),c(this,e,t)},r(t,[{key:"typename",get:function(){return this.constructor.name}}]),t}(a);e.exports={Obj:h,EmitterObj:u}},function(e,t,i){"use strict";var n=i(0),r=Array.from,o="function"==typeof Symbol&&Symbol.iterator&&"function"==typeof r,s=function(){function e(e,t){this.variables=Object.create(null),this.parent=e,this.topLevel=!1,this.isolateWrites=t}var t=e.prototype;return t.set=function(e,t,i){var n=e.split("."),r=this.variables,o=this;if(i&&(o=this.resolve(n[0],!0)))o.set(e,t);else{for(var s=0;s<n.length-1;s++){var a=n[s];r[a]||(r[a]={}),r=r[a]}r[n[n.length-1]]=t}},t.get=function(e){var t=this.variables[e];return void 0!==t?t:null},t.lookup=function(e){var t=this.parent,i=this.variables[e];return void 0!==i?i:t&&t.lookup(e)},t.resolve=function(e,t){var i=t&&this.isolateWrites?void 0:this.parent;return void 0!==this.variables[e]?this:i&&i.resolve(e)},t.push=function(t){return new e(this,t)},t.pop=function(){return this.parent},e}();function a(e){return e&&Object.prototype.hasOwnProperty.call(e,"__keywords")}function l(e){var t=e.length;if(t){var i=e[t-1];if(a(i))return i}return{}}function c(e){var t=e.length;return 0===t?0:a(e[t-1])?t-1:t}function h(e){if("string"!=typeof e)return e;this.val=e,this.length=e.length}h.prototype=Object.create(String.prototype,{length:{writable:!0,configurable:!0,value:0}}),h.prototype.valueOf=function(){return this.val},h.prototype.toString=function(){return this.val},e.exports={Frame:s,makeMacro:function(e,t,i){return function(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];var s,a=c(r),h=l(r);if(a>e.length)s=r.slice(0,e.length),r.slice(s.length,a).forEach((function(e,i){i<t.length&&(h[t[i]]=e)})),s.push(h);else if(a<e.length){s=r.slice(0,a);for(var u=a;u<e.length;u++){var d=e[u];s.push(h[d]),delete h[d]}s.push(h)}else s=r;return i.apply(this,s)}},makeKeywordArgs:function(e){return e.__keywords=!0,e},numArgs:c,suppressValue:function(e,t){return e=null!=e?e:"",!t||e instanceof h||(e=n.escape(e.toString())),e},ensureDefined:function(e,t,i){if(null==e)throw new n.TemplateError("attempted to output null or undefined value",t+1,i+1);return e},memberLookup:function(e,t){if(null!=e)return"function"==typeof e[t]?function(){for(var i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e[t].apply(e,n)}:e[t]},contextOrFrameLookup:function(e,t,i){var n=t.lookup(i);return void 0!==n?n:e.lookup(i)},callWrap:function(e,t,i,n){if(!e)throw new Error("Unable to call `"+t+"`, which is undefined or falsey");if("function"!=typeof e)throw new Error("Unable to call `"+t+"`, which is not a function");return e.apply(i,n)},handleError:function(e,t,i){return e.lineno?e:new n.TemplateError(e,t,i)},isArray:n.isArray,keys:n.keys,SafeString:h,copySafeness:function(e,t){return e instanceof h?new h(t):t.toString()},markSafe:function(e){var t=typeof e;return"string"===t?new h(e):"function"!==t?e:function(t){var i=e.apply(this,arguments);return"string"==typeof i?new h(i):i}},asyncEach:function(e,t,i,r){if(n.isArray(e)){var o=e.length;n.asyncIter(e,(function(e,n,r){switch(t){case 1:i(e,n,o,r);break;case 2:i(e[0],e[1],n,o,r);break;case 3:i(e[0],e[1],e[2],n,o,r);break;default:e.push(n,o,r),i.apply(this,e)}}),r)}else n.asyncFor(e,(function(e,t,n,r,o){i(e,t,n,r,o)}),r)},asyncAll:function(e,t,i,r){var o,s,a=0;function l(e,t){a++,s[e]=t,a===o&&r(null,s.join(""))}if(n.isArray(e))if(o=e.length,s=new Array(o),0===o)r(null,"");else for(var c=0;c<e.length;c++){var h=e[c];switch(t){case 1:i(h,c,o,l);break;case 2:i(h[0],h[1],c,o,l);break;case 3:i(h[0],h[1],h[2],c,o,l);break;default:h.push(c,o,l),i.apply(this,h)}}else{var u=n.keys(e||{});if(o=u.length,s=new Array(o),0===o)r(null,"");else for(var d=0;d<u.length;d++){var p=u[d];i(p,e[p],d,o,l)}}},inOperator:n.inOperator,fromIterator:function(e){return"object"!=typeof e||null===e||n.isArray(e)?e:o&&Symbol.iterator in e?r(e):e}}},function(e,t,i){"use strict";function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function r(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}function o(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,s(e,t)}function s(e,t){return s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},s(e,t)}function a(e,t,i){e instanceof t&&i.push(e),e instanceof l&&e.findAll(t,i)}var l=function(e){function t(){return e.apply(this,arguments)||this}o(t,e);var i=t.prototype;return i.init=function(e,t){for(var i=arguments,n=this,r=arguments.length,o=new Array(r>2?r-2:0),s=2;s<r;s++)o[s-2]=arguments[s];this.lineno=e,this.colno=t,this.fields.forEach((function(e,t){var r=i[t+2];void 0===r&&(r=null),n[e]=r}))},i.findAll=function(e,t){var i=this;return t=t||[],this instanceof h?this.children.forEach((function(i){return a(i,e,t)})):this.fields.forEach((function(n){return a(i[n],e,t)})),t},i.iterFields=function(e){var t=this;this.fields.forEach((function(i){e(t[i],i)}))},t}(i(1).Obj),c=function(e){function t(){return e.apply(this,arguments)||this}return o(t,e),r(t,[{key:"typename",get:function(){return"Value"}},{key:"fields",get:function(){return["value"]}}]),t}(l),h=function(e){function t(){return e.apply(this,arguments)||this}o(t,e);var i=t.prototype;return i.init=function(t,i,n){e.prototype.init.call(this,t,i,n||[])},i.addChild=function(e){this.children.push(e)},r(t,[{key:"typename",get:function(){return"NodeList"}},{key:"fields",get:function(){return["children"]}}]),t}(l),u=h.extend("Root"),d=c.extend("Literal"),p=c.extend("Symbol"),f=h.extend("Group"),m=h.extend("Array"),g=l.extend("Pair",{fields:["key","value"]}),v=h.extend("Dict"),y=l.extend("LookupVal",{fields:["target","val"]}),b=l.extend("If",{fields:["cond","body","else_"]}),E=b.extend("IfAsync"),x=l.extend("InlineIf",{fields:["cond","body","else_"]}),w=l.extend("For",{fields:["arr","name","body","else_"]}),T=w.extend("AsyncEach"),k=w.extend("AsyncAll"),_=l.extend("Macro",{fields:["name","args","body"]}),A=_.extend("Caller"),C=l.extend("Import",{fields:["template","target","withContext"]}),S=function(e){function t(){return e.apply(this,arguments)||this}return o(t,e),t.prototype.init=function(t,i,n,r,o){e.prototype.init.call(this,t,i,n,r||new h,o)},r(t,[{key:"typename",get:function(){return"FromImport"}},{key:"fields",get:function(){return["template","names","withContext"]}}]),t}(l),R=l.extend("FunCall",{fields:["name","args"]}),L=R.extend("Filter"),O=L.extend("FilterAsync",{fields:["name","args","symbol"]}),M=v.extend("KeywordArgs"),N=l.extend("Block",{fields:["name","body"]}),D=l.extend("Super",{fields:["blockName","symbol"]}),P=l.extend("TemplateRef",{fields:["template"]}).extend("Extends"),I=l.extend("Include",{fields:["template","ignoreMissing"]}),H=l.extend("Set",{fields:["targets","value"]}),F=l.extend("Switch",{fields:["expr","cases","default"]}),j=l.extend("Case",{fields:["cond","body"]}),B=h.extend("Output"),K=l.extend("Capture",{fields:["body"]}),z=d.extend("TemplateData"),V=l.extend("UnaryOp",{fields:["target"]}),G=l.extend("BinOp",{fields:["left","right"]}),U=G.extend("In"),q=G.extend("Is"),W=G.extend("Or"),X=G.extend("And"),Y=V.extend("Not"),Z=G.extend("Add"),J=G.extend("Concat"),$=G.extend("Sub"),Q=G.extend("Mul"),ee=G.extend("Div"),te=G.extend("FloorDiv"),ie=G.extend("Mod"),ne=G.extend("Pow"),re=V.extend("Neg"),oe=V.extend("Pos"),se=l.extend("Compare",{fields:["expr","ops"]}),ae=l.extend("CompareOperand",{fields:["expr","type"]}),le=l.extend("CallExtension",{init:function(e,t,i,n){this.parent(),this.extName=e.__name||e,this.prop=t,this.args=i||new h,this.contentArgs=n||[],this.autoescape=e.autoescape},fields:["extName","prop","args","contentArgs"]}),ce=le.extend("CallExtensionAsync");function he(e,t,i){var n=e.split("\n");n.forEach((function(e,r){e&&(i&&r>0||!i)&&process.stdout.write(" ".repeat(t));var o=r===n.length-1?"":"\n";process.stdout.write(""+e+o)}))}e.exports={Node:l,Root:u,NodeList:h,Value:c,Literal:d,Symbol:p,Group:f,Array:m,Pair:g,Dict:v,Output:B,Capture:K,TemplateData:z,If:b,IfAsync:E,InlineIf:x,For:w,AsyncEach:T,AsyncAll:k,Macro:_,Caller:A,Import:C,FromImport:S,FunCall:R,Filter:L,FilterAsync:O,KeywordArgs:M,Block:N,Super:D,Extends:P,Include:I,Set:H,Switch:F,Case:j,LookupVal:y,BinOp:G,In:U,Is:q,Or:W,And:X,Not:Y,Add:Z,Concat:J,Sub:$,Mul:Q,Div:ee,FloorDiv:te,Mod:ie,Pow:ne,Neg:re,Pos:oe,Compare:se,CompareOperand:ae,CallExtension:le,CallExtensionAsync:ce,printNodes:function e(t,i){if(i=i||0,he(t.typename+": ",i),t instanceof h)he("\n"),t.children.forEach((function(t){e(t,i+2)}));else if(t instanceof le)he(t.extName+"."+t.prop+"\n"),t.args&&e(t.args,i+2),t.contentArgs&&t.contentArgs.forEach((function(t){e(t,i+2)}));else{var n=[],r=null;t.iterFields((function(e,t){e instanceof l?n.push([t,e]):(r=r||{})[t]=e})),r?he(JSON.stringify(r,null,2)+"\n",null,!0):he("\n"),n.forEach((function(t){var n=t[0],r=t[1];he("["+n+"] =>",i+2),e(r,i+4)}))}}}},function(e,t){},function(e,t,i){"use strict";function n(e,t){return n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(e,t)}var r=i(8),o=i(17),s=i(3),a=i(0).TemplateError,l=i(2).Frame,c=i(1).Obj,h={"==":"==","===":"===","!=":"!=","!==":"!==","<":"<",">":">","<=":"<=",">=":">="},u=function(e){var t,i;function r(){return e.apply(this,arguments)||this}i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,n(t,i);var o=r.prototype;return o.init=function(e,t){this.templateName=e,this.codebuf=[],this.lastId=0,this.buffer=null,this.bufferStack=[],this._scopeClosers="",this.inBlock=!1,this.throwOnUndefined=t},o.fail=function(e,t,i){throw void 0!==t&&(t+=1),void 0!==i&&(i+=1),new a(e,t,i)},o._pushBuffer=function(){var e=this._tmpid();return this.bufferStack.push(this.buffer),this.buffer=e,this._emit("var "+this.buffer+' = "";'),e},o._popBuffer=function(){this.buffer=this.bufferStack.pop()},o._emit=function(e){this.codebuf.push(e)},o._emitLine=function(e){this._emit(e+"\n")},o._emitLines=function(){for(var e=this,t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];i.forEach((function(t){return e._emitLine(t)}))},o._emitFuncBegin=function(e,t){this.buffer="output",this._scopeClosers="",this._emitLine("function "+t+"(env, context, frame, runtime, cb) {"),this._emitLine("var lineno = "+e.lineno+";"),this._emitLine("var colno = "+e.colno+";"),this._emitLine("var "+this.buffer+' = "";'),this._emitLine("try {")},o._emitFuncEnd=function(e){e||this._emitLine("cb(null, "+this.buffer+");"),this._closeScopeLevels(),this._emitLine("} catch (e) {"),this._emitLine("  cb(runtime.handleError(e, lineno, colno));"),this._emitLine("}"),this._emitLine("}"),this.buffer=null},o._addScopeLevel=function(){this._scopeClosers+="})"},o._closeScopeLevels=function(){this._emitLine(this._scopeClosers+";"),this._scopeClosers=""},o._withScopedSyntax=function(e){var t=this._scopeClosers;this._scopeClosers="",e.call(this),this._closeScopeLevels(),this._scopeClosers=t},o._makeCallback=function(e){var t=this._tmpid();return"function("+t+(e?","+e:"")+") {\nif("+t+") { cb("+t+"); return; }"},o._tmpid=function(){return this.lastId++,"t_"+this.lastId},o._templateName=function(){return null==this.templateName?"undefined":JSON.stringify(this.templateName)},o._compileChildren=function(e,t){var i=this;e.children.forEach((function(e){i.compile(e,t)}))},o._compileAggregate=function(e,t,i,n){var r=this;i&&this._emit(i),e.children.forEach((function(e,i){i>0&&r._emit(","),r.compile(e,t)})),n&&this._emit(n)},o._compileExpression=function(e,t){this.assertType(e,s.Literal,s.Symbol,s.Group,s.Array,s.Dict,s.FunCall,s.Caller,s.Filter,s.LookupVal,s.Compare,s.InlineIf,s.In,s.Is,s.And,s.Or,s.Not,s.Add,s.Concat,s.Sub,s.Mul,s.Div,s.FloorDiv,s.Mod,s.Pow,s.Neg,s.Pos,s.Compare,s.NodeList),this.compile(e,t)},o.assertType=function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];i.some((function(t){return e instanceof t}))||this.fail("assertType: invalid type: "+e.typename,e.lineno,e.colno)},o.compileCallExtension=function(e,t,i){var n=this,r=e.args,o=e.contentArgs,a="boolean"!=typeof e.autoescape||e.autoescape;if(i||this._emit(this.buffer+" += runtime.suppressValue("),this._emit('env.getExtension("'+e.extName+'")["'+e.prop+'"]('),this._emit("context"),(r||o)&&this._emit(","),r&&(r instanceof s.NodeList||this.fail("compileCallExtension: arguments must be a NodeList, use `parser.parseSignature`"),r.children.forEach((function(e,i){n._compileExpression(e,t),(i!==r.children.length-1||o.length)&&n._emit(",")}))),o.length&&o.forEach((function(e,i){if(i>0&&n._emit(","),e){n._emitLine("function(cb) {"),n._emitLine("if(!cb) { cb = function(err) { if(err) { throw err; }}}");var r=n._pushBuffer();n._withScopedSyntax((function(){n.compile(e,t),n._emitLine("cb(null, "+r+");")})),n._popBuffer(),n._emitLine("return "+r+";"),n._emitLine("}")}else n._emit("null")})),i){var l=this._tmpid();this._emitLine(", "+this._makeCallback(l)),this._emitLine(this.buffer+" += runtime.suppressValue("+l+", "+a+" && env.opts.autoescape);"),this._addScopeLevel()}else this._emit(")"),this._emit(", "+a+" && env.opts.autoescape);\n")},o.compileCallExtensionAsync=function(e,t){this.compileCallExtension(e,t,!0)},o.compileNodeList=function(e,t){this._compileChildren(e,t)},o.compileLiteral=function(e){if("string"==typeof e.value){var t=e.value.replace(/\\/g,"\\\\");t=(t=(t=(t=(t=t.replace(/"/g,'\\"')).replace(/\n/g,"\\n")).replace(/\r/g,"\\r")).replace(/\t/g,"\\t")).replace(/\u2028/g,"\\u2028"),this._emit('"'+t+'"')}else null===e.value?this._emit("null"):this._emit(e.value.toString())},o.compileSymbol=function(e,t){var i=e.value,n=t.lookup(i);n?this._emit(n):this._emit('runtime.contextOrFrameLookup(context, frame, "'+i+'")')},o.compileGroup=function(e,t){this._compileAggregate(e,t,"(",")")},o.compileArray=function(e,t){this._compileAggregate(e,t,"[","]")},o.compileDict=function(e,t){this._compileAggregate(e,t,"{","}")},o.compilePair=function(e,t){var i=e.key,n=e.value;i instanceof s.Symbol?i=new s.Literal(i.lineno,i.colno,i.value):i instanceof s.Literal&&"string"==typeof i.value||this.fail("compilePair: Dict keys must be strings or names",i.lineno,i.colno),this.compile(i,t),this._emit(": "),this._compileExpression(n,t)},o.compileInlineIf=function(e,t){this._emit("("),this.compile(e.cond,t),this._emit("?"),this.compile(e.body,t),this._emit(":"),null!==e.else_?this.compile(e.else_,t):this._emit('""'),this._emit(")")},o.compileIn=function(e,t){this._emit("runtime.inOperator("),this.compile(e.left,t),this._emit(","),this.compile(e.right,t),this._emit(")")},o.compileIs=function(e,t){var i=e.right.name?e.right.name.value:e.right.value;this._emit('env.getTest("'+i+'").call(context, '),this.compile(e.left,t),e.right.args&&(this._emit(","),this.compile(e.right.args,t)),this._emit(") === true")},o._binOpEmitter=function(e,t,i){this.compile(e.left,t),this._emit(i),this.compile(e.right,t)},o.compileOr=function(e,t){return this._binOpEmitter(e,t," || ")},o.compileAnd=function(e,t){return this._binOpEmitter(e,t," && ")},o.compileAdd=function(e,t){return this._binOpEmitter(e,t," + ")},o.compileConcat=function(e,t){return this._binOpEmitter(e,t,' + "" + ')},o.compileSub=function(e,t){return this._binOpEmitter(e,t," - ")},o.compileMul=function(e,t){return this._binOpEmitter(e,t," * ")},o.compileDiv=function(e,t){return this._binOpEmitter(e,t," / ")},o.compileMod=function(e,t){return this._binOpEmitter(e,t," % ")},o.compileNot=function(e,t){this._emit("!"),this.compile(e.target,t)},o.compileFloorDiv=function(e,t){this._emit("Math.floor("),this.compile(e.left,t),this._emit(" / "),this.compile(e.right,t),this._emit(")")},o.compilePow=function(e,t){this._emit("Math.pow("),this.compile(e.left,t),this._emit(", "),this.compile(e.right,t),this._emit(")")},o.compileNeg=function(e,t){this._emit("-"),this.compile(e.target,t)},o.compilePos=function(e,t){this._emit("+"),this.compile(e.target,t)},o.compileCompare=function(e,t){var i=this;this.compile(e.expr,t),e.ops.forEach((function(e){i._emit(" "+h[e.type]+" "),i.compile(e.expr,t)}))},o.compileLookupVal=function(e,t){this._emit("runtime.memberLookup(("),this._compileExpression(e.target,t),this._emit("),"),this._compileExpression(e.val,t),this._emit(")")},o._getNodeName=function(e){switch(e.typename){case"Symbol":return e.value;case"FunCall":return"the return value of ("+this._getNodeName(e.name)+")";case"LookupVal":return this._getNodeName(e.target)+'["'+this._getNodeName(e.val)+'"]';case"Literal":return e.value.toString();default:return"--expression--"}},o.compileFunCall=function(e,t){this._emit("(lineno = "+e.lineno+", colno = "+e.colno+", "),this._emit("runtime.callWrap("),this._compileExpression(e.name,t),this._emit(', "'+this._getNodeName(e.name).replace(/"/g,'\\"')+'", context, '),this._compileAggregate(e.args,t,"[","])"),this._emit(")")},o.compileFilter=function(e,t){var i=e.name;this.assertType(i,s.Symbol),this._emit('env.getFilter("'+i.value+'").call(context, '),this._compileAggregate(e.args,t),this._emit(")")},o.compileFilterAsync=function(e,t){var i=e.name,n=e.symbol.value;this.assertType(i,s.Symbol),t.set(n,n),this._emit('env.getFilter("'+i.value+'").call(context, '),this._compileAggregate(e.args,t),this._emitLine(", "+this._makeCallback(n)),this._addScopeLevel()},o.compileKeywordArgs=function(e,t){this._emit("runtime.makeKeywordArgs("),this.compileDict(e,t),this._emit(")")},o.compileSet=function(e,t){var i=this,n=[];e.targets.forEach((function(e){var r=e.value,o=t.lookup(r);null==o&&(o=i._tmpid(),i._emitLine("var "+o+";")),n.push(o)})),e.value?(this._emit(n.join(" = ")+" = "),this._compileExpression(e.value,t),this._emitLine(";")):(this._emit(n.join(" = ")+" = "),this.compile(e.body,t),this._emitLine(";")),e.targets.forEach((function(e,t){var r=n[t],o=e.value;i._emitLine('frame.set("'+o+'", '+r+", true);"),i._emitLine("if(frame.topLevel) {"),i._emitLine('context.setVariable("'+o+'", '+r+");"),i._emitLine("}"),"_"!==o.charAt(0)&&(i._emitLine("if(frame.topLevel) {"),i._emitLine('context.addExport("'+o+'", '+r+");"),i._emitLine("}"))}))},o.compileSwitch=function(e,t){var i=this;this._emit("switch ("),this.compile(e.expr,t),this._emit(") {"),e.cases.forEach((function(e,n){i._emit("case "),i.compile(e.cond,t),i._emit(": "),i.compile(e.body,t),e.body.children.length&&i._emitLine("break;")})),e.default&&(this._emit("default:"),this.compile(e.default,t)),this._emit("}")},o.compileIf=function(e,t,i){var n=this;this._emit("if("),this._compileExpression(e.cond,t),this._emitLine(") {"),this._withScopedSyntax((function(){n.compile(e.body,t),i&&n._emit("cb()")})),e.else_?(this._emitLine("}\nelse {"),this._withScopedSyntax((function(){n.compile(e.else_,t),i&&n._emit("cb()")}))):i&&(this._emitLine("}\nelse {"),this._emit("cb()")),this._emitLine("}")},o.compileIfAsync=function(e,t){this._emit("(function(cb) {"),this.compileIf(e,t,!0),this._emit("})("+this._makeCallback()),this._addScopeLevel()},o._emitLoopBindings=function(e,t,i,n){var r=this;[{name:"index",val:i+" + 1"},{name:"index0",val:i},{name:"revindex",val:n+" - "+i},{name:"revindex0",val:n+" - "+i+" - 1"},{name:"first",val:i+" === 0"},{name:"last",val:i+" === "+n+" - 1"},{name:"length",val:n}].forEach((function(e){r._emitLine('frame.set("loop.'+e.name+'", '+e.val+");")}))},o.compileFor=function(e,t){var i=this,n=this._tmpid(),r=this._tmpid(),o=this._tmpid();if(t=t.push(),this._emitLine("frame = frame.push();"),this._emit("var "+o+" = "),this._compileExpression(e.arr,t),this._emitLine(";"),this._emit("if("+o+") {"),this._emitLine(o+" = runtime.fromIterator("+o+");"),e.name instanceof s.Array){this._emitLine("var "+n+";"),this._emitLine("if(runtime.isArray("+o+")) {"),this._emitLine("var "+r+" = "+o+".length;"),this._emitLine("for("+n+"=0; "+n+" < "+o+".length; "+n+"++) {"),e.name.children.forEach((function(r,s){var a=i._tmpid();i._emitLine("var "+a+" = "+o+"["+n+"]["+s+"];"),i._emitLine('frame.set("'+r+'", '+o+"["+n+"]["+s+"]);"),t.set(e.name.children[s].value,a)})),this._emitLoopBindings(e,o,n,r),this._withScopedSyntax((function(){i.compile(e.body,t)})),this._emitLine("}"),this._emitLine("} else {");var a=e.name.children,l=a[0],c=a[1],h=this._tmpid(),u=this._tmpid();t.set(l.value,h),t.set(c.value,u),this._emitLine(n+" = -1;"),this._emitLine("var "+r+" = runtime.keys("+o+").length;"),this._emitLine("for(var "+h+" in "+o+") {"),this._emitLine(n+"++;"),this._emitLine("var "+u+" = "+o+"["+h+"];"),this._emitLine('frame.set("'+l.value+'", '+h+");"),this._emitLine('frame.set("'+c.value+'", '+u+");"),this._emitLoopBindings(e,o,n,r),this._withScopedSyntax((function(){i.compile(e.body,t)})),this._emitLine("}"),this._emitLine("}")}else{var d=this._tmpid();t.set(e.name.value,d),this._emitLine("var "+r+" = "+o+".length;"),this._emitLine("for(var "+n+"=0; "+n+" < "+o+".length; "+n+"++) {"),this._emitLine("var "+d+" = "+o+"["+n+"];"),this._emitLine('frame.set("'+e.name.value+'", '+d+");"),this._emitLoopBindings(e,o,n,r),this._withScopedSyntax((function(){i.compile(e.body,t)})),this._emitLine("}")}this._emitLine("}"),e.else_&&(this._emitLine("if (!"+r+") {"),this.compile(e.else_,t),this._emitLine("}")),this._emitLine("frame = frame.pop();")},o._compileAsyncLoop=function(e,t,i){var n=this,r=this._tmpid(),o=this._tmpid(),a=this._tmpid(),l=i?"asyncAll":"asyncEach";if(t=t.push(),this._emitLine("frame = frame.push();"),this._emit("var "+a+" = runtime.fromIterator("),this._compileExpression(e.arr,t),this._emitLine(");"),e.name instanceof s.Array){var c=e.name.children.length;this._emit("runtime."+l+"("+a+", "+c+", function("),e.name.children.forEach((function(e){n._emit(e.value+",")})),this._emit(r+","+o+",next) {"),e.name.children.forEach((function(e){var i=e.value;t.set(i,i),n._emitLine('frame.set("'+i+'", '+i+");")}))}else{var h=e.name.value;this._emitLine("runtime."+l+"("+a+", 1, function("+h+", "+r+", "+o+",next) {"),this._emitLine('frame.set("'+h+'", '+h+");"),t.set(h,h)}this._emitLoopBindings(e,a,r,o),this._withScopedSyntax((function(){var o;i&&(o=n._pushBuffer()),n.compile(e.body,t),n._emitLine("next("+r+(o?","+o:"")+");"),i&&n._popBuffer()}));var u=this._tmpid();this._emitLine("}, "+this._makeCallback(u)),this._addScopeLevel(),i&&this._emitLine(this.buffer+" += "+u+";"),e.else_&&(this._emitLine("if (!"+a+".length) {"),this.compile(e.else_,t),this._emitLine("}")),this._emitLine("frame = frame.pop();")},o.compileAsyncEach=function(e,t){this._compileAsyncLoop(e,t)},o.compileAsyncAll=function(e,t){this._compileAsyncLoop(e,t,!0)},o._compileMacro=function(e,t){var i=this,n=[],r=null,o="macro_"+this._tmpid(),a=void 0!==t;e.args.children.forEach((function(t,o){o===e.args.children.length-1&&t instanceof s.Dict?r=t:(i.assertType(t,s.Symbol),n.push(t))}));var c,h=[].concat(n.map((function(e){return"l_"+e.value})),["kwargs"]),u=n.map((function(e){return'"'+e.value+'"'})),d=(r&&r.children||[]).map((function(e){return'"'+e.key.value+'"'}));c=a?t.push(!0):new l,this._emitLines("var "+o+" = runtime.makeMacro(","["+u.join(", ")+"], ","["+d.join(", ")+"], ","function ("+h.join(", ")+") {","var callerFrame = frame;","frame = "+(a?"frame.push(true);":"new runtime.Frame();"),"kwargs = kwargs || {};",'if (Object.prototype.hasOwnProperty.call(kwargs, "caller")) {','frame.set("caller", kwargs.caller); }'),n.forEach((function(e){i._emitLine('frame.set("'+e.value+'", l_'+e.value+");"),c.set(e.value,"l_"+e.value)})),r&&r.children.forEach((function(e){var t=e.key.value;i._emit('frame.set("'+t+'", '),i._emit('Object.prototype.hasOwnProperty.call(kwargs, "'+t+'")'),i._emit(' ? kwargs["'+t+'"] : '),i._compileExpression(e.value,c),i._emit(");")}));var p=this._pushBuffer();return this._withScopedSyntax((function(){i.compile(e.body,c)})),this._emitLine("frame = "+(a?"frame.pop();":"callerFrame;")),this._emitLine("return new runtime.SafeString("+p+");"),this._emitLine("});"),this._popBuffer(),o},o.compileMacro=function(e,t){var i=this._compileMacro(e),n=e.name.value;t.set(n,i),t.parent?this._emitLine('frame.set("'+n+'", '+i+");"):("_"!==e.name.value.charAt(0)&&this._emitLine('context.addExport("'+n+'");'),this._emitLine('context.setVariable("'+n+'", '+i+");"))},o.compileCaller=function(e,t){this._emit("(function (){");var i=this._compileMacro(e,t);this._emit("return "+i+";})()")},o._compileGetTemplate=function(e,t,i,n){var r=this._tmpid(),o=this._templateName(),s=this._makeCallback(r),a=i?"true":"false",l=n?"true":"false";return this._emit("env.getTemplate("),this._compileExpression(e.template,t),this._emitLine(", "+a+", "+o+", "+l+", "+s),r},o.compileImport=function(e,t){var i=e.target.value,n=this._compileGetTemplate(e,t,!1,!1);this._addScopeLevel(),this._emitLine(n+".getExported("+(e.withContext?"context.getVariables(), frame, ":"")+this._makeCallback(n)),this._addScopeLevel(),t.set(i,n),t.parent?this._emitLine('frame.set("'+i+'", '+n+");"):this._emitLine('context.setVariable("'+i+'", '+n+");")},o.compileFromImport=function(e,t){var i=this,n=this._compileGetTemplate(e,t,!1,!1);this._addScopeLevel(),this._emitLine(n+".getExported("+(e.withContext?"context.getVariables(), frame, ":"")+this._makeCallback(n)),this._addScopeLevel(),e.names.children.forEach((function(e){var r,o,a=i._tmpid();e instanceof s.Pair?(r=e.key.value,o=e.value.value):o=r=e.value,i._emitLine("if(Object.prototype.hasOwnProperty.call("+n+', "'+r+'")) {'),i._emitLine("var "+a+" = "+n+"."+r+";"),i._emitLine("} else {"),i._emitLine("cb(new Error(\"cannot import '"+r+"'\")); return;"),i._emitLine("}"),t.set(o,a),t.parent?i._emitLine('frame.set("'+o+'", '+a+");"):i._emitLine('context.setVariable("'+o+'", '+a+");")}))},o.compileBlock=function(e){var t=this._tmpid();this.inBlock||this._emit('(parentTemplate ? function(e, c, f, r, cb) { cb(""); } : '),this._emit('context.getBlock("'+e.name.value+'")'),this.inBlock||this._emit(")"),this._emitLine("(env, context, frame, runtime, "+this._makeCallback(t)),this._emitLine(this.buffer+" += "+t+";"),this._addScopeLevel()},o.compileSuper=function(e,t){var i=e.blockName.value,n=e.symbol.value,r=this._makeCallback(n);this._emitLine('context.getSuper(env, "'+i+'", b_'+i+", frame, runtime, "+r),this._emitLine(n+" = runtime.markSafe("+n+");"),this._addScopeLevel(),t.set(n,n)},o.compileExtends=function(e,t){var i=this._tmpid(),n=this._compileGetTemplate(e,t,!0,!1);this._emitLine("parentTemplate = "+n),this._emitLine("for(var "+i+" in parentTemplate.blocks) {"),this._emitLine("context.addBlock("+i+", parentTemplate.blocks["+i+"]);"),this._emitLine("}"),this._addScopeLevel()},o.compileInclude=function(e,t){this._emitLine("var tasks = [];"),this._emitLine("tasks.push("),this._emitLine("function(callback) {");var i=this._compileGetTemplate(e,t,!1,e.ignoreMissing);this._emitLine("callback(null,"+i+");});"),this._emitLine("});");var n=this._tmpid();this._emitLine("tasks.push("),this._emitLine("function(template, callback){"),this._emitLine("template.render(context.getVariables(), frame, "+this._makeCallback(n)),this._emitLine("callback(null,"+n+");});"),this._emitLine("});"),this._emitLine("tasks.push("),this._emitLine("function(result, callback){"),this._emitLine(this.buffer+" += result;"),this._emitLine("callback(null);"),this._emitLine("});"),this._emitLine("env.waterfall(tasks, function(){"),this._addScopeLevel()},o.compileTemplateData=function(e,t){this.compileLiteral(e,t)},o.compileCapture=function(e,t){var i=this,n=this.buffer;this.buffer="output",this._emitLine("(function() {"),this._emitLine('var output = "";'),this._withScopedSyntax((function(){i.compile(e.body,t)})),this._emitLine("return output;"),this._emitLine("})()"),this.buffer=n},o.compileOutput=function(e,t){var i=this;e.children.forEach((function(n){n instanceof s.TemplateData?n.value&&(i._emit(i.buffer+" += "),i.compileLiteral(n,t),i._emitLine(";")):(i._emit(i.buffer+" += runtime.suppressValue("),i.throwOnUndefined&&i._emit("runtime.ensureDefined("),i.compile(n,t),i.throwOnUndefined&&i._emit(","+e.lineno+","+e.colno+")"),i._emit(", env.opts.autoescape);\n"))}))},o.compileRoot=function(e,t){var i=this;t&&this.fail("compileRoot: root node can't have frame"),t=new l,this._emitFuncBegin(e,"root"),this._emitLine("var parentTemplate = null;"),this._compileChildren(e,t),this._emitLine("if(parentTemplate) {"),this._emitLine("parentTemplate.rootRenderFunc(env, context, frame, runtime, cb);"),this._emitLine("} else {"),this._emitLine("cb(null, "+this.buffer+");"),this._emitLine("}"),this._emitFuncEnd(!0),this.inBlock=!0;var n=[],r=e.findAll(s.Block);r.forEach((function(e,t){var r=e.name.value;if(-1!==n.indexOf(r))throw new Error('Block "'+r+'" defined more than once.');n.push(r),i._emitFuncBegin(e,"b_"+r);var o=new l;i._emitLine("var frame = frame.push(true);"),i.compile(e.body,o),i._emitFuncEnd()})),this._emitLine("return {"),r.forEach((function(e,t){var n="b_"+e.name.value;i._emitLine(n+": "+n+",")})),this._emitLine("root: root\n};")},o.compile=function(e,t){var i=this["compile"+e.typename];i?i.call(this,e,t):this.fail("compile: Cannot compile node: "+e.typename,e.lineno,e.colno)},o.getCode=function(){return this.codebuf.join("")},r}(c);e.exports={compile:function(e,t,i,n,s){void 0===s&&(s={});var a=new u(n,s.throwOnUndefined),l=(i||[]).map((function(e){return e.preprocess})).filter((function(e){return!!e})).reduce((function(e,t){return t(e)}),e);return a.compile(o.transform(r.parse(l,i,s),t,n)),a.getCode()},Compiler:u}},function(e,t,i){"use strict";function n(e,t){return n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(e,t)}var r=i(4),o=i(1).EmitterObj;e.exports=function(e){var t,i;function o(){return e.apply(this,arguments)||this}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,n(t,i);var s=o.prototype;return s.resolve=function(e,t){return r.resolve(r.dirname(e),t)},s.isRelative=function(e){return 0===e.indexOf("./")||0===e.indexOf("../")},o}(o)},function(e,t,i){"use strict";function n(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,r(e,t)}function r(e,t){return r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},r(e,t)}var o=i(12),s=i(15),a=i(0),l=i(5),c=i(18),h=i(10),u=h.FileSystemLoader,d=h.WebLoader,p=h.PrecompiledLoader,f=i(20),m=i(21),g=i(1),v=g.Obj,y=g.EmitterObj,b=i(2),E=b.handleError,x=b.Frame,w=i(22);function T(e,t,i){o((function(){e(t,i)}))}var k={type:"code",obj:{root:function(e,t,i,n,r){try{r(null,"")}catch(e){r(E(e,null,null))}}}},_=function(e){function t(){return e.apply(this,arguments)||this}n(t,e);var i=t.prototype;return i.init=function(e,t){var i=this;t=this.opts=t||{},this.opts.dev=!!t.dev,this.opts.autoescape=null==t.autoescape||t.autoescape,this.opts.throwOnUndefined=!!t.throwOnUndefined,this.opts.trimBlocks=!!t.trimBlocks,this.opts.lstripBlocks=!!t.lstripBlocks,this.loaders=[],e?this.loaders=a.isArray(e)?e:[e]:u?this.loaders=[new u("views")]:d&&(this.loaders=[new d("/views")]),"undefined"!=typeof window&&window.nunjucksPrecompiled&&this.loaders.unshift(new p(window.nunjucksPrecompiled)),this._initLoaders(),this.globals=m(),this.filters={},this.tests={},this.asyncFilters=[],this.extensions={},this.extensionsList=[],a._entries(c).forEach((function(e){var t=e[0],n=e[1];return i.addFilter(t,n)})),a._entries(f).forEach((function(e){var t=e[0],n=e[1];return i.addTest(t,n)}))},i._initLoaders=function(){var e=this;this.loaders.forEach((function(t){t.cache={},"function"==typeof t.on&&(t.on("update",(function(i,n){t.cache[i]=null,e.emit("update",i,n,t)})),t.on("load",(function(i,n){e.emit("load",i,n,t)})))}))},i.invalidateCache=function(){this.loaders.forEach((function(e){e.cache={}}))},i.addExtension=function(e,t){return t.__name=e,this.extensions[e]=t,this.extensionsList.push(t),this},i.removeExtension=function(e){var t=this.getExtension(e);t&&(this.extensionsList=a.without(this.extensionsList,t),delete this.extensions[e])},i.getExtension=function(e){return this.extensions[e]},i.hasExtension=function(e){return!!this.extensions[e]},i.addGlobal=function(e,t){return this.globals[e]=t,this},i.getGlobal=function(e){if(void 0===this.globals[e])throw new Error("global not found: "+e);return this.globals[e]},i.addFilter=function(e,t,i){var n=t;return i&&this.asyncFilters.push(e),this.filters[e]=n,this},i.getFilter=function(e){if(!this.filters[e])throw new Error("filter not found: "+e);return this.filters[e]},i.addTest=function(e,t){return this.tests[e]=t,this},i.getTest=function(e){if(!this.tests[e])throw new Error("test not found: "+e);return this.tests[e]},i.resolveTemplate=function(e,t,i){return e.isRelative&&t&&e.isRelative(i)&&e.resolve?e.resolve(t,i):i},i.getTemplate=function(e,t,i,n,r){var o,s=this,l=this,c=null;if(e&&e.raw&&(e=e.raw),a.isFunction(i)&&(r=i,i=null,t=t||!1),a.isFunction(t)&&(r=t,t=!1),e instanceof C)c=e;else{if("string"!=typeof e)throw new Error("template names must be a string: "+e);for(var h=0;h<this.loaders.length;h++){var u=this.loaders[h];if(c=u.cache[this.resolveTemplate(u,i,e)])break}}return c?(t&&c.compile(),r?void r(null,c):c):(a.asyncIter(this.loaders,(function(t,n,r,o){function s(e,i){e?o(e):i?(i.loader=t,o(null,i)):r()}e=l.resolveTemplate(t,i,e),t.async?t.getSource(e,s):s(null,t.getSource(e))}),(function(i,a){if(a||i||n||(i=new Error("template not found: "+e)),i){if(r)return void r(i);throw i}var l;a?(l=new C(a.src,s,a.path,t),a.noCache||(a.loader.cache[e]=l)):l=new C(k,s,"",t),r?r(null,l):o=l})),o)},i.express=function(e){return w(this,e)},i.render=function(e,t,i){a.isFunction(t)&&(i=t,t=null);var n=null;return this.getTemplate(e,(function(e,r){if(e&&i)T(i,e);else{if(e)throw e;n=r.render(t,i)}})),n},i.renderString=function(e,t,i,n){return a.isFunction(i)&&(n=i,i={}),new C(e,this,(i=i||{}).path).render(t,n)},i.waterfall=function(e,t,i){return s(e,t,i)},t}(y),A=function(e){function t(){return e.apply(this,arguments)||this}n(t,e);var i=t.prototype;return i.init=function(e,t,i){var n=this;this.env=i||new _,this.ctx=a.extend({},e),this.blocks={},this.exported=[],a.keys(t).forEach((function(e){n.addBlock(e,t[e])}))},i.lookup=function(e){return e in this.env.globals&&!(e in this.ctx)?this.env.globals[e]:this.ctx[e]},i.setVariable=function(e,t){this.ctx[e]=t},i.getVariables=function(){return this.ctx},i.addBlock=function(e,t){return this.blocks[e]=this.blocks[e]||[],this.blocks[e].push(t),this},i.getBlock=function(e){if(!this.blocks[e])throw new Error('unknown block "'+e+'"');return this.blocks[e][0]},i.getSuper=function(e,t,i,n,r,o){var s=a.indexOf(this.blocks[t]||[],i),l=this.blocks[t][s+1];if(-1===s||!l)throw new Error('no super block available for "'+t+'"');l(e,this,n,r,o)},i.addExport=function(e){this.exported.push(e)},i.getExported=function(){var e=this,t={};return this.exported.forEach((function(i){t[i]=e.ctx[i]})),t},t}(v),C=function(e){function t(){return e.apply(this,arguments)||this}n(t,e);var i=t.prototype;return i.init=function(e,t,i,n){if(this.env=t||new _,a.isObject(e))switch(e.type){case"code":this.tmplProps=e.obj;break;case"string":this.tmplStr=e.obj;break;default:throw new Error("Unexpected template object type "+e.type+"; expected 'code', or 'string'")}else{if(!a.isString(e))throw new Error("src must be a string or an object describing the source");this.tmplStr=e}if(this.path=i,n)try{this._compile()}catch(e){throw a._prettifyError(this.path,this.env.opts.dev,e)}else this.compiled=!1},i.render=function(e,t,i){var n=this;"function"==typeof e?(i=e,e={}):"function"==typeof t&&(i=t,t=null);var r=!t;try{this.compile()}catch(e){var o=a._prettifyError(this.path,this.env.opts.dev,e);if(i)return T(i,o);throw o}var s=new A(e||{},this.blocks,this.env),l=t?t.push(!0):new x;l.topLevel=!0;var c=null,h=!1;return this.rootRenderFunc(this.env,s,l,b,(function(e,t){if(!h||!i||void 0===t)if(e&&(e=a._prettifyError(n.path,n.env.opts.dev,e),h=!0),i)r?T(i,e,t):i(e,t);else{if(e)throw e;c=t}})),c},i.getExported=function(e,t,i){"function"==typeof e&&(i=e,e={}),"function"==typeof t&&(i=t,t=null);try{this.compile()}catch(e){if(i)return i(e);throw e}var n=t?t.push():new x;n.topLevel=!0;var r=new A(e||{},this.blocks,this.env);this.rootRenderFunc(this.env,r,n,b,(function(e){e?i(e,null):i(null,r.getExported())}))},i.compile=function(){this.compiled||this._compile()},i._compile=function(){var e;if(this.tmplProps)e=this.tmplProps;else{var t=l.compile(this.tmplStr,this.env.asyncFilters,this.env.extensionsList,this.path,this.env.opts);e=new Function(t)()}this.blocks=this._getBlocks(e),this.rootRenderFunc=e.root,this.compiled=!0},i._getBlocks=function(e){var t={};return a.keys(e).forEach((function(i){"b_"===i.slice(0,2)&&(t[i.slice(2)]=e[i])})),t},t}(v);e.exports={Environment:_,Template:C}},function(e,t,i){"use strict";function n(e,t){return n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(e,t)}var r=i(9),o=i(3),s=i(1).Obj,a=i(0),l=function(e){var t,i;function s(){return e.apply(this,arguments)||this}i=e,(t=s).prototype=Object.create(i.prototype),t.prototype.constructor=t,n(t,i);var l=s.prototype;return l.init=function(e){this.tokens=e,this.peeked=null,this.breakOnBlocks=null,this.dropLeadingWhitespace=!1,this.extensions=[]},l.nextToken=function(e){var t;if(this.peeked){if(e||this.peeked.type!==r.TOKEN_WHITESPACE)return t=this.peeked,this.peeked=null,t;this.peeked=null}if(t=this.tokens.nextToken(),!e)for(;t&&t.type===r.TOKEN_WHITESPACE;)t=this.tokens.nextToken();return t},l.peekToken=function(){return this.peeked=this.peeked||this.nextToken(),this.peeked},l.pushToken=function(e){if(this.peeked)throw new Error("pushToken: can only push one token on between reads");this.peeked=e},l.error=function(e,t,i){if(void 0===t||void 0===i){var n=this.peekToken()||{};t=n.lineno,i=n.colno}return void 0!==t&&(t+=1),void 0!==i&&(i+=1),new a.TemplateError(e,t,i)},l.fail=function(e,t,i){throw this.error(e,t,i)},l.skip=function(e){var t=this.nextToken();return!(!t||t.type!==e)||(this.pushToken(t),!1)},l.expect=function(e){var t=this.nextToken();return t.type!==e&&this.fail("expected "+e+", got "+t.type,t.lineno,t.colno),t},l.skipValue=function(e,t){var i=this.nextToken();return!(!i||i.type!==e||i.value!==t)||(this.pushToken(i),!1)},l.skipSymbol=function(e){return this.skipValue(r.TOKEN_SYMBOL,e)},l.advanceAfterBlockEnd=function(e){var t;return e||((t=this.peekToken())||this.fail("unexpected end of file"),t.type!==r.TOKEN_SYMBOL&&this.fail("advanceAfterBlockEnd: expected symbol token or explicit name to be passed"),e=this.nextToken().value),(t=this.nextToken())&&t.type===r.TOKEN_BLOCK_END?"-"===t.value.charAt(0)&&(this.dropLeadingWhitespace=!0):this.fail("expected block end in "+e+" statement"),t},l.advanceAfterVariableEnd=function(){var e=this.nextToken();e&&e.type===r.TOKEN_VARIABLE_END?this.dropLeadingWhitespace="-"===e.value.charAt(e.value.length-this.tokens.tags.VARIABLE_END.length-1):(this.pushToken(e),this.fail("expected variable end"))},l.parseFor=function(){var e,t,i=this.peekToken();if(this.skipSymbol("for")?(e=new o.For(i.lineno,i.colno),t="endfor"):this.skipSymbol("asyncEach")?(e=new o.AsyncEach(i.lineno,i.colno),t="endeach"):this.skipSymbol("asyncAll")?(e=new o.AsyncAll(i.lineno,i.colno),t="endall"):this.fail("parseFor: expected for{Async}",i.lineno,i.colno),e.name=this.parsePrimary(),e.name instanceof o.Symbol||this.fail("parseFor: variable name expected for loop"),this.peekToken().type===r.TOKEN_COMMA){var n=e.name;for(e.name=new o.Array(n.lineno,n.colno),e.name.addChild(n);this.skip(r.TOKEN_COMMA);){var s=this.parsePrimary();e.name.addChild(s)}}return this.skipSymbol("in")||this.fail('parseFor: expected "in" keyword for loop',i.lineno,i.colno),e.arr=this.parseExpression(),this.advanceAfterBlockEnd(i.value),e.body=this.parseUntilBlocks(t,"else"),this.skipSymbol("else")&&(this.advanceAfterBlockEnd("else"),e.else_=this.parseUntilBlocks(t)),this.advanceAfterBlockEnd(),e},l.parseMacro=function(){var e=this.peekToken();this.skipSymbol("macro")||this.fail("expected macro");var t=this.parsePrimary(!0),i=this.parseSignature(),n=new o.Macro(e.lineno,e.colno,t,i);return this.advanceAfterBlockEnd(e.value),n.body=this.parseUntilBlocks("endmacro"),this.advanceAfterBlockEnd(),n},l.parseCall=function(){var e=this.peekToken();this.skipSymbol("call")||this.fail("expected call");var t=this.parseSignature(!0)||new o.NodeList,i=this.parsePrimary();this.advanceAfterBlockEnd(e.value);var n=this.parseUntilBlocks("endcall");this.advanceAfterBlockEnd();var r=new o.Symbol(e.lineno,e.colno,"caller"),s=new o.Caller(e.lineno,e.colno,r,t,n),a=i.args.children;return a[a.length-1]instanceof o.KeywordArgs||a.push(new o.KeywordArgs),a[a.length-1].addChild(new o.Pair(e.lineno,e.colno,r,s)),new o.Output(e.lineno,e.colno,[i])},l.parseWithContext=function(){var e=this.peekToken(),t=null;return this.skipSymbol("with")?t=!0:this.skipSymbol("without")&&(t=!1),null!==t&&(this.skipSymbol("context")||this.fail("parseFrom: expected context after with/without",e.lineno,e.colno)),t},l.parseImport=function(){var e=this.peekToken();this.skipSymbol("import")||this.fail("parseImport: expected import",e.lineno,e.colno);var t=this.parseExpression();this.skipSymbol("as")||this.fail('parseImport: expected "as" keyword',e.lineno,e.colno);var i=this.parseExpression(),n=this.parseWithContext(),r=new o.Import(e.lineno,e.colno,t,i,n);return this.advanceAfterBlockEnd(e.value),r},l.parseFrom=function(){var e=this.peekToken();this.skipSymbol("from")||this.fail("parseFrom: expected from");var t=this.parseExpression();this.skipSymbol("import")||this.fail("parseFrom: expected import",e.lineno,e.colno);for(var i,n=new o.NodeList;;){var s=this.peekToken();if(s.type===r.TOKEN_BLOCK_END){n.children.length||this.fail("parseFrom: Expected at least one import name",e.lineno,e.colno),"-"===s.value.charAt(0)&&(this.dropLeadingWhitespace=!0),this.nextToken();break}n.children.length>0&&!this.skip(r.TOKEN_COMMA)&&this.fail("parseFrom: expected comma",e.lineno,e.colno);var a=this.parsePrimary();if("_"===a.value.charAt(0)&&this.fail("parseFrom: names starting with an underscore cannot be imported",a.lineno,a.colno),this.skipSymbol("as")){var l=this.parsePrimary();n.addChild(new o.Pair(a.lineno,a.colno,a,l))}else n.addChild(a);i=this.parseWithContext()}return new o.FromImport(e.lineno,e.colno,t,n,i)},l.parseBlock=function(){var e=this.peekToken();this.skipSymbol("block")||this.fail("parseBlock: expected block",e.lineno,e.colno);var t=new o.Block(e.lineno,e.colno);t.name=this.parsePrimary(),t.name instanceof o.Symbol||this.fail("parseBlock: variable name expected",e.lineno,e.colno),this.advanceAfterBlockEnd(e.value),t.body=this.parseUntilBlocks("endblock"),this.skipSymbol("endblock"),this.skipSymbol(t.name.value);var i=this.peekToken();return i||this.fail("parseBlock: expected endblock, got end of file"),this.advanceAfterBlockEnd(i.value),t},l.parseExtends=function(){var e=this.peekToken();this.skipSymbol("extends")||this.fail("parseTemplateRef: expected extends");var t=new o.Extends(e.lineno,e.colno);return t.template=this.parseExpression(),this.advanceAfterBlockEnd(e.value),t},l.parseInclude=function(){var e=this.peekToken();this.skipSymbol("include")||this.fail("parseInclude: expected include");var t=new o.Include(e.lineno,e.colno);return t.template=this.parseExpression(),this.skipSymbol("ignore")&&this.skipSymbol("missing")&&(t.ignoreMissing=!0),this.advanceAfterBlockEnd(e.value),t},l.parseIf=function(){var e,t=this.peekToken();this.skipSymbol("if")||this.skipSymbol("elif")||this.skipSymbol("elseif")?e=new o.If(t.lineno,t.colno):this.skipSymbol("ifAsync")?e=new o.IfAsync(t.lineno,t.colno):this.fail("parseIf: expected if, elif, or elseif",t.lineno,t.colno),e.cond=this.parseExpression(),this.advanceAfterBlockEnd(t.value),e.body=this.parseUntilBlocks("elif","elseif","else","endif");var i=this.peekToken();switch(i&&i.value){case"elseif":case"elif":e.else_=this.parseIf();break;case"else":this.advanceAfterBlockEnd(),e.else_=this.parseUntilBlocks("endif"),this.advanceAfterBlockEnd();break;case"endif":e.else_=null,this.advanceAfterBlockEnd();break;default:this.fail("parseIf: expected elif, else, or endif, got end of file")}return e},l.parseSet=function(){var e=this.peekToken();this.skipSymbol("set")||this.fail("parseSet: expected set",e.lineno,e.colno);for(var t,i=new o.Set(e.lineno,e.colno,[]);(t=this.parsePrimary())&&(i.targets.push(t),this.skip(r.TOKEN_COMMA)););return this.skipValue(r.TOKEN_OPERATOR,"=")?(i.value=this.parseExpression(),this.advanceAfterBlockEnd(e.value)):this.skip(r.TOKEN_BLOCK_END)?(i.body=new o.Capture(e.lineno,e.colno,this.parseUntilBlocks("endset")),i.value=null,this.advanceAfterBlockEnd()):this.fail("parseSet: expected = or block end in set tag",e.lineno,e.colno),i},l.parseSwitch=function(){var e="switch",t="endswitch",i="case",n="default",r=this.peekToken();this.skipSymbol(e)||this.skipSymbol(i)||this.skipSymbol(n)||this.fail('parseSwitch: expected "switch," "case" or "default"',r.lineno,r.colno);var s=this.parseExpression();this.advanceAfterBlockEnd(e),this.parseUntilBlocks(i,n,t);var a,l=this.peekToken(),c=[];do{this.skipSymbol(i);var h=this.parseExpression();this.advanceAfterBlockEnd(e);var u=this.parseUntilBlocks(i,n,t);c.push(new o.Case(l.line,l.col,h,u)),l=this.peekToken()}while(l&&l.value===i);switch(l.value){case n:this.advanceAfterBlockEnd(),a=this.parseUntilBlocks(t),this.advanceAfterBlockEnd();break;case t:this.advanceAfterBlockEnd();break;default:this.fail('parseSwitch: expected "case," "default" or "endswitch," got EOF.')}return new o.Switch(r.lineno,r.colno,s,c,a)},l.parseStatement=function(){var e=this.peekToken();if(e.type!==r.TOKEN_SYMBOL&&this.fail("tag name expected",e.lineno,e.colno),this.breakOnBlocks&&-1!==a.indexOf(this.breakOnBlocks,e.value))return null;switch(e.value){case"raw":return this.parseRaw();case"verbatim":return this.parseRaw("verbatim");case"if":case"ifAsync":return this.parseIf();case"for":case"asyncEach":case"asyncAll":return this.parseFor();case"block":return this.parseBlock();case"extends":return this.parseExtends();case"include":return this.parseInclude();case"set":return this.parseSet();case"macro":return this.parseMacro();case"call":return this.parseCall();case"import":return this.parseImport();case"from":return this.parseFrom();case"filter":return this.parseFilterStatement();case"switch":return this.parseSwitch();default:if(this.extensions.length)for(var t=0;t<this.extensions.length;t++){var i=this.extensions[t];if(-1!==a.indexOf(i.tags||[],e.value))return i.parse(this,o,r)}this.fail("unknown block tag: "+e.value,e.lineno,e.colno)}},l.parseRaw=function(e){for(var t="end"+(e=e||"raw"),i=new RegExp("([\\s\\S]*?){%\\s*("+e+"|"+t+")\\s*(?=%})%}"),n=1,r="",s=null,a=this.advanceAfterBlockEnd();(s=this.tokens._extractRegex(i))&&n>0;){var l=s[0],c=s[1],h=s[2];h===e?n+=1:h===t&&(n-=1),0===n?(r+=c,this.tokens.backN(l.length-c.length)):r+=l}return new o.Output(a.lineno,a.colno,[new o.TemplateData(a.lineno,a.colno,r)])},l.parsePostfix=function(e){for(var t,i=this.peekToken();i;){if(i.type===r.TOKEN_LEFT_PAREN)e=new o.FunCall(i.lineno,i.colno,e,this.parseSignature());else if(i.type===r.TOKEN_LEFT_BRACKET)(t=this.parseAggregate()).children.length>1&&this.fail("invalid index"),e=new o.LookupVal(i.lineno,i.colno,e,t.children[0]);else{if(i.type!==r.TOKEN_OPERATOR||"."!==i.value)break;this.nextToken();var n=this.nextToken();n.type!==r.TOKEN_SYMBOL&&this.fail("expected name as lookup value, got "+n.value,n.lineno,n.colno),t=new o.Literal(n.lineno,n.colno,n.value),e=new o.LookupVal(i.lineno,i.colno,e,t)}i=this.peekToken()}return e},l.parseExpression=function(){return this.parseInlineIf()},l.parseInlineIf=function(){var e=this.parseOr();if(this.skipSymbol("if")){var t=this.parseOr(),i=e;(e=new o.InlineIf(e.lineno,e.colno)).body=i,e.cond=t,this.skipSymbol("else")?e.else_=this.parseOr():e.else_=null}return e},l.parseOr=function(){for(var e=this.parseAnd();this.skipSymbol("or");){var t=this.parseAnd();e=new o.Or(e.lineno,e.colno,e,t)}return e},l.parseAnd=function(){for(var e=this.parseNot();this.skipSymbol("and");){var t=this.parseNot();e=new o.And(e.lineno,e.colno,e,t)}return e},l.parseNot=function(){var e=this.peekToken();return this.skipSymbol("not")?new o.Not(e.lineno,e.colno,this.parseNot()):this.parseIn()},l.parseIn=function(){for(var e=this.parseIs();;){var t=this.nextToken();if(!t)break;var i=t.type===r.TOKEN_SYMBOL&&"not"===t.value;if(i||this.pushToken(t),!this.skipSymbol("in")){i&&this.pushToken(t);break}var n=this.parseIs();e=new o.In(e.lineno,e.colno,e,n),i&&(e=new o.Not(e.lineno,e.colno,e))}return e},l.parseIs=function(){var e=this.parseCompare();if(this.skipSymbol("is")){var t=this.skipSymbol("not"),i=this.parseCompare();e=new o.Is(e.lineno,e.colno,e,i),t&&(e=new o.Not(e.lineno,e.colno,e))}return e},l.parseCompare=function(){for(var e=["==","===","!=","!==","<",">","<=",">="],t=this.parseConcat(),i=[];;){var n=this.nextToken();if(!n)break;if(-1===e.indexOf(n.value)){this.pushToken(n);break}i.push(new o.CompareOperand(n.lineno,n.colno,this.parseConcat(),n.value))}return i.length?new o.Compare(i[0].lineno,i[0].colno,t,i):t},l.parseConcat=function(){for(var e=this.parseAdd();this.skipValue(r.TOKEN_TILDE,"~");){var t=this.parseAdd();e=new o.Concat(e.lineno,e.colno,e,t)}return e},l.parseAdd=function(){for(var e=this.parseSub();this.skipValue(r.TOKEN_OPERATOR,"+");){var t=this.parseSub();e=new o.Add(e.lineno,e.colno,e,t)}return e},l.parseSub=function(){for(var e=this.parseMul();this.skipValue(r.TOKEN_OPERATOR,"-");){var t=this.parseMul();e=new o.Sub(e.lineno,e.colno,e,t)}return e},l.parseMul=function(){for(var e=this.parseDiv();this.skipValue(r.TOKEN_OPERATOR,"*");){var t=this.parseDiv();e=new o.Mul(e.lineno,e.colno,e,t)}return e},l.parseDiv=function(){for(var e=this.parseFloorDiv();this.skipValue(r.TOKEN_OPERATOR,"/");){var t=this.parseFloorDiv();e=new o.Div(e.lineno,e.colno,e,t)}return e},l.parseFloorDiv=function(){for(var e=this.parseMod();this.skipValue(r.TOKEN_OPERATOR,"//");){var t=this.parseMod();e=new o.FloorDiv(e.lineno,e.colno,e,t)}return e},l.parseMod=function(){for(var e=this.parsePow();this.skipValue(r.TOKEN_OPERATOR,"%");){var t=this.parsePow();e=new o.Mod(e.lineno,e.colno,e,t)}return e},l.parsePow=function(){for(var e=this.parseUnary();this.skipValue(r.TOKEN_OPERATOR,"**");){var t=this.parseUnary();e=new o.Pow(e.lineno,e.colno,e,t)}return e},l.parseUnary=function(e){var t,i=this.peekToken();return t=this.skipValue(r.TOKEN_OPERATOR,"-")?new o.Neg(i.lineno,i.colno,this.parseUnary(!0)):this.skipValue(r.TOKEN_OPERATOR,"+")?new o.Pos(i.lineno,i.colno,this.parseUnary(!0)):this.parsePrimary(),e||(t=this.parseFilter(t)),t},l.parsePrimary=function(e){var t,i=this.nextToken(),n=null;if(i?i.type===r.TOKEN_STRING?t=i.value:i.type===r.TOKEN_INT?t=parseInt(i.value,10):i.type===r.TOKEN_FLOAT?t=parseFloat(i.value):i.type===r.TOKEN_BOOLEAN?"true"===i.value?t=!0:"false"===i.value?t=!1:this.fail("invalid boolean: "+i.value,i.lineno,i.colno):i.type===r.TOKEN_NONE?t=null:i.type===r.TOKEN_REGEX&&(t=new RegExp(i.value.body,i.value.flags)):this.fail("expected expression, got end of file"),void 0!==t?n=new o.Literal(i.lineno,i.colno,t):i.type===r.TOKEN_SYMBOL?n=new o.Symbol(i.lineno,i.colno,i.value):(this.pushToken(i),n=this.parseAggregate()),e||(n=this.parsePostfix(n)),n)return n;throw this.error("unexpected token: "+i.value,i.lineno,i.colno)},l.parseFilterName=function(){for(var e=this.expect(r.TOKEN_SYMBOL),t=e.value;this.skipValue(r.TOKEN_OPERATOR,".");)t+="."+this.expect(r.TOKEN_SYMBOL).value;return new o.Symbol(e.lineno,e.colno,t)},l.parseFilterArgs=function(e){return this.peekToken().type===r.TOKEN_LEFT_PAREN?this.parsePostfix(e).args.children:[]},l.parseFilter=function(e){for(;this.skip(r.TOKEN_PIPE);){var t=this.parseFilterName();e=new o.Filter(t.lineno,t.colno,t,new o.NodeList(t.lineno,t.colno,[e].concat(this.parseFilterArgs(e))))}return e},l.parseFilterStatement=function(){var e=this.peekToken();this.skipSymbol("filter")||this.fail("parseFilterStatement: expected filter");var t=this.parseFilterName(),i=this.parseFilterArgs(t);this.advanceAfterBlockEnd(e.value);var n=new o.Capture(t.lineno,t.colno,this.parseUntilBlocks("endfilter"));this.advanceAfterBlockEnd();var r=new o.Filter(t.lineno,t.colno,t,new o.NodeList(t.lineno,t.colno,[n].concat(i)));return new o.Output(t.lineno,t.colno,[r])},l.parseAggregate=function(){var e,t=this.nextToken();switch(t.type){case r.TOKEN_LEFT_PAREN:e=new o.Group(t.lineno,t.colno);break;case r.TOKEN_LEFT_BRACKET:e=new o.Array(t.lineno,t.colno);break;case r.TOKEN_LEFT_CURLY:e=new o.Dict(t.lineno,t.colno);break;default:return null}for(;;){var i=this.peekToken().type;if(i===r.TOKEN_RIGHT_PAREN||i===r.TOKEN_RIGHT_BRACKET||i===r.TOKEN_RIGHT_CURLY){this.nextToken();break}if(e.children.length>0&&(this.skip(r.TOKEN_COMMA)||this.fail("parseAggregate: expected comma after expression",t.lineno,t.colno)),e instanceof o.Dict){var n=this.parsePrimary();this.skip(r.TOKEN_COLON)||this.fail("parseAggregate: expected colon after dict key",t.lineno,t.colno);var s=this.parseExpression();e.addChild(new o.Pair(n.lineno,n.colno,n,s))}else{var a=this.parseExpression();e.addChild(a)}}return e},l.parseSignature=function(e,t){var i=this.peekToken();if(!t&&i.type!==r.TOKEN_LEFT_PAREN){if(e)return null;this.fail("expected arguments",i.lineno,i.colno)}i.type===r.TOKEN_LEFT_PAREN&&(i=this.nextToken());for(var n=new o.NodeList(i.lineno,i.colno),s=new o.KeywordArgs(i.lineno,i.colno),a=!1;;){if(i=this.peekToken(),!t&&i.type===r.TOKEN_RIGHT_PAREN){this.nextToken();break}if(t&&i.type===r.TOKEN_BLOCK_END)break;if(a&&!this.skip(r.TOKEN_COMMA))this.fail("parseSignature: expected comma after expression",i.lineno,i.colno);else{var l=this.parseExpression();this.skipValue(r.TOKEN_OPERATOR,"=")?s.addChild(new o.Pair(l.lineno,l.colno,l,this.parseExpression())):n.addChild(l)}a=!0}return s.children.length&&n.addChild(s),n},l.parseUntilBlocks=function(){for(var e=this.breakOnBlocks,t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];this.breakOnBlocks=i;var r=this.parse();return this.breakOnBlocks=e,r},l.parseNodes=function(){for(var e,t=[];e=this.nextToken();)if(e.type===r.TOKEN_DATA){var i=e.value,n=this.peekToken(),s=n&&n.value;this.dropLeadingWhitespace&&(i=i.replace(/^\s*/,""),this.dropLeadingWhitespace=!1),n&&(n.type===r.TOKEN_BLOCK_START&&"-"===s.charAt(s.length-1)||n.type===r.TOKEN_VARIABLE_START&&"-"===s.charAt(this.tokens.tags.VARIABLE_START.length)||n.type===r.TOKEN_COMMENT&&"-"===s.charAt(this.tokens.tags.COMMENT_START.length))&&(i=i.replace(/\s*$/,"")),t.push(new o.Output(e.lineno,e.colno,[new o.TemplateData(e.lineno,e.colno,i)]))}else if(e.type===r.TOKEN_BLOCK_START){this.dropLeadingWhitespace=!1;var a=this.parseStatement();if(!a)break;t.push(a)}else if(e.type===r.TOKEN_VARIABLE_START){var l=this.parseExpression();this.dropLeadingWhitespace=!1,this.advanceAfterVariableEnd(),t.push(new o.Output(e.lineno,e.colno,[l]))}else e.type===r.TOKEN_COMMENT?this.dropLeadingWhitespace="-"===e.value.charAt(e.value.length-this.tokens.tags.COMMENT_END.length-1):this.fail("Unexpected token at top-level: "+e.type,e.lineno,e.colno);return t},l.parse=function(){return new o.NodeList(0,0,this.parseNodes())},l.parseAsRoot=function(){return new o.Root(0,0,this.parseNodes())},s}(s);e.exports={parse:function(e,t,i){var n=new l(r.lex(e,i));return void 0!==t&&(n.extensions=t),n.parseAsRoot()},Parser:l}},function(e,t,i){"use strict";var n=i(0),r=" \n\t\r ",o="()[]{}%*-+~/#,:|.<>=!",s="string",a="whitespace",l="data",c="block-start",h="block-end",u="variable-start",d="variable-end",p="comment",f="left-paren",m="right-paren",g="left-bracket",v="right-bracket",y="left-curly",b="right-curly",E="operator",x="comma",w="colon",T="tilde",k="pipe",_="float",A="boolean",C="none",S="symbol",R="regex";function L(e,t,i,n){return{type:e,value:t,lineno:i,colno:n}}var O=function(){function e(e,t){this.str=e,this.index=0,this.len=e.length,this.lineno=0,this.colno=0,this.in_code=!1;var i=(t=t||{}).tags||{};this.tags={BLOCK_START:i.blockStart||"{%",BLOCK_END:i.blockEnd||"%}",VARIABLE_START:i.variableStart||"{{",VARIABLE_END:i.variableEnd||"}}",COMMENT_START:i.commentStart||"{#",COMMENT_END:i.commentEnd||"#}"},this.trimBlocks=!!t.trimBlocks,this.lstripBlocks=!!t.lstripBlocks}var t=e.prototype;return t.nextToken=function(){var e,t=this.lineno,i=this.colno;if(this.in_code){var O=this.current();if(this.isFinished())return null;if('"'===O||"'"===O)return L(s,this._parseString(O),t,i);if(e=this._extract(r))return L(a,e,t,i);if((e=this._extractString(this.tags.BLOCK_END))||(e=this._extractString("-"+this.tags.BLOCK_END)))return this.in_code=!1,this.trimBlocks&&("\n"===(O=this.current())?this.forward():"\r"===O&&(this.forward(),"\n"===(O=this.current())?this.forward():this.back())),L(h,e,t,i);if((e=this._extractString(this.tags.VARIABLE_END))||(e=this._extractString("-"+this.tags.VARIABLE_END)))return this.in_code=!1,L(d,e,t,i);if("r"===O&&"/"===this.str.charAt(this.index+1)){this.forwardN(2);for(var M="";!this.isFinished();){if("/"===this.current()&&"\\"!==this.previous()){this.forward();break}M+=this.current(),this.forward()}for(var N=["g","i","m","y"],D="";!this.isFinished()&&-1!==N.indexOf(this.current());)D+=this.current(),this.forward();return L(R,{body:M,flags:D},t,i)}if(-1!==o.indexOf(O)){this.forward();var P,I=["==","===","!=","!==","<=",">=","//","**"],H=O+this.current();switch(-1!==n.indexOf(I,H)&&(this.forward(),O=H,-1!==n.indexOf(I,H+this.current())&&(O=H+this.current(),this.forward())),O){case"(":P=f;break;case")":P=m;break;case"[":P=g;break;case"]":P=v;break;case"{":P=y;break;case"}":P=b;break;case",":P=x;break;case":":P=w;break;case"~":P=T;break;case"|":P=k;break;default:P=E}return L(P,O,t,i)}if((e=this._extractUntil(r+o)).match(/^[-+]?[0-9]+$/)){if("."===this.current()){this.forward();var F=this._extract("0123456789");return L(_,e+"."+F,t,i)}return L("int",e,t,i)}if(e.match(/^(true|false)$/))return L(A,e,t,i);if("none"===e)return L(C,e,t,i);if("null"===e)return L(C,e,t,i);if(e)return L(S,e,t,i);throw new Error("Unexpected value while parsing: "+e)}var j,B=this.tags.BLOCK_START.charAt(0)+this.tags.VARIABLE_START.charAt(0)+this.tags.COMMENT_START.charAt(0)+this.tags.COMMENT_END.charAt(0);if(this.isFinished())return null;if((e=this._extractString(this.tags.BLOCK_START+"-"))||(e=this._extractString(this.tags.BLOCK_START)))return this.in_code=!0,L(c,e,t,i);if((e=this._extractString(this.tags.VARIABLE_START+"-"))||(e=this._extractString(this.tags.VARIABLE_START)))return this.in_code=!0,L(u,e,t,i);e="";var K=!1;for(this._matches(this.tags.COMMENT_START)&&(K=!0,e=this._extractString(this.tags.COMMENT_START));null!==(j=this._extractUntil(B));){if(e+=j,(this._matches(this.tags.BLOCK_START)||this._matches(this.tags.VARIABLE_START)||this._matches(this.tags.COMMENT_START))&&!K){if(this.lstripBlocks&&this._matches(this.tags.BLOCK_START)&&this.colno>0&&this.colno<=e.length){var z=e.slice(-this.colno);if(/^\s+$/.test(z)&&!(e=e.slice(0,-this.colno)).length)return this.nextToken()}break}if(this._matches(this.tags.COMMENT_END)){if(!K)throw new Error("unexpected end of comment");e+=this._extractString(this.tags.COMMENT_END);break}e+=this.current(),this.forward()}if(null===j&&K)throw new Error("expected end of comment, got end of file");return L(K?p:l,e,t,i)},t._parseString=function(e){this.forward();for(var t="";!this.isFinished()&&this.current()!==e;){var i=this.current();if("\\"===i){switch(this.forward(),this.current()){case"n":t+="\n";break;case"t":t+="\t";break;case"r":t+="\r";break;default:t+=this.current()}this.forward()}else t+=i,this.forward()}return this.forward(),t},t._matches=function(e){return this.index+e.length>this.len?null:this.str.slice(this.index,this.index+e.length)===e},t._extractString=function(e){return this._matches(e)?(this.forwardN(e.length),e):null},t._extractUntil=function(e){return this._extractMatching(!0,e||"")},t._extract=function(e){return this._extractMatching(!1,e)},t._extractMatching=function(e,t){if(this.isFinished())return null;var i=t.indexOf(this.current());if(e&&-1===i||!e&&-1!==i){var n=this.current();this.forward();for(var r=t.indexOf(this.current());(e&&-1===r||!e&&-1!==r)&&!this.isFinished();)n+=this.current(),this.forward(),r=t.indexOf(this.current());return n}return""},t._extractRegex=function(e){var t=this.currentStr().match(e);return t?(this.forwardN(t[0].length),t):null},t.isFinished=function(){return this.index>=this.len},t.forwardN=function(e){for(var t=0;t<e;t++)this.forward()},t.forward=function(){this.index++,"\n"===this.previous()?(this.lineno++,this.colno=0):this.colno++},t.backN=function(e){for(var t=0;t<e;t++)this.back()},t.back=function(){if(this.index--,"\n"===this.current()){this.lineno--;var e=this.src.lastIndexOf("\n",this.index-1);this.colno=-1===e?this.index:this.index-e}else this.colno--},t.current=function(){return this.isFinished()?"":this.str.charAt(this.index)},t.currentStr=function(){return this.isFinished()?"":this.str.substr(this.index)},t.previous=function(){return this.str.charAt(this.index-1)},e}();e.exports={lex:function(e,t){return new O(e,t)},TOKEN_STRING:s,TOKEN_WHITESPACE:a,TOKEN_DATA:l,TOKEN_BLOCK_START:c,TOKEN_BLOCK_END:h,TOKEN_VARIABLE_START:u,TOKEN_VARIABLE_END:d,TOKEN_COMMENT:p,TOKEN_LEFT_PAREN:f,TOKEN_RIGHT_PAREN:m,TOKEN_LEFT_BRACKET:g,TOKEN_RIGHT_BRACKET:v,TOKEN_LEFT_CURLY:y,TOKEN_RIGHT_CURLY:b,TOKEN_OPERATOR:E,TOKEN_COMMA:x,TOKEN_COLON:w,TOKEN_TILDE:T,TOKEN_PIPE:k,TOKEN_INT:"int",TOKEN_FLOAT:_,TOKEN_BOOLEAN:A,TOKEN_NONE:C,TOKEN_SYMBOL:S,TOKEN_SPECIAL:"special",TOKEN_REGEX:R}},function(e,t,i){"use strict";function n(e,t){return n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(e,t)}var r=i(6),o=i(19).PrecompiledLoader,s=function(e){var t,i;function r(t,i){var n;return(n=e.call(this)||this).baseURL=t||".",i=i||{},n.useCache=!!i.useCache,n.async=!!i.async,n}i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,n(t,i);var o=r.prototype;return o.resolve=function(e,t){throw new Error("relative templates not support in the browser yet")},o.getSource=function(e,t){var i,n=this,r=this.useCache;return this.fetch(this.baseURL+"/"+e,(function(o,s){if(o)if(t)t(o.content);else{if(404!==o.status)throw o.content;i=null}else i={src:s,path:e,noCache:!r},n.emit("load",e,i),t&&t(null,i)})),i},o.fetch=function(e,t){if("undefined"==typeof window)throw new Error("WebLoader can only by used in a browser");var i=new XMLHttpRequest,n=!0;i.onreadystatechange=function(){4===i.readyState&&n&&(n=!1,0===i.status||200===i.status?t(null,i.responseText):t({status:i.status,content:i.responseText}))},e+=(-1===e.indexOf("?")?"?":"&")+"s="+(new Date).getTime(),i.open("GET",e,this.async),i.send()},r}(r);e.exports={WebLoader:s,PrecompiledLoader:o}},function(e,t,i){"use strict";var n,r=i(0),o=i(7),s=o.Environment,a=o.Template,l=i(6),c=i(10),h=i(23),u=i(5),d=i(8),p=i(9),f=i(2),m=i(3),g=i(25);function v(e,t){var i;return t=t||{},r.isObject(e)&&(t=e,e=null),c.FileSystemLoader?i=new c.FileSystemLoader(e,{watch:t.watch,noCache:t.noCache}):c.WebLoader&&(i=new c.WebLoader(e,{useCache:t.web&&t.web.useCache,async:t.web&&t.web.async})),n=new s(i,t),t&&t.express&&n.express(t.express),n}e.exports={Environment:s,Template:a,Loader:l,FileSystemLoader:c.FileSystemLoader,NodeResolveLoader:c.NodeResolveLoader,PrecompiledLoader:c.PrecompiledLoader,WebLoader:c.WebLoader,compiler:u,parser:d,lexer:p,runtime:f,lib:r,nodes:m,installJinjaCompat:g,configure:v,reset:function(){n=void 0},compile:function(e,t,i,r){return n||v(),new a(e,t,i,r)},render:function(e,t,i){return n||v(),n.render(e,t,i)},renderString:function(e,t,i){return n||v(),n.renderString(e,t,i)},precompile:h?h.precompile:void 0,precompileString:h?h.precompileString:void 0}},function(e,t,i){"use strict";var n=i(13),r=[],o=[],s=n.makeRequestCallFromTimer((function(){if(o.length)throw o.shift()}));function a(e){var t;(t=r.length?r.pop():new l).task=e,n(t)}function l(){this.task=null}e.exports=a,l.prototype.call=function(){try{this.task.call()}catch(e){a.onerror?a.onerror(e):(o.push(e),s())}finally{this.task=null,r[r.length]=this}}},function(e,t,i){"use strict";(function(t){function i(e){r.length||n(),r[r.length]=e}e.exports=i;var n,r=[],o=0;function s(){for(;o<r.length;){var e=o;if(o+=1,r[e].call(),o>1024){for(var t=0,i=r.length-o;t<i;t++)r[t]=r[t+o];r.length-=o,o=0}}r.length=0,o=0}var a,l,c,h=void 0!==t?t:self,u=h.MutationObserver||h.WebKitMutationObserver;function d(e){return function(){var t=setTimeout(n,0),i=setInterval(n,50);function n(){clearTimeout(t),clearInterval(i),e()}}}"function"==typeof u?(a=1,l=new u(s),c=document.createTextNode(""),l.observe(c,{characterData:!0}),n=function(){a=-a,c.data=a}):n=d(s),i.requestFlush=n,i.makeRequestCallFromTimer=d}).call(t,i(14))},function(e,t){var i;i=function(){return this}();try{i=i||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(i=window)}e.exports=i},function(e,t,i){var n;!function(i){"use strict";var r=function(){var e=Array.prototype.slice.call(arguments);"function"==typeof e[0]&&e[0].apply(null,e.splice(1))},o=function(e){"function"==typeof setImmediate?setImmediate(e):"undefined"!=typeof process&&process.nextTick?process.nextTick(e):setTimeout(e,0)},s=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},a=function(e,t,i){var n=i?o:r;if(t=t||function(){},!s(e)){var a=new Error("First argument to waterfall must be an array of functions");return t(a)}if(!e.length)return t();var l=function(e){return function(i){if(i)t.apply(null,arguments),t=function(){};else{var r=Array.prototype.slice.call(arguments,1),o=e.next();o?r.push(l(o)):r.push(t),n((function(){e.apply(null,r)}))}}};l(function(e){var t=function(i){var n=function(){return e.length&&e[i].apply(null,arguments),n.next()};return n.next=function(){return i<e.length-1?t(i+1):null},n};return t(0)}(e))()};void 0===(n=function(){return a}.apply(t,[]))||(e.exports=n)}()},function(e,t,i){"use strict";var n,r="object"==typeof Reflect?Reflect:null,o=r&&"function"==typeof r.apply?r.apply:function(e,t,i){return Function.prototype.apply.call(e,t,i)};n=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var s=Number.isNaN||function(e){return e!=e};function a(){a.init.call(this)}e.exports=a,e.exports.once=function(e,t){return new Promise((function(i,n){function r(){void 0!==o&&e.removeListener("error",o),i([].slice.call(arguments))}var o;"error"!==t&&(o=function(i){e.removeListener(t,r),n(i)},e.once("error",o)),e.once(t,r)}))},a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var l=10;function c(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function h(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function u(e,t,i,n){var r,o,s,a;if(c(i),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,i.listener?i.listener:i),o=e._events),s=o[t]),void 0===s)s=o[t]=i,++e._eventsCount;else if("function"==typeof s?s=o[t]=n?[i,s]:[s,i]:n?s.unshift(i):s.push(i),(r=h(e))>0&&s.length>r&&!s.warned){s.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=s.length,a=l,console&&console.warn&&console.warn(a)}return e}function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function p(e,t,i){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:i},r=d.bind(n);return r.listener=i,n.wrapFn=r,r}function f(e,t,i){var n=e._events;if(void 0===n)return[];var r=n[t];return void 0===r?[]:"function"==typeof r?i?[r.listener||r]:[r]:i?function(e){for(var t=new Array(e.length),i=0;i<t.length;++i)t[i]=e[i].listener||e[i];return t}(r):g(r,r.length)}function m(e){var t=this._events;if(void 0!==t){var i=t[e];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function g(e,t){for(var i=new Array(t),n=0;n<t;++n)i[n]=e[n];return i}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return l},set:function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");l=e}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return h(this)},a.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);var n="error"===e,r=this._events;if(void 0!==r)n=n&&void 0===r.error;else if(!n)return!1;if(n){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var l=r[e];if(void 0===l)return!1;if("function"==typeof l)o(l,this,t);else{var c=l.length,h=g(l,c);for(i=0;i<c;++i)o(h[i],this,t)}return!0},a.prototype.addListener=function(e,t){return u(this,e,t,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(e,t){return u(this,e,t,!0)},a.prototype.once=function(e,t){return c(t),this.on(e,p(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){return c(t),this.prependListener(e,p(this,e,t)),this},a.prototype.removeListener=function(e,t){var i,n,r,o,s;if(c(t),void 0===(n=this._events))return this;if(void 0===(i=n[e]))return this;if(i===t||i.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,i.listener||t));else if("function"!=typeof i){for(r=-1,o=i.length-1;o>=0;o--)if(i[o]===t||i[o].listener===t){s=i[o].listener,r=o;break}if(r<0)return this;0===r?i.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(i,r),1===i.length&&(n[e]=i[0]),void 0!==n.removeListener&&this.emit("removeListener",e,s||t)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(e){var t,i,n;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[e]),this;if(0===arguments.length){var r,o=Object.keys(i);for(n=0;n<o.length;++n)"removeListener"!==(r=o[n])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=i[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},a.prototype.listeners=function(e){return f(this,e,!0)},a.prototype.rawListeners=function(e){return f(this,e,!1)},a.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):m.call(e,t)},a.prototype.listenerCount=m,a.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]}},function(e,t,i){"use strict";var n=i(3),r=i(0),o=0;function s(){return"hole_"+o++}function a(e,t){for(var i=null,n=0;n<e.length;n++){var r=t(e[n]);r!==e[n]&&(i||(i=e.slice()),i[n]=r)}return i||e}function l(e,t,i){if(!(e instanceof n.Node))return e;if(!i){var r=t(e);if(r&&r!==e)return r}if(e instanceof n.NodeList){var o=a(e.children,(function(e){return l(e,t,i)}));o!==e.children&&(e=new n[e.typename](e.lineno,e.colno,o))}else if(e instanceof n.CallExtension){var s=l(e.args,t,i),c=a(e.contentArgs,(function(e){return l(e,t,i)}));s===e.args&&c===e.contentArgs||(e=new n[e.typename](e.extName,e.prop,s,c))}else{var h=e.fields.map((function(t){return e[t]})),u=a(h,(function(e){return l(e,t,i)}));u!==h&&(e=new n[e.typename](e.lineno,e.colno),u.forEach((function(t,i){e[e.fields[i]]=t})))}return i&&t(e)||e}function c(e,t){return l(e,t,!0)}function h(e,t,i){var o=[],a=c(i?e[i]:e,(function(e){var i;return e instanceof n.Block?e:((e instanceof n.Filter&&-1!==r.indexOf(t,e.name.value)||e instanceof n.CallExtensionAsync)&&(i=new n.Symbol(e.lineno,e.colno,s()),o.push(new n.FilterAsync(e.lineno,e.colno,e.name,e.args,i))),i)}));return i?e[i]=a:e=a,o.length?(o.push(e),new n.NodeList(e.lineno,e.colno,o)):e}e.exports={transform:function(e,t){return function(e,t){return function(e){return c(e,(function(e){if(e instanceof n.If||e instanceof n.For){var t=!1;if(l(e,(function(e){if(e instanceof n.FilterAsync||e instanceof n.IfAsync||e instanceof n.AsyncEach||e instanceof n.AsyncAll||e instanceof n.CallExtensionAsync)return t=!0,e})),t){if(e instanceof n.If)return new n.IfAsync(e.lineno,e.colno,e.cond,e.body,e.else_);if(e instanceof n.For&&!(e instanceof n.AsyncAll))return new n.AsyncEach(e.lineno,e.colno,e.arr,e.name,e.body,e.else_)}}}))}(function(e){return l(e,(function(e){if(e instanceof n.Block){var t=!1,i=s();e.body=l(e.body,(function(e){if(e instanceof n.FunCall&&"super"===e.name.value)return t=!0,new n.Symbol(e.lineno,e.colno,i)})),t&&e.body.children.unshift(new n.Super(0,0,e.name,new n.Symbol(0,0,i)))}}))}(function(e,t){return c(e,(function(e){return e instanceof n.Output?h(e,t):e instanceof n.Set?h(e,t,"value"):e instanceof n.For?h(e,t,"arr"):e instanceof n.If?h(e,t,"cond"):e instanceof n.CallExtension?h(e,t,"args"):void 0}))}(e,t)))}(e,t||[])}}},function(e,t,i){"use strict";var n=i(0),r=i(2);function o(e,t){return null==e||!1===e?t:e}function s(e){return e!=e}function a(e){var t=(e=o(e,"")).toLowerCase();return r.copySafeness(e,t.charAt(0).toUpperCase()+t.slice(1))}function l(e){if(n.isString(e))return e.split("");if(n.isObject(e))return n._entries(e||{}).map((function(e){return{key:e[0],value:e[1]}}));if(n.isArray(e))return e;throw new n.TemplateError("list filter: type not iterable")}function c(e){return function(t,i,r){void 0===i&&(i="truthy");var o=this,s=o.env.getTest(i);return n.toArray(t).filter((function(t){return s.call(o,t,r)===e}))}}function h(e){return r.copySafeness(e,e.replace(/^\s*|\s*$/g,""))}(t=e.exports={}).abs=Math.abs,t.batch=function(e,t,i){var n,r=[],o=[];for(n=0;n<e.length;n++)n%t==0&&o.length&&(r.push(o),o=[]),o.push(e[n]);if(o.length){if(i)for(n=o.length;n<t;n++)o.push(i);r.push(o)}return r},t.capitalize=a,t.center=function(e,t){if(t=t||80,(e=o(e,"")).length>=t)return e;var i=t-e.length,s=n.repeat(" ",i/2-i%2),a=n.repeat(" ",i/2);return r.copySafeness(e,s+e+a)},t.default=function(e,t,i){return i?e||t:void 0!==e?e:t},t.dictsort=function(e,t,i){if(!n.isObject(e))throw new n.TemplateError("dictsort filter: val must be an object");var r,o=[];for(var s in e)o.push([s,e[s]]);if(void 0===i||"key"===i)r=0;else{if("value"!==i)throw new n.TemplateError("dictsort filter: You can only sort by either key or value");r=1}return o.sort((function(e,i){var o=e[r],s=i[r];return t||(n.isString(o)&&(o=o.toUpperCase()),n.isString(s)&&(s=s.toUpperCase())),o>s?1:o===s?0:-1})),o},t.dump=function(e,t){return JSON.stringify(e,null,t)},t.escape=function(e){return e instanceof r.SafeString?e:(e=null==e?"":e,r.markSafe(n.escape(e.toString())))},t.safe=function(e){return e instanceof r.SafeString?e:(e=null==e?"":e,r.markSafe(e.toString()))},t.first=function(e){return e[0]},t.forceescape=function(e){return e=null==e?"":e,r.markSafe(n.escape(e.toString()))},t.groupby=function(e,t){return n.groupBy(e,t,this.env.opts.throwOnUndefined)},t.indent=function(e,t,i){if(""===(e=o(e,"")))return"";t=t||4;var s=e.split("\n"),a=n.repeat(" ",t),l=s.map((function(e,t){return 0!==t||i?""+a+e:e})).join("\n");return r.copySafeness(e,l)},t.join=function(e,t,i){return t=t||"",i&&(e=n.map(e,(function(e){return e[i]}))),e.join(t)},t.last=function(e){return e[e.length-1]},t.length=function(e){var t=o(e,"");return void 0!==t?"function"==typeof Map&&t instanceof Map||"function"==typeof Set&&t instanceof Set?t.size:!n.isObject(t)||t instanceof r.SafeString?t.length:n.keys(t).length:0},t.list=l,t.lower=function(e){return(e=o(e,"")).toLowerCase()},t.nl2br=function(e){return null==e?"":r.copySafeness(e,e.replace(/\r\n|\n/g,"<br />\n"))},t.random=function(e){return e[Math.floor(Math.random()*e.length)]},t.reject=c(!1),t.rejectattr=function(e,t){return e.filter((function(e){return!e[t]}))},t.select=c(!0),t.selectattr=function(e,t){return e.filter((function(e){return!!e[t]}))},t.replace=function(e,t,i,n){var o=e;if(t instanceof RegExp)return e.replace(t,i);void 0===n&&(n=-1);var s="";if("number"==typeof t)t=""+t;else if("string"!=typeof t)return e;if("number"==typeof e&&(e=""+e),"string"!=typeof e&&!(e instanceof r.SafeString))return e;if(""===t)return s=i+e.split("").join(i)+i,r.copySafeness(e,s);var a=e.indexOf(t);if(0===n||-1===a)return e;for(var l=0,c=0;a>-1&&(-1===n||c<n);)s+=e.substring(l,a)+i,l=a+t.length,c++,a=e.indexOf(t,l);return l<e.length&&(s+=e.substring(l)),r.copySafeness(o,s)},t.reverse=function(e){var t;return(t=n.isString(e)?l(e):n.map(e,(function(e){return e}))).reverse(),n.isString(e)?r.copySafeness(e,t.join("")):t},t.round=function(e,t,i){t=t||0;var n=Math.pow(10,t);return("ceil"===i?Math.ceil:"floor"===i?Math.floor:Math.round)(e*n)/n},t.slice=function(e,t,i){for(var n=Math.floor(e.length/t),r=e.length%t,o=[],s=0,a=0;a<t;a++){var l=s+a*n;a<r&&s++;var c=s+(a+1)*n,h=e.slice(l,c);i&&a>=r&&h.push(i),o.push(h)}return o},t.sum=function(e,t,i){return void 0===i&&(i=0),t&&(e=n.map(e,(function(e){return e[t]}))),i+e.reduce((function(e,t){return e+t}),0)},t.sort=r.makeMacro(["value","reverse","case_sensitive","attribute"],[],(function(e,t,i,r){var o=this,s=n.map(e,(function(e){return e})),a=n.getAttrGetter(r);return s.sort((function(e,s){var l=r?a(e):e,c=r?a(s):s;if(o.env.opts.throwOnUndefined&&r&&(void 0===l||void 0===c))throw new TypeError('sort: attribute "'+r+'" resolved to undefined');return!i&&n.isString(l)&&n.isString(c)&&(l=l.toLowerCase(),c=c.toLowerCase()),l<c?t?1:-1:l>c?t?-1:1:0})),s})),t.string=function(e){return r.copySafeness(e,e)},t.striptags=function(e,t){var i,n=h((e=o(e,"")).replace(/<\/?([a-z][a-z0-9]*)\b[^>]*>|<!--[\s\S]*?-->/gi,""));return i=t?n.replace(/^ +| +$/gm,"").replace(/ +/g," ").replace(/(\r\n)/g,"\n").replace(/\n\n\n+/g,"\n\n"):n.replace(/\s+/gi," "),r.copySafeness(e,i)},t.title=function(e){var t=(e=o(e,"")).split(" ").map((function(e){return a(e)}));return r.copySafeness(e,t.join(" "))},t.trim=h,t.truncate=function(e,t,i,n){var s=e;if(t=t||255,(e=o(e,"")).length<=t)return e;if(i)e=e.substring(0,t);else{var a=e.lastIndexOf(" ",t);-1===a&&(a=t),e=e.substring(0,a)}return e+=null!=n?n:"...",r.copySafeness(s,e)},t.upper=function(e){return(e=o(e,"")).toUpperCase()},t.urlencode=function(e){var t=encodeURIComponent;return n.isString(e)?t(e):(n.isArray(e)?e:n._entries(e)).map((function(e){var i=e[0],n=e[1];return t(i)+"="+t(n)})).join("&")};var u=/^(?:\(|<|&lt;)?(.*?)(?:\.|,|\)|\n|&gt;)?$/,d=/^[\w.!#$%&'*+\-\/=?\^`{|}~]+@[a-z\d\-]+(\.[a-z\d\-]+)+$/i,p=/^https?:\/\/.*$/,f=/^www\./,m=/\.(?:org|net|com)(?:\:|\/|$)/;t.urlize=function(e,t,i){s(t)&&(t=1/0);var n=!0===i?' rel="nofollow"':"";return e.split(/(\s+)/).filter((function(e){return e&&e.length})).map((function(e){var i=e.match(u),r=i?i[1]:e,o=r.substr(0,t);return p.test(r)?'<a href="'+r+'"'+n+">"+o+"</a>":f.test(r)?'<a href="http://'+r+'"'+n+">"+o+"</a>":d.test(r)?'<a href="mailto:'+r+'">'+r+"</a>":m.test(r)?'<a href="http://'+r+'"'+n+">"+o+"</a>":e})).join("")},t.wordcount=function(e){var t=(e=o(e,""))?e.match(/\w+/g):null;return t?t.length:null},t.float=function(e,t){var i=parseFloat(e);return s(i)?t:i};var g=r.makeMacro(["value","default","base"],[],(function(e,t,i){void 0===i&&(i=10);var n=parseInt(e,i);return s(n)?t:n}));t.int=g,t.d=t.default,t.e=t.escape},function(e,t,i){"use strict";function n(e,t){return n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(e,t)}var r=function(e){var t,i;function r(t){var i;return(i=e.call(this)||this).precompiled=t||{},i}return i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,n(t,i),r.prototype.getSource=function(e){return this.precompiled[e]?{src:{type:"code",obj:this.precompiled[e]},path:e}:null},r}(i(6));e.exports={PrecompiledLoader:r}},function(e,t,i){"use strict";var n=i(2).SafeString;t.callable=function(e){return"function"==typeof e},t.defined=function(e){return void 0!==e},t.divisibleby=function(e,t){return e%t==0},t.escaped=function(e){return e instanceof n},t.equalto=function(e,t){return e===t},t.eq=t.equalto,t.sameas=t.equalto,t.even=function(e){return e%2==0},t.falsy=function(e){return!e},t.ge=function(e,t){return e>=t},t.greaterthan=function(e,t){return e>t},t.gt=t.greaterthan,t.le=function(e,t){return e<=t},t.lessthan=function(e,t){return e<t},t.lt=t.lessthan,t.lower=function(e){return e.toLowerCase()===e},t.ne=function(e,t){return e!==t},t.null=function(e){return null===e},t.number=function(e){return"number"==typeof e},t.odd=function(e){return e%2==1},t.string=function(e){return"string"==typeof e},t.truthy=function(e){return!!e},t.undefined=function(e){return void 0===e},t.upper=function(e){return e.toUpperCase()===e},t.iterable=function(e){return"undefined"!=typeof Symbol?!!e[Symbol.iterator]:Array.isArray(e)||"string"==typeof e},t.mapping=function(e){var t=null!=e&&"object"==typeof e&&!Array.isArray(e);return Set?t&&!(e instanceof Set):t}},function(e,t,i){"use strict";function n(e){var t=-1;return{current:null,reset:function(){t=-1,this.current=null},next:function(){return++t>=e.length&&(t=0),this.current=e[t],this.current}}}e.exports=function(){return{range:function(e,t,i){void 0===t?(t=e,e=0,i=1):i||(i=1);var n=[];if(i>0)for(var r=e;r<t;r+=i)n.push(r);else for(var o=e;o>t;o+=i)n.push(o);return n},cycler:function(){return n(Array.prototype.slice.call(arguments))},joiner:function(e){return function(e){e=e||",";var t=!0;return function(){var i=t?"":e;return t=!1,i}}(e)}}}},function(e,t,i){var n=i(4);e.exports=function(e,t){function i(e,t){if(this.name=e,this.path=e,this.defaultEngine=t.defaultEngine,this.ext=n.extname(e),!this.ext&&!this.defaultEngine)throw new Error("No default engine was specified and no extension was provided.");this.ext||(this.name+=this.ext=("."!==this.defaultEngine[0]?".":"")+this.defaultEngine)}return i.prototype.render=function(t,i){e.render(this.name,t,i)},t.set("view",i),t.set("nunjucksEnv",e),e}},function(e,t,i){"use strict";var n=i(4),r=i(4),o=i(0)._prettifyError,s=i(5),a=i(7).Environment,l=i(24);function c(e,t){return!!Array.isArray(t)&&t.some((function(t){return e.match(t)}))}function h(e,t){(t=t||{}).isString=!0;var i=t.env||new a([]),n=t.wrapper||l;if(!t.name)throw new Error('the "name" option is required when compiling a string');return n([u(e,t.name,i)],t)}function u(e,t,i){var n,r=(i=i||new a([])).asyncFilters,l=i.extensionsList;t=t.replace(/\\/g,"/");try{n=s.compile(e,r,l,t,i.opts)}catch(e){throw o(t,!1,e)}return{name:t,template:n}}e.exports={precompile:function(e,t){var i=(t=t||{}).env||new a([]),o=t.wrapper||l;if(t.isString)return h(e,t);var s=n.existsSync(e)&&n.statSync(e),d=[],p=[];if(s.isFile())d.push(u(n.readFileSync(e,"utf-8"),t.name||e,i));else if(s.isDirectory()){!function i(o){n.readdirSync(o).forEach((function(s){var a=r.join(o,s),l=a.substr(r.join(e,"/").length),h=n.statSync(a);h&&h.isDirectory()?c(l+="/",t.exclude)||i(a):c(l,t.include)&&p.push(a)}))}(e);for(var f=0;f<p.length;f++){var m=p[f].replace(r.join(e,"/"),"");try{d.push(u(n.readFileSync(p[f],"utf-8"),m,i))}catch(e){if(!t.force)throw e;console.error(e)}}}return o(d,t)},precompileString:h}},function(e,t,i){"use strict";e.exports=function(e,t){var i="";t=t||{};for(var n=0;n<e.length;n++){var r=JSON.stringify(e[n].name);i+="(function() {(window.nunjucksPrecompiled = window.nunjucksPrecompiled || {})["+r+"] = (function() {\n"+e[n].template+"\n})();\n",t.asFunction&&(i+="return function(ctx, cb) { return nunjucks.render("+r+", ctx, cb); }\n"),i+="})();\n"}return i}},function(e,t,i){e.exports=function(){"use strict";var e,t,i=this.runtime,n=this.lib,r=this.compiler.Compiler,o=this.parser.Parser,s=this.nodes,a=this.lexer,l=i.contextOrFrameLookup,c=i.memberLookup;function h(e){return{index:e.index,lineno:e.lineno,colno:e.colno}}if(r&&(e=r.prototype.assertType),o&&(t=o.prototype.parseAggregate),i.contextOrFrameLookup=function(e,t,i){var n=l.apply(this,arguments);if(void 0!==n)return n;switch(i){case"True":return!0;case"False":return!1;case"None":return null;default:return}},s&&r&&o){var u=s.Node.extend("Slice",{fields:["start","stop","step"],init:function(e,t,i,n,r){i=i||new s.Literal(e,t,null),n=n||new s.Literal(e,t,null),r=r||new s.Literal(e,t,1),this.parent(e,t,i,n,r)}});r.prototype.assertType=function(t){t instanceof u||e.apply(this,arguments)},r.prototype.compileSlice=function(e,t){this._emit("("),this._compileExpression(e.start,t),this._emit("),("),this._compileExpression(e.stop,t),this._emit("),("),this._compileExpression(e.step,t),this._emit(")")},o.prototype.parseAggregate=function(){var e=this,i=h(this.tokens);i.colno--,i.index--;try{return t.apply(this)}catch(t){var r=h(this.tokens),o=function(){return n._assign(e.tokens,r),t};n._assign(this.tokens,i),this.peeked=!1;var l=this.peekToken();if(l.type!==a.TOKEN_LEFT_BRACKET)throw o();this.nextToken();for(var c=new u(l.lineno,l.colno),d=!1,p=0;p<=c.fields.length&&!this.skip(a.TOKEN_RIGHT_BRACKET);p++){if(p===c.fields.length){if(!d)break;this.fail("parseSlice: too many slice components",l.lineno,l.colno)}this.skip(a.TOKEN_COLON)?d=!0:(c[c.fields[p]]=this.parseExpression(),d=this.skip(a.TOKEN_COLON)||d)}if(!d)throw o();return new s.Array(l.lineno,l.colno,[c])}}}function d(e,t,n,r){e=e||[],null===t&&(t=r<0?e.length-1:0),null===n?n=r<0?-1:e.length:n<0&&(n+=e.length),t<0&&(t+=e.length);for(var o=[],s=t;!(s<0||s>e.length||r>0&&s>=n||r<0&&s<=n);s+=r)o.push(i.memberLookup(e,s));return o}function p(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var f={pop:function(e){if(void 0===e)return this.pop();if(e>=this.length||e<0)throw new Error("KeyError");return this.splice(e,1)},append:function(e){return this.push(e)},remove:function(e){for(var t=0;t<this.length;t++)if(this[t]===e)return this.splice(t,1);throw new Error("ValueError")},count:function(e){for(var t=0,i=0;i<this.length;i++)this[i]===e&&t++;return t},index:function(e){var t;if(-1===(t=this.indexOf(e)))throw new Error("ValueError");return t},find:function(e){return this.indexOf(e)},insert:function(e,t){return this.splice(e,0,t)}},m={items:function(){return n._entries(this)},values:function(){return n._values(this)},keys:function(){return n.keys(this)},get:function(e,t){var i=this[e];return void 0===i&&(i=t),i},has_key:function(e){return p(this,e)},pop:function(e,t){var i=this[e];if(void 0===i&&void 0!==t)i=t;else{if(void 0===i)throw new Error("KeyError");delete this[e]}return i},popitem:function(){var e=n.keys(this);if(!e.length)throw new Error("KeyError");var t=e[0],i=this[t];return delete this[t],[t,i]},setdefault:function(e,t){return void 0===t&&(t=null),e in this||(this[e]=t),this[e]},update:function(e){return n._assign(this,e),null}};return m.iteritems=m.items,m.itervalues=m.values,m.iterkeys=m.keys,i.memberLookup=function(e,t,i){return 4===arguments.length?d.apply(this,arguments):(e=e||{},n.isArray(e)&&p(f,t)?f[t].bind(e):n.isObject(e)&&p(m,t)?m[t].bind(e):c.apply(this,arguments))},function(){i.contextOrFrameLookup=l,i.memberLookup=c,r&&(r.prototype.assertType=e),o&&(o.prototype.parseAggregate=t)}}}])},e.exports=t()},6594:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Pathfinding:()=>m});var n=function(){};n.computeCentroids=function(e){var t,i,n;for(t=0,i=e.faces.length;t<i;t++)(n=e.faces[t]).centroid=new THREE.Vector3(0,0,0),n.centroid.add(e.vertices[n.a]),n.centroid.add(e.vertices[n.b]),n.centroid.add(e.vertices[n.c]),n.centroid.divideScalar(3)},n.roundNumber=function(e,t){return Number(e.toFixed(t))},n.sample=function(e){return e[Math.floor(Math.random()*e.length)]},n.mergeVertexIds=function(e,t){var i=[];if(e.forEach((function(e){t.indexOf(e)>=0&&i.push(e)})),i.length<2)return[];i.includes(e[0])&&i.includes(e[e.length-1])&&e.push(e.shift()),i.includes(t[0])&&i.includes(t[t.length-1])&&t.push(t.shift()),i=[],e.forEach((function(e){t.includes(e)&&i.push(e)}));for(var n=i[1],r=i[0],o=e.slice();o[0]!==n;)o.push(o.shift());for(var s=0,a=t.slice();a[0]!==r;)if(a.push(a.shift()),s++>10)throw new Error("Unexpected state");return a.shift(),a.pop(),o.concat(a)},n.setPolygonCentroid=function(e,t){var i=new THREE.Vector3,n=t.vertices;e.vertexIds.forEach((function(e){i.add(n[e])})),i.divideScalar(e.vertexIds.length),e.centroid.copy(i)},n.cleanPolygon=function(e,t){for(var i=[],n=t.vertices,r=0;r<e.vertexIds.length;r++){var o,s,a,l=n[e.vertexIds[r]];0===r?(o=e.vertexIds[1],s=e.vertexIds[e.vertexIds.length-1]):r===e.vertexIds.length-1?(o=e.vertexIds[0],s=e.vertexIds[e.vertexIds.length-2]):(o=e.vertexIds[r+1],s=e.vertexIds[r-1]),a=n[s];var c=n[o].clone().sub(l),h=a.clone().sub(l),u=c.angleTo(h);if(u>Math.PI-.01&&u<Math.PI+.01){var d=[];e.neighbours.forEach((function(t){t.vertexIds.includes(e.vertexIds[r])||d.push(t)})),e.neighbours=d}else i.push(e.vertexIds[r])}e.vertexIds=i,this.setPolygonCentroid(e,t)},n.isConvex=function(e,t){var i=t.vertices;if(e.vertexIds.length<3)return!1;for(var n=!0,r=[],o=0;o<e.vertexIds.length;o++){var s,a,l=i[e.vertexIds[o]];0===o?(s=i[e.vertexIds[1]],a=i[e.vertexIds[e.vertexIds.length-1]]):o===e.vertexIds.length-1?(s=i[e.vertexIds[0]],a=i[e.vertexIds[e.vertexIds.length-2]]):(s=i[e.vertexIds[o+1]],a=i[e.vertexIds[o-1]]);var c=s.clone().sub(l),h=a.clone().sub(l),u=c.angleTo(h);if(u===Math.PI||0===u)return!1;var d=c.cross(h).y;r.push(d)}return r.forEach((function(e){0===e&&(n=!1)})),r.forEach(r[0]>0?function(e){e<0&&(n=!1)}:function(e){e>0&&(n=!1)}),n},n.distanceToSquared=function(e,t){var i=e.x-t.x,n=e.y-t.y,r=e.z-t.z;return i*i+n*n+r*r},n.isPointInPoly=function(e,t){for(var i=!1,n=-1,r=e.length,o=r-1;++n<r;o=n)(e[n].z<=t.z&&t.z<e[o].z||e[o].z<=t.z&&t.z<e[n].z)&&t.x<(e[o].x-e[n].x)*(t.z-e[n].z)/(e[o].z-e[n].z)+e[n].x&&(i=!i);return i},n.isVectorInPolygon=function(e,t,i){var n=1e5,r=-1e5,o=[];return t.vertexIds.forEach((function(e){n=Math.min(i[e].y,n),r=Math.max(i[e].y,r),o.push(i[e])})),!!(e.y<r+.5&&e.y>n-.5&&this.isPointInPoly(o,e))},n.triarea2=function(e,t,i){return(i.x-e.x)*(t.z-e.z)-(t.x-e.x)*(i.z-e.z)},n.vequal=function(e,t){return this.distanceToSquared(e,t)<1e-5};var r=function(e){this.content=[],this.scoreFunction=e};r.prototype.push=function(e){this.content.push(e),this.sinkDown(this.content.length-1)},r.prototype.pop=function(){var e=this.content[0],t=this.content.pop();return this.content.length>0&&(this.content[0]=t,this.bubbleUp(0)),e},r.prototype.remove=function(e){var t=this.content.indexOf(e),i=this.content.pop();t!==this.content.length-1&&(this.content[t]=i,this.scoreFunction(i)<this.scoreFunction(e)?this.sinkDown(t):this.bubbleUp(t))},r.prototype.size=function(){return this.content.length},r.prototype.rescoreElement=function(e){this.sinkDown(this.content.indexOf(e))},r.prototype.sinkDown=function(e){for(var t=this.content[e];e>0;){var i=(e+1>>1)-1,n=this.content[i];if(!(this.scoreFunction(t)<this.scoreFunction(n)))break;this.content[i]=t,this.content[e]=n,e=i}},r.prototype.bubbleUp=function(e){for(var t=this.content.length,i=this.content[e],n=this.scoreFunction(i);;){var r=e+1<<1,o=r-1,s=null,a=void 0;if(o<t&&(a=this.scoreFunction(this.content[o]))<n&&(s=o),r<t&&this.scoreFunction(this.content[r])<(null===s?n:a)&&(s=r),null===s)break;this.content[e]=this.content[s],this.content[s]=i,e=s}};var o=function(){};o.init=function(e){for(var t=0;t<e.length;t++){var i=e[t];i.f=0,i.g=0,i.h=0,i.cost=1,i.visited=!1,i.closed=!1,i.parent=null}},o.cleanUp=function(e){for(var t=0;t<e.length;t++){var i=e[t];delete i.f,delete i.g,delete i.h,delete i.cost,delete i.visited,delete i.closed,delete i.parent}},o.heap=function(){return new r((function(e){return e.f}))},o.search=function(e,t,i){this.init(e);var n=this.heap();for(n.push(t);n.size()>0;){var r=n.pop();if(r===i){for(var o=r,s=[];o.parent;)s.push(o),o=o.parent;return this.cleanUp(s),s.reverse()}r.closed=!0;for(var a=this.neighbours(e,r),l=0,c=a.length;l<c;l++){var h=a[l];if(!h.closed){var u=r.g+h.cost,d=h.visited;if(!d||u<h.g){if(h.visited=!0,h.parent=r,!h.centroid||!i.centroid)throw new Error("Unexpected state");h.h=h.h||this.heuristic(h.centroid,i.centroid),h.g=u,h.f=h.g+h.h,d?n.rescoreElement(h):n.push(h)}}}}return[]},o.heuristic=function(e,t){return n.distanceToSquared(e,t)},o.neighbours=function(e,t){for(var i=[],n=0;n<t.neighbours.length;n++)i.push(e[t.neighbours[n]]);return i};var s=1,a=function(){};a.buildZone=function(e){var t=this,i=this._buildNavigationMesh(e),r={};i.vertices.forEach((function(e){e.x=n.roundNumber(e.x,2),e.y=n.roundNumber(e.y,2),e.z=n.roundNumber(e.z,2)})),r.vertices=i.vertices;var o=this._buildPolygonGroups(i);r.groups=[];var s=function(e,t){for(var i=0;i<e.length;i++)if(t===e[i])return i};return o.forEach((function(e){var i=[];e.forEach((function(r){var o=r.neighbours.map((function(t){return s(e,t)})),a=r.neighbours.map((function(e){return t._getSharedVerticesInOrder(r,e)}));r.centroid.x=n.roundNumber(r.centroid.x,2),r.centroid.y=n.roundNumber(r.centroid.y,2),r.centroid.z=n.roundNumber(r.centroid.z,2),i.push({id:s(e,r),neighbours:o,vertexIds:r.vertexIds,centroid:r.centroid,portals:a})})),r.groups.push(i)})),r},a._buildNavigationMesh=function(e){return n.computeCentroids(e),e.mergeVertices(),this._buildPolygonsFromGeometry(e)},a._buildPolygonGroups=function(e){var t=[],i=0,n=function(e){e.neighbours.forEach((function(t){void 0===t.group&&(t.group=e.group,n(t))}))};return e.polygons.forEach((function(e){void 0===e.group&&(e.group=i++,n(e)),t[e.group]||(t[e.group]=[]),t[e.group].push(e)})),t},a._buildPolygonNeighbours=function(e,t,i){var n=new Set,r=i.get(e.vertexIds[0]),o=i.get(e.vertexIds[1]),s=i.get(e.vertexIds[2]);r.forEach((function(e){(o.has(e)||s.has(e))&&n.add(t.polygons[e])})),o.forEach((function(e){s.has(e)&&n.add(t.polygons[e])})),e.neighbours=Array.from(n)},a._buildPolygonsFromGeometry=function(e){for(var t=this,i=[],n=e.vertices,r=e.faceVertexUvs,o=new Map,a=0;a<n.length;a++)o.set(a,new Set);e.faces.forEach((function(e){i.push({id:s++,vertexIds:[e.a,e.b,e.c],centroid:e.centroid,normal:e.normal,neighbours:[]}),o.get(e.a).add(i.length-1),o.get(e.b).add(i.length-1),o.get(e.c).add(i.length-1)}));var l={polygons:i,vertices:n,faceVertexUvs:r};return i.forEach((function(e){t._buildPolygonNeighbours(e,l,o)})),l},a._getSharedVerticesInOrder=function(e,t){var i=e.vertexIds,n=t.vertexIds,r=new Set;if(i.forEach((function(e){n.includes(e)&&r.add(e)})),r.size<2)return[];r.has(i[0])&&r.has(i[i.length-1])&&i.push(i.shift()),r.has(n[0])&&r.has(n[n.length-1])&&n.push(n.shift());var o=[];return i.forEach((function(e){n.includes(e)&&o.push(e)})),o};var l=function(){this.portals=[]};l.prototype.push=function(e,t){void 0===t&&(t=e),this.portals.push({left:e,right:t})},l.prototype.stringPull=function(){var e,t,i,r=this.portals,o=[],s=0,a=0,l=0;t=r[0].left,i=r[0].right,o.push(e=r[0].left);for(var c=1;c<r.length;c++){var h=r[c].left,u=r[c].right;if(n.triarea2(e,i,u)<=0){if(!(n.vequal(e,i)||n.triarea2(e,t,u)>0)){o.push(t),t=e=t,i=e,a=s=a,l=s,c=s;continue}i=u,l=c}if(n.triarea2(e,t,h)>=0){if(!(n.vequal(e,t)||n.triarea2(e,i,h)<0)){o.push(i),t=e=i,i=e,a=s=l,l=s,c=s;continue}t=h,a=c}}return 0!==o.length&&n.vequal(o[o.length-1],r[r.length-1].left)||o.push(r[r.length-1].left),this.path=o,o};var c,h,u,d,p,f,m=function(){this.zones={}};m.createZone=function(e){return a.buildZone(e)},m.prototype.setZoneData=function(e,t){this.zones[e]=t},m.prototype.getGroup=function(e,t){if(!this.zones[e])return null;var i=null,r=Math.pow(50,2);return this.zones[e].groups.forEach((function(e,o){e.forEach((function(e){var s=n.distanceToSquared(e.centroid,t);s<r&&(i=o,r=s)}))})),i},m.prototype.getRandomNode=function(e,t,i,r){if(!this.zones[e])return new THREE.Vector3;i=i||null,r=r||0;var o=[];return this.zones[e].groups[t].forEach((function(e){i&&r?n.distanceToSquared(i,e.centroid)<r*r&&o.push(e.centroid):o.push(e.centroid)})),n.sample(o)||new THREE.Vector3},m.prototype.getClosestNode=function(e,t,i,r){void 0===r&&(r=!1);var o=this.zones[t].vertices,s=null,a=1/0;return this.zones[t].groups[i].forEach((function(t){var i=n.distanceToSquared(t.centroid,e);i<a&&(!r||n.isVectorInPolygon(e,t,o))&&(s=t,a=i)})),s},m.prototype.findPath=function(e,t,i,n){var r=this.zones[i].groups[n],s=this.zones[i].vertices,a=this.getClosestNode(e,i,n),c=this.getClosestNode(t,i,n,!0);if(!a||!c)return null;var h=o.search(r,a,c),u=function(e,t){for(var i=0;i<e.neighbours.length;i++)if(e.neighbours[i]===t.id)return e.portals[i]},d=new l;d.push(e);for(var p=0;p<h.length;p++){var f=h[p+1];if(f){var m=u(h[p],f);d.push(s[m[0]],s[m[1]])}}d.push(t),d.stringPull();var g=d.path.map((function(e){return new THREE.Vector3(e.x,e.y,e.z)}));return g.shift(),g},m.prototype.clampStep=(u=new THREE.Vector3,d=new THREE.Plane,p=new THREE.Triangle,f=new THREE.Vector3,function(e,t,i,n,r,o){var s=this.zones[n].vertices,a=this.zones[n].groups[r],l=[i],m={};m[i.id]=0,c=void 0,f.set(0,0,0),h=1/0,d.setFromCoplanarPoints(s[i.vertexIds[0]],s[i.vertexIds[1]],s[i.vertexIds[2]]),d.projectPoint(t,u),t.copy(u);for(var g=l.pop();g;g=l.pop()){p.set(s[g.vertexIds[0]],s[g.vertexIds[1]],s[g.vertexIds[2]]),p.closestPointToPoint(t,u),u.distanceToSquared(t)<h&&(c=g,f.copy(u),h=u.distanceToSquared(t));var v=m[g];if(!(v>2))for(var y=0;y<g.neighbours.length;y++){var b=a[g.neighbours[y]];b.id in m||(l.push(b),m[b.id]=v+1)}}return o.copy(f),c})},1463:e=>{e.exports="#version 300 es\nprecision highp float;\n\nin vec2 v_uv;\n\nuniform vec3 u_primary_color;\nuniform vec3 u_secondary_color;\nuniform float u_ratio;\n\nout vec4 out_color;\n\n// iquilezles.org\nfloat sdBox( in vec2 p, in vec2 b )\n{\n    vec2 d = abs(p)-b;\n    return length(max(d,0.0)) + min(max(d.x,d.y),0.0);\n}\n\nvoid main()\n{\n    vec2 p = v_uv - 0.5; \n    p.x *= u_ratio;\n    float d = sdBox(p, vec2(0.4 * u_ratio, 0.4)) - 0.05;\n    if(d > 0.05) {\n        discard;\n    }\n\tvec3 col = mix( u_secondary_color, u_primary_color, 1.0-smoothstep(-0.02,-0.01,d) );\n    out_color = vec4(col, 1.0);\n}"},40:e=>{e.exports="#version 300 es\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\n\nin vec3 position;\nin vec2 uv;\n\nout vec2 v_uv;\n\nvoid main() {\n    v_uv = uv;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}"},5775:(e,t,i)=>{var n={"./ball.js":8191,"./controller.js":1693,"./cup.js":2049,"./plane-shader.js":490,"./rope.js":2264,"./state.js":4403,"./timer.js":716};function r(e){var t=o(e);return i(t)}function o(e){if(!i.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}r.keys=function(){return Object.keys(n)},r.resolve=o,e.exports=r,r.id=5775}},i={};function n(e){var r=i[e];if(void 0!==r)return r.exports;var o=i[e]={exports:{}};return t[e].call(o.exports,o,o.exports,n),o.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n(7571),n(8581),n(401),n(2596),n(4409),n(2985),(e=n(5775)).keys().forEach(e),n(5174),console.warn=function(){}})();